/*
 H5C3 Framework v0.9.9-alpha-Production
 Built Fri Sep 20 16:30:54 2013
 http://h5c3.i2tmlabs.com/?license.txt
 Copyright 2013 by i2tm labs - all rights reserved.
 2013 by i2tm labs - all rights reserved.
*/
(function(){var b={pad:function(b,c,g){b+="";g=g?g:" ";if(b.length<c)for(;b.length<c;)b+=g;return b},objToString:function(b,c){if("undefined"===typeof b)return b;$lf="undefined"===typeof c||!1===c?", ":"\n";var g="",h;for(h in b)b.hasOwnProperty(h)&&("object"===typeof b[h]&&(g+="\n",b[h]=this.objToString(b[h],c)),g+=h+"::"+b[h]+$lf);return g+=$lf},camelize:function(){return this.replace(/\-(\w)/g,function(b,c){return c.toUpperCase()})},contains:function(b){b="string"===typeof b?b:b.toString();return-1<
this.indexOf(b)},count:function(b){"[object RegExp]"!==Object.prototype.toString.call(b)&&(b=b.toString().replace(/\$\^\[\]\{\}\(\)\?\:\.\+\*/g,"\\$1"));b=RegExp(b?b.source:".","g");return(this.match(b)||[]).length},enclose:function(b,c){return(b=b||"")+this+(c?c:b)},extract:function(b,c){c=void 0===c?0:c;if(!b.global)return this.match(b)[c]||"";for(var g,h=[];g=b.exec(this);)h[h.length]=g[c]||"";return h},forEach:function(b){for(var c,g=-1;c=this[++g];)b.call(this,c,g);return!0},forEachWord:function(b){var c=
this,g=-1;c.replace(/\b([\w\-]+)\b/g,function(h,k){b.call(c,k,++g);return h});return!0},linkify:function(b){return this.replace(/(^|\s)((?:f|ht)tps?:\/\/[^\s]+)/g,b||'$1<a href="$2">$2</a>')},many:function(b){return Array(b?b+1:2).join(this)},randomize:function(){return this.split("").sort(function(){return 0.5<Math.random()?-1:1}).join("")},remove:function(b){return this.replace(b||/./g,"")},reverse:function(){return this.split("").reverse().join("")},shorten:function(b,c){var g=this.substring(0,
b||this.length);return g+(g===this?"":c||"")},sort:function(){return Array.prototype.sort.apply(this.split(""),arguments).join("")},toDOM:function(){document.createElement("div").innerHTML=this;return Array.prototype.slice.call(div.childNodes)},trim:function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},wrap:function(b,c,g){c=c||"\n";b=b||75;return this?this.match(RegExp(".{1,"+b+"}(\\s|$)"+(g?"|.{"+b+"}|.+$":"|\\S+?(\\s|$)"),"g")).join(c):this}},c;for(c in b)String.prototype[c]=String.prototype[c]||
b[c]})();
(function(b,c){"object"===typeof exports?module.exports=c():b.printStackTrace=c()})(this,function(){function b(c){c=c||{guess:!0};var e=c.e||null;c=!!c.guess;var f=new b.implementation,g=f.run(e);g.push(e);return c?f.guessAnonymousFunctions(g):g}b.implementation=function(){};b.implementation.prototype={run:function(b,e){b=b||this.createException();e=e||this.mode(b);return"other"===e?this.other(arguments.callee):this[e](b)},createException:function(){try{this.undef()}catch(b){return b}},mode:function(b){return b.arguments&&b.stack?
"chrome":b.stack&&b.sourceURL?"safari":b.stack&&b.number?"ie":b.stack&&b.fileName?"firefox":b.message&&b["opera#sourceloc"]?!b.stacktrace||-1<b.message.indexOf("\n")&&b.message.split("\n").length>b.stacktrace.split("\n").length?"opera9":"opera10a":b.message&&b.stack&&b.stacktrace?0>b.stacktrace.indexOf("called from line")?"opera10b":"opera11":b.stack&&!b.fileName?"chrome":"other"},instrumentFunction:function(c,e,f){c=c||window;var g=c[e];c[e]=function(){f.call(this,b().slice(4));return c[e]._instrumented.apply(this,
arguments)};c[e]._instrumented=g},deinstrumentFunction:function(b,e){b[e].constructor===Function&&(b[e]._instrumented&&b[e]._instrumented.constructor===Function)&&(b[e]=b[e]._instrumented)},chrome:function(b){return(b.stack+"\n").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(1,-1)},safari:function(b){return b.stack.replace(/\[native code\]\n/m,
"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(b){return b.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},firefox:function(b){return b.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},opera11:function(b){var e=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;b=b.stacktrace.split("\n");for(var f=
[],g=0,h=b.length;g<h;g+=2){var k=e.exec(b[g]);if(k){var l=k[4]+":"+k[1]+":"+k[2],k=k[3]||"global code",k=k.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");f.push(k+"@"+l+" -- "+b[g+1].replace(/^\s+/,""))}}return f},opera10b:function(b){var e=/^(.*)@(.+):(\d+)$/;b=b.stacktrace.split("\n");for(var f=[],g=0,h=b.length;g<h;g++){var k=e.exec(b[g]);k&&f.push((k[1]?k[1]+"()":"global code")+"@"+k[2]+":"+k[3])}return f},opera10a:function(b){var e=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;
b=b.stacktrace.split("\n");for(var f=[],g=0,h=b.length;g<h;g+=2){var k=e.exec(b[g]);k&&f.push((k[3]||"{anonymous}")+"()@"+k[2]+":"+k[1]+" -- "+b[g+1].replace(/^\s+/,""))}return f},opera9:function(b){var e=/Line (\d+).*script (?:in )?(\S+)/i;b=b.message.split("\n");for(var f=[],g=2,h=b.length;g<h;g+=2){var k=e.exec(b[g]);k&&f.push("{anonymous}()@"+k[2]+":"+k[1]+" -- "+b[g+1].replace(/^\s+/,""))}return f},other:function(b){for(var e=/function\s*([\w\-$]+)?\s*\(/i,f=[],g,h;b&&b.arguments&&10>f.length;)g=
e.test(b.toString())?RegExp.$1||"{anonymous}":"{anonymous}",h=Array.prototype.slice.call(b.arguments||[]),f[f.length]=g+"("+this.stringifyArguments(h)+")",b=b.caller;return f},stringifyArguments:function(b){for(var e=[],f=Array.prototype.slice,g=0;g<b.length;++g){var h=b[g];void 0===h?e[g]="undefined":null===h?e[g]="null":h.constructor&&(h.constructor===Array?e[g]=3>h.length?"["+this.stringifyArguments(h)+"]":"["+this.stringifyArguments(f.call(h,0,1))+"..."+this.stringifyArguments(f.call(h,-1))+"]":
h.constructor===Object?e[g]="#object":h.constructor===Function?e[g]="#function":h.constructor===String?e[g]='"'+h+'"':h.constructor===Number&&(e[g]=h))}return e.join(",")},sourceCache:{},ajax:function(b){var e=this.createXMLHTTPObject();if(e)try{return e.open("GET",b,!1),e.send(null),e.responseText}catch(f){}return""},createXMLHTTPObject:function(){for(var b,e=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},
function(){return new ActiveXObject("Microsoft.XMLHTTP")}],f=0;f<e.length;f++)try{return b=e[f](),this.createXMLHTTPObject=e[f],b}catch(g){}},isSameDomain:function(b){return"undefined"!==typeof location&&-1!==b.indexOf(location.hostname)},getSource:function(b){b in this.sourceCache||(this.sourceCache[b]=this.ajax(b).split("\n"));return this.sourceCache[b]},guessAnonymousFunctions:function(b){for(var e=0;e<b.length;++e){var f=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,g=b[e],h=/\{anonymous\}\(.*\)@(.*)/.exec(g);
if(h){var k=f.exec(h[1]);k&&(f=k[1],h=k[2],k=k[3]||0,f&&(this.isSameDomain(f)&&h)&&(f=this.guessAnonymousFunction(f,h,k),b[e]=g.replace("{anonymous}",f)))}}return b},guessAnonymousFunction:function(b,e,f){var g;try{g=this.findFunctionName(this.getSource(b),e)}catch(h){g="getSource failed with url: "+b+", exception: "+h.toString()}return g},findFunctionName:function(b,e){for(var f=/function\s+([^(]*?)\s*\(([^)]*)\)/,g=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,h=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,
k="",l,n=Math.min(e,20),m,p=0;p<n;++p)if(l=b[e-p-1],m=l.indexOf("//"),0<=m&&(l=l.substr(0,m)),l)if(k=l+k,(l=g.exec(k))&&l[1]||(l=f.exec(k))&&l[1]||(l=h.exec(k))&&l[1])return l[1];return"(?)"}};return b});"object"!==typeof JSON&&(JSON={});
(function(){function b(b){return 10>b?"0"+b:b}function c(b){g.lastIndex=0;return g.test(b)?'"'+b.replace(g,function(b){var c=l[b];return"string"===typeof c?c:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function e(b,f){var g,l,t,u,r=h,s,q=f[b];q&&("object"===typeof q&&"function"===typeof q.toJSON)&&(q=q.toJSON(b));"function"===typeof n&&(q=n.call(f,b,q));switch(typeof q){case "string":return c(q);case "number":return isFinite(q)?String(q):"null";case "boolean":case "null":return String(q);
case "object":if(!q)return"null";h+=k;s=[];if("[object Array]"===Object.prototype.toString.apply(q)){u=q.length;for(g=0;g<u;g+=1)s[g]=e(g,q)||"null";t=0===s.length?"[]":h?"[\n"+h+s.join(",\n"+h)+"\n"+r+"]":"["+s.join(",")+"]";h=r;return t}if(n&&"object"===typeof n)for(u=n.length,g=0;g<u;g+=1)"string"===typeof n[g]&&(l=n[g],(t=e(l,q))&&s.push(c(l)+(h?": ":":")+t));else for(l in q)Object.prototype.hasOwnProperty.call(q,l)&&(t=e(l,q))&&s.push(c(l)+(h?": ":":")+t);t=0===s.length?"{}":h?"{\n"+h+s.join(",\n"+
h)+"\n"+r+"}":"{"+s.join(",")+"}";h=r;return t}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var f=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
g=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,h,k,l={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},n;"function"!==typeof JSON.stringify&&(JSON.stringify=function(b,c,f){var g;k=h="";if("number"===typeof f)for(g=0;g<f;g+=1)k+=" ";else"string"===typeof f&&(k=f);if((n=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return e("",{"":b})});
"function"!==typeof JSON.parse&&(JSON.parse=function(b,c){function e(b,f){var g,h,k=b[f];if(k&&"object"===typeof k)for(g in k)Object.prototype.hasOwnProperty.call(k,g)&&(h=e(k,g),void 0!==h?k[g]=h:delete k[g]);return c.call(b,f,k)}var g;b=String(b);f.lastIndex=0;f.test(b)&&(b=b.replace(f,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return g=eval("("+b+")"),"function"===typeof c?e({"":g},""):g;throw new SyntaxError("JSON.parse");})})();
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(b){var c="",e,f,g,h,k,l,n=0;for(b=Base64._utf8_encode(b);n<b.length;)e=b.charCodeAt(n++),f=b.charCodeAt(n++),g=b.charCodeAt(n++),h=e>>2,e=(e&3)<<4|f>>4,k=(f&15)<<2|g>>6,l=g&63,isNaN(f)?k=l=64:isNaN(g)&&(l=64),c=c+this._keyStr.charAt(h)+this._keyStr.charAt(e)+this._keyStr.charAt(k)+this._keyStr.charAt(l);return c},decode:function(b){var c=[],e,f,g,h,k,l=0;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<
b.length;)e=this._keyStr.indexOf(b.charAt(l++)),f=this._keyStr.indexOf(b.charAt(l++)),h=this._keyStr.indexOf(b.charAt(l++)),k=this._keyStr.indexOf(b.charAt(l++)),e=e<<2|f>>4,f=(f&15)<<4|h>>2,g=(h&3)<<6|k,c.push(String.fromCharCode(e)),64!=h&&c.push(String.fromCharCode(f)),64!=k&&c.push(String.fromCharCode(g));c.join("");return c},_utf8_encode:function(b){if(null===b||"undefined"===typeof b)return"";b+="";var c="",e,f,g=0;e=f=0;for(var g=b.length,h=0;h<g;h++){var k=b.charCodeAt(h),l=null;128>k?f++:
l=127<k&&2048>k?String.fromCharCode(k>>6|192,k&63|128):String.fromCharCode(k>>12|224,k>>6&63|128,k&63|128);null!==l&&(f>e&&(c+=b.slice(e,f)),c+=l,e=f=h+1)}f>e&&(c+=b.slice(e,g));return c},_utf8_decode:function(b){var c=[],e=0,f=0,g=0,h=0,k=0;for(b+="";e<b.length;)g=b.charCodeAt(e),128>g?(c[f++]=String.fromCharCode(g),e++):191<g&&224>g?(h=b.charCodeAt(e+1),c[f++]=String.fromCharCode((g&31)<<6|h&63),e+=2):(h=b.charCodeAt(e+1),k=b.charCodeAt(e+2),c[f++]=String.fromCharCode((g&15)<<12|(h&63)<<6|k&63),
e+=3);return c.join("")}};DOC=function(){return document};GQS=function(b,c,e){CHK(e,DOC());return e.querySelector("div[data-"+b+'="'+c+'"]')};GEI=function(b){return DOC().getElementById(b)};GEN=function(b){return DOC().getElementsByName(b)};GEC=function(b){return DOC().getElementsByClass(b)};GET=function(b){return DOC().getElementsByTagName(b)};CNT=function(b){return"string"===typeof b?GEI(b):b};CTX=function(b){return CNT(b).getContext("2d")};ESA=function(b,c,e){CNT(b).setAttribute(c,e)};
EGA=function(b,c){CNT(b).getAttribute(c)};AEA=function(b,c,e,f){var g=CNT(b);c=DOC().createElement(c);e&&(c.id=e);f&&(c.innerHTML=f);g.parentNode.insertBefore(c,b);return g.parentNode.id};AET=function(b,c,e,f){b=CNT(b);c=DOC().createElement(c);e&&(c.id=e);f&&(c.innerHTML=f);b.appendChild(c);return c};
PUW=function(b,c,e,f,g){var h=window.screen.availWidth/2-f/2,k=window.screen.availHeight/2-g/2;!0===e?(b=window.open(b,c,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no"),b.moveTo(0,0),b.resizeTo(window.screen.availWidth,window.screen.availHeight)):b=window.open(b,c,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+f+", height="+g+", top="+k+", left="+h);b&&!b.closed&&"undefined"!==
b.closed&&0!==b.screenX||window.alert("Please change your popup settings for this domain.");return b};
ISA=function(b){what=function(b){return Object.prototype.toString.call(b).remove("[").remove("]").split(" ").pop()};kind=function(b,e){if(null===e)return"null";if("undefined"===e)return"undefined";if("Object"!==b&&"Function"!==b)return b;if("Object"===b)return"undefined"!==typeof e.constructor?"undefined"!==typeof e.Class?"undefined"!==typeof e.Class._CLASSNAME?e.Class._CLASSNAME:"undefined"!==typeof e.name&&""!==e.name?"Object:"+e.name:"Object:Unnamed":"Object:Simple":"undefined"!==typeof e.toString?
b:"Object";if("Function"===b&&"undefined"!==typeof e.arguments)return"undefined"!==typeof e.prototype?"undefined"!==typeof e.name&&""!==e.name?"Method:"+e.name:"Method:Unnamed":b};return kind(what(b),b)};VLD=function(b){return!(null===b||"undefined"===b||void 0===b||""===b)};CHK=function(b,c){return VLD(b)?b:c};AST=function(b,c){if(!b)throw c;};RUN=function(b){VLD(h5c3.bootstrap)&&h5c3.applets.use({file:b})};
ERR=function(b,c){if(VLD(h5c3)&&VLD(h5c3.errorhandler)){var e=DOC().createEvent("Event");e.initEvent("H5C3Error",!0,!0);e.arguments=arguments;DOC().dispatchEvent(e)}else VLD(console)&&("string"===typeof c?e=c:"object"===typeof c||"function"===typeof c?(c.fullName?e=c.fullName:c._CLASSNAME&&(e=c._CLASSNAME),e+="-"+c._CLASSVERSION):e="Unknown",console.log(e+":"+b))};
var h5c3={_CLASSNAME:"H5C3",_CLASSVERSION:"0.5.1",NAME:"H5C3 Framework",VERSION:"0.9.9-alpha",DISTRO:"Production",BUILT:"Fri Sep 20 16:30:54 2013",path:{home:"http://h5c3.i2tmlabs.com/",base:"public/sandbox/",applets:"public/applets/",scripts:"public/shared/js/",styles:"public/shared/css/",images:"public/shared/img/",plugins:"public/shared/plugins/",user:"public/users/",app:window.location.protocol+"//"+window.location.host+window.location.pathname.split("/").slice(0,-1).join("/")+"/"},hasOwn:Object.prototype.hasOwnProperty,
isH5C3:function(b){return"object"===typeof b&&"function"===typeof b.isH5C3},isFunction:function(b){return!!(b&&b.constructor&&b.call&&b.apply)},isWindow:function(b){return!(!b||!b.setInterval)},isArray:Array.isArray||function(b){return b.constructor===Array},isString:function(b){return"string"==typeof b},isObject:function(b){return b===Object(b)},isPlainObject:function(b){if(!b||this.isObject(b)||b.nodeType||this.isWindow(b))return!1;try{if(b.constructor&&!this.hasOwn.call(b,"constructor")&&!this.hasOwn.call(b.constructor.prototype,
"isPrototypeOf"))return!1}catch(c){return!1}for(var e in b);return void 0===e||this.hasOwn.call(b,e)},bind:function(b,c){return function(){c.apply(b,arguments)}},extend:function(){var b,c,e,f,g,h=arguments[0]||{},k=1,l=arguments.length,n=!1;"boolean"===typeof h&&(n=h,h=arguments[1]||{},k=2);"object"===typeof h||h5c3.isFunction(h)||(h={});l===k&&(h=this,--k);for(;k<l;k++)if(null!=(b=arguments[k]))for(c in b)e=h[c],f=b[c],h!==f&&(n&&f&&(this.isPlainObject(f)||(g=this.isArray(f)))?(g?(g=!1,e=e&&this.isArray(e)?
e:[]):e=e&&this.isPlainObject(e)?e:{},h[c]=this.extend(n,e,f)):void 0!==f&&(h[c]=f));return h},devMode:!1,ready:!1,init:function(){var b;b="No Configuration file detected.\nYour very first script tag should be as below. You can change the path/file for the data-config attribute.\n"+('EXAMPLE: <script src="'+this.usePath("script")+'int/h5c3.debug.min.js" data-config="assets/config.js">\x3c/script>');if(config&&config.app&&config.options)this.config=config,this.ready=!0;else if(AST(!this.getConfig(),
b))return this.ready;this.devMode="Developer"===this.DISTRO||"Production"===this.DISTRO?!0:!1;return this.ready},usePath:function(b){switch(b.toLowerCase()){case "home":return this.path.home;case "base":return this.path.home+path.base;case "applets":return this.path.home+path.applets;case "scripts":return this.path.home+path.scripts;case "styles":return this.path.home+path.styles;case "images":return this.path.home+path.images;case "plugins":return this.path.home+path.plugins;case "user":return this.path.home+
path.user;case "app":return this.path.app}},getConfig:function(){if("file:"!==location.protocol&&"undefined"===typeof this.config){var b=document.getElementsByTagName("script")[0];if(0===b.children.length)b.dataset.config&&(this.path.config=this.path.app+b.dataset.config);else for(i=0;i<b.children.length;i++)b.children[i].dataset.config&&(this.path.config=this.path.app+b.children[i].dataset.config);this.path.config&&this.XHR(this.path.config)}},tag:function(){return this.NAME+" v"+this.VERSION+"-"+
this.DISTRO},XHR:function(b,c,e,f,g,h){function k(b){b.req=printStackTrace.implementation.prototype.createXMLHTTPObject();if("withCredentials"in b.req){b.req.open(b.method,b.url,!0);b.req.onerror=b.onError;b.req.onreadystatechange=function(){if(4===b.req.readyState)if(200<=b.req.status&&400>b.req.status)b.onLoad(b.req.responseText);else b.req.abort()};try{b.req.send(b.data)}catch(c){AST(null,printStackTrace({e:c}))}}}function l(b){b.req=new XDomainRequest;b.req.open(b.method,b.url);b.req.onerror=
b.onError;b.req.onload=function(){c(b.req.responseText)};b.req.send(b.data)}if(VLD(b)&&""!==b){h=h5c3.devMode&&!0!=h?!1:!0;g={req:"",url:b,trace:h};g.method=CHK(f,"GET");g.onLoad=CHK(c,this._onLoad);g.onError=CHK(e,this._onError);g.data=CHK(e,0);b.indexOf("http");a=b.indexOf("applet.");try{if(XMLHttpRequest)return k(g);if(XDomainRequest)return l(g)}catch(n){}}else e(Error("URL provided is invalid ["+b+"]"))},clientFS_exists:function(b,c){storageRootEntry.getFile(b,{create:!1},function(){c(!0)},function(){c(!1)})},
run:function(){VLD(this.bootstrap)||(this.bootstrap=new h5c3.Bootstrap)}};h5c3.push=Array.prototype.push;h5c3.merge=function(b,c){var e=b.length,f=0;if("number"===typeof c.length)for(var g=c.length;f<g;f++)b[e++]=c[f];else for(;void 0!==c[f];)b[e++]=c[f++];b.length=e;return b};h5c3.makeArray=function(b,c){var e=c||[];null!=b&&(null==b.length||h5c3.isString(b)||h5c3.isFunction(b)||h5c3.isWindow(b)?h5c3.push.call(e,b):h5c3.merge(e,b));return e};
h5c3.each=function(b,c,e){var f,g=0,h=b.length,k=void 0===h||h5c3.isFunction(b);if(e)if(k)for(f in b){if(!1===c.apply(b[f],e))break}else for(;g<h&&!1!==c.apply(b[g++],e););else if(k)for(f in b){if(!1===c.call(b[f],f,b[f]))break}else for(;g<h&&!1!==c.call(b[g],g,b[g++]););return b};h5c3._flagsCache={};h5c3.createFlags=function(b){var c=h5c3._flagsCache[b]={},e,f;b=b.split(/\s+/);e=0;for(f=b.length;e<f;e++)c[b[e]]=!0;return c};
h5c3.Callbacks=function(b){b=b?h5c3._flagsCache[b]||h5c3.createFlags(b):{};var c=[],e=[],f,g,h,k,l,n=function(e){var f,g,h;f=0;for(g=e.length;f<g;f++)h=e[f],h5c3.isArray(h)?n(h):h5c3.isFunction(h)&&(b.unique&&p.has(h)||c.push(h))},m=function(m,n){n=n||[];f=!b.memory||[m,n];g=!0;l=h||0;h=0;for(k=c.length;c&&l<k;l++)if(!1===c[l].apply(m,n)&&b.stopOnFalse){f=!0;break}g=!1;c&&(b.once?!0===f?p.disable():c=[]:e&&e.length&&(f=e.shift(),p.fireWith(f[0],f[1])))},p={add:function(){if(c){var b=c.length;n(arguments);
g?k=c.length:f&&!0!==f&&(h=b,m(f[0],f[1]))}return this},remove:function(){if(c)for(var e=arguments,f=0,h=e.length;f<h;f++)for(var m=0;m<c.length&&(e[f]!==c[m]||(g&&m<=k&&(k--,m<=l&&l--),c.splice(m--,1),!b.unique));m++);return this},has:function(b){if(c)for(var e=0,f=c.length;e<f;e++)if(b===c[e])return!0;return!1},empty:function(){c=[];return this},disable:function(){c=e=f=void 0;return this},disabled:function(){return!c},lock:function(){e=void 0;f&&!0!==f||p.disable();return this},locked:function(){return!e},
fireWith:function(c,h){e&&(g?b.once||e.push([c,h]):b.once&&f||m(c,h));return this},fire:function(){p.fireWith(this,arguments);return this},fired:function(){return!!f}};return p};
h5c3.extend({Deferred:function(b){var c=h5c3.Callbacks("once memory"),e=h5c3.Callbacks("once memory"),f=h5c3.Callbacks("memory"),g="pending",h={resolve:c,reject:e,notify:f},k={done:c.add,fail:e.add,progress:f.add,state:function(){return g},isResolved:c.fired,isRejected:e.fired,then:function(b,c,e){l.done(b).fail(c).progress(e);return this},always:function(){l.done.apply(l,arguments).fail.apply(l,arguments);return this},pipe:function(b,c,e){return h5c3.Deferred(function(f){h5c3.each({done:[b,"resolve"],
fail:[c,"reject"],progress:[e,"notify"]},function(b,c){var e=c[0],g=c[1],h;if(h5c3.isFunction(e))l[b](function(){if((h=e.apply(this,arguments))&&h5c3.isFunction(h.promise))h.promise().then(f.resolve,f.reject,f.notify);else f[g+"With"](this===l?f:this,[h])});else l[b](f[g])})}).promise()},promise:function(b){if(null==b)b=k;else for(var c in k)b[c]=k[c];return b}},l=k.promise({}),n;for(n in h)l[n]=h[n].fire,l[n+"With"]=h[n].fireWith;l.done(function(){g="resolved"},e.disable,f.lock).fail(function(){g=
"rejected"},c.disable,f.lock);b&&b.call(l,l);return l},when:function(b){function c(b){return function(c){g[b]=1<arguments.length?f.call(arguments,0):c;--n||m.resolveWith(m,g)}}function e(b){return function(c){l[b]=1<arguments.length?f.call(arguments,0):c;m.notifyWith(p,l)}}var f=[].slice,g=f.call(arguments,0),h=0,k=g.length,l=Array(k),n=k,m=1>=k&&b&&h5c3.isFunction(b.promise)?b:h5c3.Deferred(),p=m.promise();if(1<k){for(;h<k;h++)g[h]&&g[h].promise&&h5c3.isFunction(g[h].promise)?g[h].promise().then(c(h),
m.reject,e(h)):--n;n||m.resolveWith(m,g)}else m!==b&&m.resolveWith(m,k?[b]:[]);return p}});
(function(b){var c=/_|-/,e=/::/,f=/([A-Z]+)([A-Z][a-z])/g,g=/([a-z\d])([A-Z])/g,h=/([a-z\d])([A-Z])/g,k=/\{([^\}]+)\}/g,l=/\./,n=function(b){return(b=typeof b)&&("function"==b||"object"==b)},m=function(c,e,f){c=c?c.split(l):[];var g=c.length;e=b.isArray(e)?e:[e||window];var h,k,m,p=0;if(0==g)return e[0];for(;h=e[p++];){for(m=0;m<g-1&&n(h);m++)h=h[c[m]]||f&&(h[c[m]]={});if(n(h)&&(k=h[c[m]]||f&&(h[c[m]]={}),void 0!==k))return!1===f&&delete h[c[m]],k}},p=b.String={getObject:m,capitalize:function(b){return b.charAt(0).toUpperCase()+
b.substr(1)},camelize:function(b){b=p.classize(b);return b.charAt(0).toLowerCase()+b.substr(1)},classize:function(b,e){for(var f=b.split(c),g=0;g<f.length;g++)f[g]=p.capitalize(f[g]);return f.join(e||"")},niceName:function(b){return p.classize(b," ")},underscore:function(b){return b.replace(e,"/").replace(f,"$1_$2").replace(g,"$1_$2").replace(h,"_").toLowerCase()},sub:function(b,c,e){var f=[];f.push(b.replace(k,function(b,g){var h=m(g,c,"boolean"==typeof e?!e:e),k=typeof h;if("object"!==k&&"function"!==
k||null===k)return""+h;f.push(h);return""}));return 1>=f.length?f[0]:f}}})(h5c3);
(function(b){var c=!1,e=b.makeArray,f=b.isFunction,g=b.isArray,h=b.extend,k=function(b){if(!b||"object"!=typeof b)return b;if(b instanceof Array){for(var c=[],e=0;e<b.length;e++)c[e]=k(b[e]);return c}c={};for(e in b)c[e]=k(b[e]);return c},l=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,n=function(b,c,e){e=e||b;for(var g in b)e[g]=f(b[g])&&f(c[g])&&l.test(b[g])?function(b,e){return function(){var f=this._super,g;this._super=c[b];g=e.apply(this,arguments);this._super=f;return g}}(g,b[g]):b[g]},m=b.Class=
function(){if(arguments.length)return m.extend.apply(m,arguments)};h(m,{callback:function(b){var c=e(arguments),f;b=c.shift();g(b)||(b=[b]);f=this;return function(){for(var h=c.concat(e(arguments)),k,l=b.length,m=0,n;m<l;m++)if(n=b[m])(k="string"==typeof n)&&f._set_called&&(f.called=n),h=(k?f[n]:n).apply(f,h||[]),m<l-1&&(h=!g(h)||h._use_call?[h]:h);return h}},getObject:b.String.getObject,newInstance:function(){var b=this.rawInstance(),c;b.setup&&(c=b.setup.apply(b,arguments));for(var e in b.__proto__)b[e]=
k(b[e]);b.init&&b.init.apply(b,g(c)?c:arguments);return b},setup:function(b,c){this.defaults=h(!0,{},b.defaults,this.defaults);void 0==this._types&&(this._types=[]);this._types.push(this.fullName);void 0==this._fullTypeName&&(this._fullTypeName="|");this._fullTypeName+=this.fullName+"|";return arguments},rawInstance:function(){c=!0;var b=new this;c=!1;return b},extend:function(b,f,g){function l(){if(!c)try{return this.constructor!==l&&arguments.length?arguments.callee.extend.apply(arguments.callee,
arguments):this.Class.newInstance.apply(this.Class,arguments)}catch(b){return null}}"string"!=typeof b&&(g=f,f=b,b=null);g||(g=f,f=null);g=g||{};var u=this.prototype,r,s,q,x;this.isA=function(b){return-1!=this._fullTypeName.indexOf("|"+b+"|")};c=!0;x=new this;c=!1;n(g,u,x);for(r in this)this.hasOwnProperty(r)&&(l[r]=k(this[r]));n(f,this,l);b&&(u=b.split(/\./),s=u.pop(),r="",0<u.length&&(q=r=m.getObject(u.join("."),window,!0)),r[s]=l);h(l,{prototype:x,namespace:q,shortName:s,constructor:l,fullName:b});
l.prototype.Class=l.prototype.constructor=l;s=l.setup.apply(l,[this].concat(e(arguments)));l.init&&l.init.apply(l,s||[]);return l}});m.prototype.callback=m.callback})(h5c3);
h5c3.Base=h5c3.Class("h5c3.Base",{_CLASSVERSION:"0.4.3",totalObjects:0,WARN:"WARN",DEBUG:"DEBUG",ERROR:"ERROR",INFO:"INFO",log:function(b,c,e){var f=GEI("waConsoleLog"),g="";b&&(g=":"+b);b=[this.fullName+g+"\t\t ["+c+"] \t\t"].concat(Array.prototype.slice.call(e));VLD(f)&&(f.value+=b+"\n",f.scrollTop=f.scrollHeight);window.console.log.apply(console,b)},warn:function(b){this.log(null,this.WARN,b)},debug:function(b){this.log(null,this.DEBUG,b)},error:function(b){this.log(null,this.ERROR,b)},info:function(b){this.log(null,
this.INFO,b)},assert:function(b,c){if(!c)throw b;}},{objectId:0,uniqueId:null,init:function(){},setup:function(){this.objectId=this.Class.totalObjects++;this.uniqueId=this.Class.fullName+":"+this.objectId},getUniqueId:function(){return this.uniqueId},hashCode:function(){return this.getUniqueId()},warn:function(){this.Class.log(this.objectId,this.Class.WARN,arguments)},debug:function(){this.Class.log(this.objectId,this.Class.DEBUG,arguments)},error:function(){this.Class.log(this.objectId,this.Class.ERROR,
arguments)},info:function(){this.Class.log(this.objectId,this.Class.INFO,arguments)},toString:function(){return this.Class.fullName+" [id: "+this.objectId+"]"}});
h5c3.Device=h5c3.Base.extend("h5c3.Device",{_CLASSNAME:"Device",_CLASSVERSION:"1.1.0",pixelRatio:0,isiPhone:!1,isiPhone4:!1,isiPad:!1,isiPod:!1,isAndroid:!1,isTouch:!1,isFirefox:!1,isChrome:!1,isOpera:!1,isIE:!1,ieVersion:0,requestAnimFrame:null,hasMemoryProfiling:!1,canPlayOgg:!1,canPlayMP3:!1,canPlayWav:!1,init:function(){this.pixelRatio=window.devicePixelRatio||1;this.isiPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone");this.isiPod=-1!=navigator.userAgent.toLowerCase().indexOf("ipod");
this.isiPhone4=2==this.pixelRatio&&this.isiPhone;this.isiPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad");this.isAndroid=-1!=navigator.userAgent.toLowerCase().indexOf("android");this.isFirefox=-1!=navigator.userAgent.toLowerCase().indexOf("firefox");this.isChrome=-1!=navigator.userAgent.toLowerCase().indexOf("chrome");this.isOpera=-1!=navigator.userAgent.toLowerCase().indexOf("opera");this.isTouch="undefined"!==window.ontouchstart;this.isiOS=this.isiPhone||this.iPad||this.isiPod;void 0!=
window.performance&&(this.hasMemoryProfiling=window.performance.memory);/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(this.ieVersion=new Number(RegExp.$1),this.isIE=!0);var b=new Audio;b.canPlayType("audio/ogg")&&(this.canPlayOgg=!0);b.canPlayType("audio/mpeg")&&(this.canPlayMP3=!0);b.canPlayType("audio/x-wav")&&(this.canPlayWav=!0);this.requestAnimFrame=function(){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(b){window.setTimeout(b,16,Date.now())};return function(e,f){b.apply(window,[e,f])}}()},canPlay:function(b){return"mp3"===b.toLowerCase()&&this.canPlayMP3||"ogg"===b.toLowerCase()&&this.canPlayOgg||"wav"===b.toLowerCase()&&this.canPlayWav?!0:!1},getUsedHeap:function(){return this.hasMemoryProfiling?window.performance.memory.usedJSHeapSize:0},getTotalHeap:function(){return this.hasMemoryProfiling?window.performance.memory.totalJSHeapSize:0}},{});
h5c3.HashList=h5c3.Base.extend("h5c3.HashList",{_CLASSNAME:"HashList",_CLASSVERSION:"0.4.4"},{hashtable:null,init:function(){this.hashtable=new h5c3.Hashtable},add:function(b,c){var e=this.hashtable.get(b);null==e&&(e=new pc.LinkedList,this.hashtable.put(b,e));e.add(c)},remove:function(b,c){var e=this.hashtable.get(b);if(null==e)throw"No list for a key in hashlist when removing";e.remove(c)},get:function(b){return this.hashtable.get(b)}});
h5c3.Hashtable=function(){function b(c){if("string"==typeof c)return c;if(typeof c.hashCode==m)return c=c.hashCode(),"string"==typeof c?c:b(c);if(typeof c.toString==m)return c.toString();try{return String(c)}catch(e){return Object.prototype.toString.call(c)}}function c(b,c){return b.equals(c)}function e(b,c){return typeof c.equals==m?c.equals(b):b===c}function f(b){return function(c){if(null===c)throw Error("null is not a valid "+b);if("undefined"==typeof c)throw Error(b+" must not be undefined");
}}function g(b,c,e,f){this[0]=b;this.entries=[];this.addEntry(c,e);null!==f&&(this.getEqualityFunction=function(){return f})}function h(b){return function(c){for(var e=this.entries.length,f,g=this.getEqualityFunction(c);e--;)if(f=this.entries[e],g(c,f[0]))switch(b){case t:return!0;case u:return f;case r:return[e,f[1]]}return!1}}function k(b){return function(c){for(var e=c.length,f=0,g=this.entries.length;f<g;++f)c[e+f]=this.entries[f][b]}}function l(b,c){var e=b[c];return e&&e instanceof g?e:null}
function n(c,e){var f=this,h=[],k={},r=typeof c==m?c:b,u=typeof e==m?e:null;this.put=function(b,c){w(b);v(c);var e=r(b),f,m=null;(f=l(k,e))?(e=f.getEntryForKey(b))?(m=e[1],e[1]=c):f.addEntry(b,c):(f=new g(e,b,c,u),h[h.length]=f,k[e]=f);return m};this.get=function(b){w(b);var c=r(b);if(c=l(k,c))if(b=c.getEntryForKey(b))return b[1];return null};this.containsKey=function(b){w(b);var c=r(b);return(c=l(k,c))?c.containsKey(b):!1};this.containsValue=function(b){v(b);for(var c=h.length;c--;)if(h[c].containsValue(b))return!0;
return!1};this.clear=function(){h.length=0;k={}};this.isEmpty=function(){return!h.length};var t=function(b){return function(){for(var c=[],e=h.length;e--;)h[e][b](c);return c}};this.keys=t("keys");this.values=t("values");this.entries=t("getEntries");this.remove=function(b){w(b);var c=r(b),e=null,f=l(k,c);if(f&&(e=f.removeEntryForKey(b),null!==e&&!f.entries.length)){a:{for(b=h.length;b--;)if(f=h[b],c===f[0])break a;b=null}p(h,b);delete k[c]}return e};this.size=function(){for(var b=0,c=h.length;c--;)b+=
h[c].entries.length;return b};this.each=function(b){for(var c=f.entries(),e=c.length,g;e--;)g=c[e],b(g[0],g[1])};this.putAll=function(b,c){for(var e=b.entries(),g,h,k,l=e.length,n=typeof c==m;l--;)g=e[l],h=g[0],g=g[1],n&&(k=f.get(h))&&(g=c(h,k,g)),f.put(h,g)};this.clone=function(){var b=new n(c,e);b.putAll(f);return b};this.toString=function(){for(var b="",c=this.keys(),e=0;e<c.length;e++)var f=this.get(c[e]),b=b+(c[e].toString()+" = "+f.toString()+"\n");return b}}var m="function",p=typeof Array.prototype.splice==
m?function(b,c){b.splice(c,1)}:function(b,c){var e,f,g;if(c===b.length-1)b.length=c;else for(e=b.slice(c+1),b.length=c,f=0,g=e.length;f<g;++f)b[c+f]=e[f]},w=f("key"),v=f("value"),t=0,u=1,r=2;g.prototype={getEqualityFunction:function(b){return typeof b.equals==m?c:e},getEntryForKey:h(u),getEntryAndIndexForKey:h(r),removeEntryForKey:function(b){return(b=this.getEntryAndIndexForKey(b))?(p(this.entries,b[0]),b[1]):null},addEntry:function(b,c){this.entries[this.entries.length]=[b,c]},keys:k(0),values:k(1),
getEntries:function(b){for(var c=b.length,e=0,f=this.entries.length;e<f;++e)b[c+e]=this.entries[e].slice(0)},containsKey:h(t),containsValue:function(b){for(var c=this.entries.length;c--;)if(b===this.entries[c][1])return!0;return!1}};return n}();h5c3.LinkedNode=h5c3.Base.extend("h5c3.LinkedNode",{_CLASSVERSION:"0.1.0"},{obj:null,nextLinked:null,prevLinked:null,free:!0,init:function(){this._super()},next:function(){return this.nextLinked},object:function(){return this.obj},prev:function(){return this.prevLinked}});
h5c3.LinkedList=h5c3.Base.extend("h5c3.LinkedList",{_CLASSNAME:"LinkedList",_CLASSVERSION:"0.1.0"},{first:null,last:null,count:0,objToNodeMap:null,init:function(){this._super();this.objToNodeMap=new h5c3.Hashtable},getNode:function(b){return this.objToNodeMap.get(b.getUniqueId())},addNode:function(b){var c=new h5c3.LinkedNode;c.obj=b;c.prevLinked=null;c.nextLinked=null;c.free=!1;this.objToNodeMap.put(b.getUniqueId(),c);return c},add:function(b){var c=this.getNode(b);if(null==c)c=this.addNode(b);else{if(!1===
c.free)throw"Attempting to add object: "+b.getUniqueId()+" twice to list "+this.getUniqueId();c.obj=b;c.free=!1;c.nextLinked=null;c.prevLinked=null}if(null==this.first)this.last=this.first=c,c.nextLinked=null,c.prevLinked=null;else{if(null==this.last)throw"Hmm, no last in the list -- that shouldn't happen here";this.last.nextLinked=c;c.prevLinked=this.last;this.last=c;c.nextLinked=null}this.count++;this.showDebug&&this.dump("after add")},has:function(b){b=this.getNode(b);return!(null===b||!0===b.free)},
moveUp:function(b){this.dump("before move up");b=this.getNode(b);if(!b)throw"Oops, trying to move an object that isn't in the list";if(null!=b.prevLinked){var c=b.prevLinked,e=c.prevLinked;b==this.last&&(this.last=c);var f=b.nextLinked;e&&(e.nextLinked=b);b.nextLinked=c;b.prevLinked=c.prevLinked;c.nextLinked=f;c.prevLinked=b;this.first==c&&(this.first=b)}},moveDown:function(b){b=this.getNode(b);if(!b)throw"Oops, trying to move an object that isn't in the list";if(null!=b.nextLinked){var c=b.nextLinked;
this.moveUp(c.obj);this.last==c&&(this.last=b)}},sort:function(b){for(var c=[],e=this.first;e;)c.push(e.object()),e=e.next();this.clear();c.sort(b);for(b=0;b<c.length;b++)this.add(c[b])},remove:function(b){this.showDebug&&this.dump("before remove of "+b);b=this.getNode(b);if(null===b||!0===b.free)return!1;null!=b.prevLinked&&(b.prevLinked.nextLinked=b.nextLinked);null!=b.nextLinked&&(b.nextLinked.prevLinked=b.prevLinked);null==b.prevLinked&&(this.first=b.nextLinked);null==b.nextLinked&&(this.last=
b.prevLinked);b.free=!0;b.prevLinked=null;b.nextLinked=null;this.count--;this.showDebug&&this.dump("after remove");return!0},clear:function(){for(var b=this.first;null!=b;)b.free=!0,b=b.nextLinked;this.first=null;this.count=0},length:function(){return this.count},dump:function(b){for(b=this.first;null!=b;)b=b.next()}});
h5c3.PerformanceMeasure=h5c3.Base.extend("h5c3.PerformanceMeasure",{_CLASSNAME:"PerformanceMeasure",_CLASSVERSION:"0.1.0",history:[],clearHistory:function(){history.length=0}},{timeStart:0,timeEnd:0,timeDelat:0,memStart:0,memEnd:0,memDelta:0,description:null,init:function(b){this.description=b;this.start();this.Class.history.push(this)},start:function(){this.timeStart=Date.now();this.memStart=h5c3.Device.getUsedHeap()},end:function(){this.timeEnd=Date.now();this.timeDelta=this.timeEnd-this.timeStart;
this.memEnd=h5c3.Device.getUsedHeap();this.memDelta=this.memEnd<this.memStart?0:this.memEnd-this.memStart;return this.toString()},toString:function(){return this.description+" took "+this.timeDelta+"ms, "+(0==this.memDelta?"unknown":this.memDelta)+" byte(s)"}});
h5c3.Pool=h5c3.Base.extend("h5c3.Pool",{_CLASSNAME:"Pool",_CLASSVERSION:"0.1.0",INITIAL_POOL_SIZE:1,pools:new h5c3.Hashtable,totalPooled:0,totalUsed:0,acquire:function(b){var c=this.getPool(b);if(void 0==c||null==c)c=new h5c3.Pool(b,this.INITIAL_POOL_SIZE),this.pools.put(b.fullName,c);return c.acquire()},release:function(b){var c=this.pools.get(b.Class.fullName);if(void 0==c)throw"Oops, trying to release an object of type "+b.Class.fullName+" but no pool exists. Did you new an object instead of using create.";
c.release(b)},getPool:function(b){return this.pools.get(b.fullName)},getStats:function(){for(var b="",c=this.pools.keys(),e=0;e<c.length;e++)var f=c[e],g=this.pools.get(f),b=b+(f+": "+g.getStats()+"\n");return b}},{freeList:null,expansion:1,traces:null,init:function(b,c){this._super();this.classType=b;this.freeList=[];this.expand(c)},startTracing:function(){this.tracing||(this.tracing=!0,this.traces?this.traces.clear():this.traces=new h5c3.Hashtable)},stopTracing:function(){this.tracing=!1},expand:function(b){h5c3.Pool.totalPooled+=
b;for(var c=0;c<b;c++)this.freeList.push(new this.classType)},getFreeCount:function(){return this.freeList.length},acquire:function(){0>=this.freeList.length&&(this.expansion=Math.round(1.2*this.expansion)+1,this.expand(this.expansion));if(this.tracing){for(var b=printStackTrace(),c=b.length-1;0==b[c].indexOf("Class.addTo")&&0<c;)c--;var e=this.traces.get(b[c]);null==e?this.traces.put(b[c],{value:1}):e.value++}return this.freeList.pop()},release:function(b){this.freeList.push(b)},getStats:function(){var b=
this.Class.fullName+" stats: "+this.freeList.length+" free.";if(this.tracing){var b=b+"TRACING\n",c=this.traces.keys(),e;for(e in c)b+=c[e]+" ("+this.traces.get(c[e]).value+")\n"}return b},dump:function(b){this.info("================== "+b+" ===================");this.info("FREE");this.freeList.dump()},size:function(){return this.freeList.length},getFreeList:function(){return this.freeList}});
h5c3.DualPool=h5c3.Pool.extend("h5c3.DualPool",{_CLASSNAME:"DualPool",_CLASSVERSION:"0.1.0",acquire:function(b){var c=this.getPool(b);if(void 0==c||null==c)c=new h5c3.DualPool(b,this.INITIAL_POOL_SIZE),this.pools.put(b.fullName,c);return c.acquire()},getStats:function(){for(var b="",c=this.pools.keys(),e=0;e<c.length;e++)var f=c[e],g=this.pools.get(f),b=b+(f+" (free: "+g.freeList.length()+" used: "+g.usedList.length()+")\n");return b}},{freeList:null,usedList:null,init:function(b,c){this.classType=
b;this.usedList=new h5c3.LinkedList;this.freeList=new h5c3.LinkedList;this.expand(c)},expand:function(b){h5c3.Pool.totalPooled+=b;for(var c=0;c<b;c++)this.freeList.add(new this.classType)},returnObj:null,acquire:function(){null==this.freeList.first&&this.expand(Math.round(this.size()/5)+1);this.returnObj=this.freeList.first.obj;this.freeList.remove(this.returnObj);this.returnObj.destroyed=!1;this.usedList.add(this.returnObj);if(this.tracing){for(var b=printStackTrace(),c=b.length-1;0==b[c].indexOf("Class.addTo")&&
0<c;)c--;var e=this.traces.get(b[c]);null==e?this.traces.put(b[c],{value:1}):e.value++}return this.returnObj},release:function(b){this.freeList.add(b);this.usedList.remove(b)},dump:function(b){this.info("================== "+b+" ===================");this.info("FREE");this.freeList.dump();this.info("USED");this.usedList.dump()},size:function(){return this.freeList.count+this.usedList.count},getUsedList:function(){return this.usedList}});
h5c3.Pooled=h5c3.Base.extend("h5c3.Pooled",{_CLASSNAME:"Pooled",_CLASSVERSION:"0.1.0",create:function(){return h5c3.Pool.acquire(this)},getPool:function(){return h5c3.Pool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease();h5c3.Pool.release(this)},onRelease:function(){}});
h5c3.DualPooled=h5c3.Base.extend("h5c3.DualPooled",{_CLASSNAME:"DualPooled",_CLASSVERSION:"0.1.0",create:function(){return h5c3.DualPool.acquire(this)},getPool:function(){return h5c3.DualPool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease();h5c3.DualPool.release(this)},onRelease:function(){}});h5c3.factories={};h5c3.plugin=new h5c3.Hashtable;h5c3.systems=new h5c3.Hashtable;h5c3.components=new h5c3.Hashtable;
h5c3.ErrorHandler=h5c3.Base.extend("h5c3.ErrorHandler",{_CLASSNAME:"ErrorHandler",_CLASSVERSION:"0.1.0",tag:function(){return this._CLASSNAME+" v"+this._CLASSVERSION}},{ready:!1,errArgs:null,done:!1,total:0,currOurs:!1,currType:null,currMSG:!1,currStack:!1,currCaller:!1,whoName:"",whoPath:"",init:function(){this._super();DOC().addEventListener("H5C3Error",h5c3.bind(this,this.onH5C3Error),!1);this.ready=!0},_handleWhatArray:function(b){if("Array"===ISA(b)){this.currType=1;var c=b.pop(),e=1<c.length?
c.pop():c;if(VLD(e)){"undefined"===ISA(e.message)?this.currMSG=c.toString():this.currMSG=e.__proto__.name+":"+e.message;"Array"!==ISA(c)&&(c=b);for(i=0;i<c.length;i++)if(loc=c[i].contains("@file:"))$tmp3=c[i].split("@file:"),c[i]=$tmp3[0];this.currStack=c;return b}}},reset:function(){this.total=0;this.currOurs=!1;this.currType=-1;this.currMSG="";this.currStack=!1;this.currCaller=""},who:function(){CHK(this.errArgs,null);CHK(this.whoName,"Unknown");for(i=0;i<this.errArgs.length;i++)"string"!==typeof this.errArgs[i]&&
(this.errArgs[i]._fullTypeName?(this.whoName=this.errArgs[i].fullName+"-"+this.errArgs[i]._CLASSVERSION,this.whoPath=this.errArgs[i]._fullTypeName):this.errArgs[i]._CLASSNAME?(this.whoName=this.errArgs[i]._CLASSNAME+"-"+this.errArgs[i]._CLASSVERSION,this.whoPath="h5c3"):CHK(this.whoName,"Unknown"));this.whoName=String.prototype.pad(this.whoName,30);this.whoPath=String.prototype.pad(this.whoPath,50)},what:function(){switch(this.errArgs.length){case 1:h5c3.isString(this.errArgs[0])?(this.currType=0,
this.currMSG=this.errArgs[0]):h5c3.isArray(this.errArgs[0])?this._handleWhatArray(this.errArgs[0]):h5c3.isH5C3(this.errArgs[0])?this.currType=2:h5c3.isObject(this.errArgs)?this.currType=3:h5c3.isFunction(this.errArgs)&&(this.currType=4);break;case 2:h5c3.isString(this.errArgs[0])&&(h5c3.isH5C3(this.errArgs[1])||h5c3.isObject(this.errArgs[1])||h5c3.isFunction(this.errArgs[1]))?(this.currType=0,this.who(this.errArgs[1]),this.currMSG=this.errArgs[0]):h5c3.isArray(this.errArgs[0])&&this._handleWhatArray(this.errArgs[0])}},
when:function(){},prepEmail:function(){return'<a href="mailto:support@i2tmlabs.com?subject=H5C3%20Error%20Report&body=What:'+this.whoName+"\nError:"+this.currMSG+"\nTrace:"+this.currStack.toString()+"\nDistro:"+h5c3.tag()+'\n">Is this our fault? Send It!</a>'},display:function(){switch(this.currType){case 0:console.log("411:%c%s %s > %s","color: green;",this.whoName,this.whoPath,this.currMSG);break;case 1:console.error("911:%cOH SNAP! - Sucks to be you right now.\n%s %s > %s\nTrace: %O","color: red;",
this.whoName,this.whoPath,this.currMSG,this.currStack)}},onH5C3Error:function(b){this.done=!1;this.reset();this.errArgs=b.arguments;this.what();this.who();this.display();this.done=!0}});h5c3.errorhandler=new h5c3.ErrorHandler;
h5c3.LZW=h5c3.Base.extend("h5c3.LZW",{_CLASSNAME:"LZW",_CLASSVERSION:"1.0.0"},{init:function(){this._super()},encode:function(b){var c={};b=(b+"").split("");for(var e=[],f,g=b[0],h=256,k=1;k<b.length;k++)f=b[k],null!=c[g+f]?g+=f:(e.push(1<g.length?c[g]:g.charCodeAt(0)),c[g+f]=h,h++,g=f);e.push(1<g.length?c[g]:g.charCodeAt(0));for(k=0;k<e.length;k++)e[k]=String.fromCharCode(e[k]);return e.join("")},decode:function(b){var c={};b=(b+"").split("");for(var e=b[0],f=e,g=[e],h=256,k,l=1;l<b.length;l++)k=
b[l].charCodeAt(0),k=256>k?b[l]:c[k]?c[k]:f+e,g.push(k),e=k.charAt(0),c[h]=f+e,h++,f=k;return g.join("")}});
h5c3.Tools=h5c3.Base.extend("h5c3.Tools",{_CLASSNAME:"Tools",_CLASSVERSION:"0.5.6",arrayRemove:function(b,c){for(var e=b.length-1;0<=e;e--)b[e]==c&&b.splice(e,1)},arrayExclusiveAdd:function(b,c){-1==b.indexOf(c)&&b.push(c)},mapDOM:function(b,c){function e(b,c){c.type=b.nodeName;var f=b.childNodes;if(null!=f&&f.length){c.content=[];for(var l=0;l<f.length;l++)3==f[l].nodeType?c.content.push(f[l].nodeValue):(c.content.push({}),e(f[l],c.content[c.content.length-1]))}if(null!=b.attributes&&b.attributes.length)for(c.attributes=
{},l=0;l<b.attributes.length;l++)c.attributes[b.attributes[l].nodeName]=b.attributes[l].nodeValue}var f={};"string"===typeof b&&(window.DOMParser?(parser=new DOMParser,docNode=parser.parseFromString(b,"text/xml")):(docNode=new ActiveXObject("Microsoft.XMLDOM"),docNode.async=!1,docNode.loadXML(b)),b=docNode.firstChild);e(b,f);return c?JSON.stringify(f):f},xmlToJson:function(b,c){var e={toObj:function(b){var c={};if(1==b.nodeType){if(b.attributes.length)for(var f=0;f<b.attributes.length;f++)c[b.attributes[f].nodeName]=
(b.attributes[f].nodeValue||"").toString();if(b.firstChild){for(var l=f=0,n=!1,m=b.firstChild;m;m=m.nextSibling)1==m.nodeType?n=!0:3==m.nodeType&&m.nodeValue.match(/[^ \f\n\r\t\v]/)?f++:4==m.nodeType&&l++;if(n)if(2>f&&2>l)for(e.removeWhite(b),m=b.firstChild;m;m=m.nextSibling)3==m.nodeType?c["#text"]=e.escape(m.nodeValue):4==m.nodeType?c["#cdata"]=e.escape(m.nodeValue):c[m.nodeName]?c[m.nodeName]instanceof Array?c[m.nodeName][c[m.nodeName].length]=e.toObj(m):c[m.nodeName]=[c[m.nodeName],e.toObj(m)]:
c[m.nodeName]=e.toObj(m);else b.attributes.length?c["#text"]=e.escape(e.innerXml(b)):c=e.escape(e.innerXml(b));else if(f)b.attributes.length?c["#text"]=e.escape(e.innerXml(b)):c=e.escape(e.innerXml(b));else if(l)if(1<l)c=e.escape(e.innerXml(b));else for(m=b.firstChild;m;m=m.nextSibling)c["#cdata"]=e.escape(m.nodeValue)}b.attributes.length||b.firstChild||(c=null)}else 9==b.nodeType?c=e.toObj(b.documentElement):alert("unhandled node type: "+b.nodeType);return c},toJson:function(b,c,f){var l=c?'"'+c+
'"':"";if(b instanceof Array){for(var n=0,m=b.length;n<m;n++)b[n]=e.toJson(b[n],"",f+"\t");l+=(c?":[":"[")+(1<b.length?"\n"+f+"\t"+b.join(",\n"+f+"\t")+"\n"+f:b.join(""))+"]"}else if(null==b)l+=(c&&":")+"null";else if("object"==typeof b){n=[];for(m in b)n[n.length]=e.toJson(b[m],m,f+"\t");l+=(c?":{":"{")+(1<n.length?"\n"+f+"\t"+n.join(",\n"+f+"\t")+"\n"+f:n.join(""))+"}"}else l="string"==typeof b?l+((c&&":")+'"'+b.toString()+'"'):l+((c&&":")+b.toString());return l},innerXml:function(b){var c="";if("innerHTML"in
b)c=b.innerHTML;else{var e=function(b){var c="";if(1==b.nodeType){for(var c=c+("<"+b.nodeName),f=0;f<b.attributes.length;f++)c+=" "+b.attributes[f].nodeName+'="'+(b.attributes[f].nodeValue||"").toString()+'"';if(b.firstChild){c+=">";for(f=b.firstChild;f;f=f.nextSibling)c+=e(f);c+="</"+b.nodeName+">"}else c+="/>"}else 3==b.nodeType?c+=b.nodeValue:4==b.nodeType&&(c+="<![CDATA["+b.nodeValue+"]]\x3e");return c};for(b=b.firstChild;b;b=b.nextSibling)c+=e(b)}return c},escape:function(b){return b.replace(/[\\]/g,
"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(b){b.normalize();for(var c=b.firstChild;c;)if(3==c.nodeType)if(c.nodeValue.match(/[^ \f\n\r\t\v]/))c=c.nextSibling;else{var f=c.nextSibling;b.removeChild(c);c=f}else 1==c.nodeType&&e.removeWhite(c),c=c.nextSibling;return b}};9==b.nodeType&&(b=b.documentElement);var f=e.toJson(e.toObj(e.removeWhite(b)),b.nodeName,"\t");return"{\n"+c+(c?f.replace(/\t/g,c):f.replace(/\t|\n/g,""))+"\n}"}},{});
h5c3.tools=new h5c3.Tools;
h5c3.Media=h5c3.Base.extend("h5c3.Media",{_CLASSNAME:"Media",_CLASSVERSION:"0.7.7",browser:{name:"Unknown",version:"Unknown"},OS:{name:"Unknown",version:"Unknown"},init:function(){this.browser.name=this.searchString(this.dataBrowser)||"Unknown";this.browser.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown";this.OS.name=this.searchString(this.dataOS)||"Unknown";this.OS.version=this.searchString(this.dataOS)||"Unknown"},searchString:function(b){for(var c=0;c<
b.length;c++){var e=b[c].string,f=b[c].prop;this.versionSearchString=b[c].versionSearch||b[c].identity;if(e){if(-1!=e.indexOf(b[c].subString))return b[c].identity}else if(f)return b[c].identity}},searchVersion:function(b){var c=b.indexOf(this.versionSearchString);if(-1!=c)return parseFloat(b.substring(c+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},
{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,
subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{prop:window.opera,identity:"Opera"}],dataOS:[{string:navigator.platform,subString:"Win64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"WOW64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"Win32",identity:"Windows 32Bit"},{string:navigator.platform,subString:"x86_64",identity:"Windows 64Bit"},{string:navigator.platform,
subString:"x86-64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"x64;",identity:"Windows 64Bit"},{string:navigator.platform,subString:"x64_64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"Win64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"Mac",identity:"Macintosh"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"},{string:navigator.platform,subString:"Android",
identity:"Android"}]},{});
h5c3.Hashmap=h5c3.Base.extend("h5c3.Hashmap",{_CLASSNAME:"Hashmap",_CLASSVERSION:"0.5.7"},{length:0,items:{},put:function(b,c){if(!VLD(b))throw"invaid key";this.items[b]=c;this.length++},get:function(b){return this.items[b]},hasKey:function(b){return this.items.hasOwnProperty(b)},remove:function(b){this.hasKey(b)&&(this.length--,delete this.items[b])},keys:function(){var b,c=[];for(b in this.items)c.push(b);return c},values:function(){var b,c=[];for(b in this.items)c.push(this.items[b]);return c},
clear:function(){this.items={};this.length=0}});
h5c3.LocalStorage=h5c3.Base.extend("h5c3.LocalStorage",{_CLASSNAME:"LocalStorage",_CLASSVERSION:"0.1.5",create:function(b){this._addMethods();return this._prepare(b)?this.prototype:!1},_addMethods:function(){Storage.prototype.setObject=function(b,c){var e=JSON.stringify(c);this.setItem(b,e)};Storage.prototype.getObject=function(b){b=this.getItem(b);if(VLD(b))return $tmp2=JSON.parse(b)}},setup:function(b){"String"===ISA(b)&&(VLD(this.prototype.data[b])||(this.prototype.data[b]={}),VLD(this.prototype.data[b].cfg)||
(this.prototype.data[b].cfg={}),VLD(this.prototype.data[b].files)||(this.prototype.data[b].files={}))},isSupported:function(){"undefined"!==typeof Storage?($msg+="Supported.",this.prototype.supported=!0):($msg+="Not Supported.",this.prototype.supported=!1);return this.prototype.supported},load:function(b){this.prototype.data.global=localStorage.getObject("global");this.prototype.data[b]=localStorage.getObject(b);this.setup("global");this.setup(b)},remove:function(b){this.enabled&&this.isSupported()&&
($use=0===b?"global":this.prototype.appName,localStorage.removeItem($use))},what_where:function(b){return 0===b?{where:"global",what:"cfg"}:1===b?{where:"global",what:"files"}:2===b?{where:this.prototype.appName,what:"cfg"}:3===b?{where:this.prototype.appName,what:"files"}:null},get:function(b,c){if(this.enabled&&this.isSupported()){$use=this.what_where(c);try{if(b in this.prototype.data[$use.where][$use.what])return this.prototype.data[$use.where][$use.what][b]}catch(e){localStorage.removeItem(this.prototype.data[$use.where][$use.what][b])}}return null},
set:function(b,c,e){if(this.enabled&&this.isSupported()){e=this.what_where(e);try{return this.prototype.data[e.where][e.what][b]=c,localStorage.setObject(e.where,this.prototype.data[e.where]),this.prototype.data[e.where][e.what][b]}catch(f){}}},_prepare:function(b){this.enabled&&this.isSupported()&&(this.prototype.appName=(new String(config.app.name.split(" ").join(""))).camelize(),this.load(this.prototype.appName),"firstVisit"in this.prototype.data.global.cfg||(this.set("firstVisit",!0,0),this.set("firstVisitTime",
Date.now(),0)),"firstVisit"in this.prototype.data[this.prototype.appName].cfg||(this.set("firstVisit",!0,2),this.set("firstVisitTime",Date.now(),2)));return!0}},{data:{},appName:"",supported:!1,enabled:!1,init:function(){this._super()},removeGlobal:function(){this.Class.remove(0)},removeApp:function(){this.Class.remove(1)},getGlobalCfg:function(b){return this.Class.get(b,0)},setGlobalCfg:function(b,c){this.Class.set(b,c,0)},getGlobalFile:function(b){return this.Class.get(b,1)},setGlobalFile:function(b,
c){this.Class.set(b,c,1)},getAppCfg:function(b){return this.Class.get(b,2)},setAppCfg:function(b,c){this.Class.set(b,c,2)},getAppFile:function(b){return this.Class.get(b,3)},setAppFile:function(b,c){this.Class.set(b,c,3)}});h5c3.AccuTimer=function(b,c,e,f){function g(){if(l++>=h)f(h,l);else{e(h,l,c);var b=(new Date).getTime()-n-l*k;window.setTimeout(g,k-b)}}0>=b&&(b=864E5);0>=c&&(c=1);var h=b/100*(c/10),k=b/h,l=0,n=(new Date).getTime();window.setTimeout(g,k)};
h5c3.CallMebackIn=function(b,c){if(VLD(c))return window.setTimeout(c,b)};h5c3.FactoryWorker=h5c3.Pooled.extend("h5c3.Applet",{_CLASSNAME:"FactoryWorker",_CLASSVERSION:"0.1.3",_lastUsed:0,create:function(b){var c=this._super();return c.parse(b)?c:c.name}},{});
h5c3.Factory=h5c3.Base.extend("h5c3.Factory",{_CLASSNAME:"Factory",_CLASSVERSION:"1.3.6"},{onChanged:function(){},objects:{},idleLifeSpan:0,count:0,init:function(b,c){this._super();CHK(b,"Undefined Factory");CHK(c,0);this.factoryType=b;this.setLife(c)},setLife:function(b){b*=1E3;this.idleLifeSpan!=b&&(this.idleLifeSpan=b)},create:function(){},add:function(b,c){if(VLD(c)){if("function"===typeof this.onChanged)this.onChanged({name:b,action:"Added"});this.objects[b]=c;this.count++;return this.objects[b]}},
remove:function(b){if(this.exists(b))try{if("function"===typeof this.onChanged)this.onChanged({name:b,action:"Removed"});delete this.objects[b];this.count--;0>this.count&&(this.count=0)}catch(c){AST(null,"No object ["+b+" exists in ["+this.factoryType+"] store to remove.")}},exists:function(b){return this.objects.hasOwnProperty(b)?!0:!1},use:function(b){null!=typeof b&&"object"===typeof b?b=this.exists(b.name)?this.objects[b.name]:this.create(b):(this.info("Factory::use(object) - No longer takes 2 params, use object format."),
b=null);return b}});h5c3.Plugin=h5c3.Base.extend("h5c3.Plugin",{_CLASSNAME:"Plugin",_CLASSVERSION:"0.5.9"},{NAME:"Plugin",VERSION:"0.1.0",DESCRIPTION:"Base class for all plugins.",srcDir:"js/",requires:[],uses:[],init:function(b){this._super();"object"===typeof b&&(this.property=b);this._load()},_load:function(){if(VLD(this.uses)&&0<this.uses.length)for(var b=0,b=0;b<$this.uses.length;b++)this.add($scripts[b])},main:function(b){CHK(b,{})},done:function(){}});
h5c3.Loader=h5c3.Base.extend("h5c3.Loader",{_CLASSNAME:"Loader",_CLASSVERSION:"0.6.3"},{State:{QUEUED:0,LOADING:1,READY:2,FAILED:3},timer:null,resources:new h5c3.Hashtable,loadingListener:null,loadedListener:null,progress:0,totalBeingLoaded:0,errored:0,baseUrl:"",times:{start:0,end:0,lapsed:0},started:!1,finished:!0,_noCacheString:"",init:function(){this._super();this.timer=new h5c3.AccuTimer(-1,0.5,function(){h5c3.loader.start()})},setDisableCache:function(){this._noCacheString="?nocache="+Date.now()},
setBaseUrl:function(b){this.baseUrl=b},setListener:function(b,c){this.loadingListener=b;this.loadedListener=c},loadFile:function(b){var c=null,e=b.substr(b.lastIndexOf(".")+1);"js"===e?(c=document.createElement("script"),c.setAttribute("type","text/javascript"),c.setAttribute("src",b)):"css"===e?(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",b)):"html"===e&&(c=document.createElement("applet"),c.setAttribute("type","text/html"),
c.setAttribute("href",b));"undefined"!==c&&document.getElementsByTagName("head")[0].appendChild(c)},add:function(b){b.name=b.name.toLowerCase();this.resources.put(b.name.toLowerCase(),{resource:b,state:this.State.QUEUED})},get:function(b){var c=this.resources.get(b.toLowerCase());VLD(c)||(this.error(this.uniqueId+"Unable to get resource "+b+". Did you forget to add it to the config?"),c=null);return c},getAllSounds:function(){var b=[],c=this.resources.keys(),e,f;for(e=0;e<c.length;e++)f=this.resources.get(c[e]).resource,
f.Class.isA("h5c3.Sound")&&b.push(f);return b},getAllImages:function(){var b=[],c=this.resources.keys(),e,f;for(e=0;e<c.length;e++)f=this.resources.get(c[e]),f.isA("h5c3.Image")&&b.push(f);return b},start:function(b,c){if(!this.started){this.started=!0;this.times.start=(new Date).getTime();var e,f,g;this.setListener(b,c);this.errored=this.progress=0;f=this.resources.keys();for(e=0;e<f.length;e++)g=this.resources.get(f[e]),g.state===this.State.QUEUED&&(g.resource.load(this._onLoad.bind(this),this._onError.bind(this)),
g.state=this.State.LOADING,this.totalBeingLoaded++)}},makeUrl:function(b){return this.baseUrl+b+this._noCacheString},_onLoad:function(b){var c=this.resources.get(b.name);VLD(c)?(c.state=this.State.READY,this.progress++,VLD(this.loadingListener)&&this.loadingListener(Math.round(100*(this.progress/this.totalBeingLoaded)))):this.error("Unable to get resource ["+b.name+"] - Please make sure you are using all lowercase.");this._checkAllDone()},_onError:function(b){this.resources.get(b.name).state=this.State.FAILED;
this.progress++;this.errored++;VLD(this.loadingListener)&&this.loadingListener(this.progress/this.totalBeingLoaded);this.warn(b.name+" ("+b.src+") failed.");this._checkAllDone()},_checkAllDone:function(){this.progress>=this.totalBeingLoaded&&(this.times.end=(new Date).getTime(),this.times.lapsed=this.times.start-this.times.end,this.finished=!0,this.started=!1,VLD(this.loadedListener)&&this.loadedListener(this.progress,this.errored),this.totalBeingLoaded=this.errored=this.progress=0)}});
h5c3.THROTTLESTYLE={RELAXED:0,STRICT:1,AGGRESSIVE:2,GEEZUS:3};
h5c3.Throttle=h5c3.Base.extend("h5c3.Throttle",{_CLASSNAME:"Throttle",_CLASSVERSION:"0.1.0",_style:h5c3.THROTTLESTYLE.STRICT,_AEPS:0,_current:0,_maximum:0,_minumum:0,_average:0,_interval:0,_throttle:null,_que:new h5c3.Hashtable,_reset:function(b,c,e){this._current=this._AEPS=0;this._maximum=b;this._minumum=c;this._average=Math.floor((b+c)/2);this._interval=e},_setStyle:function(b){if(this._style!==b){b<h5c3.THROTTLESTYLE.RELAXED&&(b=h5c3.THROTTLESTYLE.RELAXED);b<h5c3.THROTTLESTYLE.GEEZUS&&(b=h5c3.THROTTLESTYLE.GEEZUS);
this._style=b;switch(b){case THROTTLESTYLE.RELAXED:this._reset(11,20,10);break;case THROTTLESTYLE.STRICT:this._reset(6,10,5);break;case THROTTLESTYLE.AGGRESSIVE:this._reset(2.6,5,2.5);break;case THROTTLESTYLE.GEEZUS:this._reset(0,2.5,1.25)}this._evOnChanged()}},_evOnChanged:function(){this._stop();if("function"===typeof onChanged)this.onChanged(this._style);this._start()},_start:function(){this._running||(this._throttle=new h5c3.AccuTimer(this._interval,this._average,h5c3.bind(this,this._onProcess),
h5c3.bind(this,this._onEvaluate)),this._running=!0)},_stop:function(){this._running&&(delete this._throttle,this._running=!1)},_onProcess:function(){},_onEvaluate:function(){}},{init:function(b){this._super();this._setStyle(b)},add:function(b){var c=Date();c.getTime();c.toTimeString();this.que.put(c,b)},onProcess:function(){},onChanged:function(){}});
h5c3.Bootstrap=h5c3.Base.extend("h5c3.Bootstrap",{_CLASSNAME:"Bootstrap",_CLASSVERSION:"0.2.2"},{$baseUrl:"",$current:0,$finished:!1,$noCacheString:"",$scripts:[],init:function(){this.$loc=this.getFileName();this._BrowserIsChrome();this.setBaseUrl(h5c3.path.home+h5c3.path.scripts+"ext/");VLD(window.Modernizr)||this.add("modernizr.all.release.js");VLD(window.jQuery)||this.add("jquery/jquery-1.10.2.min.js");h5c3.devMode&&this.handleFiles();this._start()},prepareRWD:function(){h5c3.loader=new h5c3.Loader;
h5c3.lzw=new h5c3.LZW;h5c3.local=h5c3.LocalStorage.create();h5c3.resources=new h5c3.Resources;h5c3.r2wl=new h5c3.R2WLCommon;h5c3.r2wl.start();h5c3.loader.start();$(window).load(function(){});$(document).ready(function(){})},createCanvas:function(){var b=GEI("waDIV"),c=b.clientWidth,b=b.clientHeight,e=h5c3.config.screen.target.width,f=h5c3.config.screen.target.height,g=AET("waDIV","canvas","waCANVAS");g.style.width=c+"px";g.style.height=b+"px";g.style.minWidth=c+"px";g.style.minHeight=b+"px";g.style.maxWidth=
c+"px";g.style.maxHeight=b+"px";g.width=e;g.height=f;g.style.background="Black";h5c3.config.options.fullscreen&&(DOC().addEventListener("webkitfullscreenchange",h5c3.bootstrap._onFullscreenChange),g.webkitRequestFullScreen());return!0},handleFiles:function(){VLD(h5c3.config)&&(0<h5c3.config.files.length&&this.que(h5c3.config.files,"assets/js/"),0<h5c3.config.plugins.length&&this.loadPlugins(h5c3.config.plugins,h5c3.path.base+h5c3.path.plugins),h5c3.config.rwdOnly||this.que(["game.min.js"],"assets/js/"))},
getFileName:function(){var b=document.location.href,b=b.substring(0,-1===b.indexOf("#")?b.length:b.indexOf("#")),b=b.substring(0,-1===b.indexOf("?")?b.length:b.indexOf("?"));return b=b.substring(b.lastIndexOf("/")+1,b.length)},_onFullscreenChange:function(){var b=GEI("waCANVAS");document.mozFullScreen||document.webkitIsFullScreen?(b.style.width=window.screen.width+"px",b.style.height=window.screen.height+"px"):(b.style.width=h5c3.config.screen.width+"px",b.style.height=h5c3.config.screen.height+"px")},
_BrowserIsChrome:function(){var b=/chrome/.test(window.navigator.userAgent.toLowerCase()),c=GEI("playnow"),e=GEI("cantplay");if(null!=c&&null!=e){if(b)return c.style.display="block",e.style.display="none",!0;c.style.display="none";e.style.display="block";return!1}},setDisableCache:function(){this.$noCacheString=h5c3.config.devMode?"?nocache="+Date.now():""},setBaseUrl:function(b){this.$baseUrl=b},_makeUrl:function(b){return this.$baseUrl+b+this.$noCacheString},add:function(b){this.$scripts.push(this._makeUrl(b))},
_start:function(){this.$current=0;this._loadNextScript()},loadScript:function(b,c,e){if(!VLD(b)||""===b)return!1;b=this._makeUrl(b);var f=DOC().createElement("script");f.type="application/javascript";f.src=b;f.async=!1;f.onloaded=c;f.onerror=e;GET("head")[0].appendChild(f)},_loadNextScript:function(){var b=this.$scripts[this.$current],c=window.document.createElement("script");c.type="application/javascript";c.src=b;c.async=!1;VLD(b)&&(c.onload=function(){h5c3.bootstrap._checkAllDone()},window.document.getElementsByTagName("head")[0].appendChild(c))},
finalize:function(){this.createCanvas()&&(h5c3.device=new h5c3.Device,h5c3.device.boot())},_onReady:function(){this.prepareRWD();if(h5c3.r2wl.onReady)h5c3.r2wl.onReady();$("#OVERLAY").fadeOut(750,"linear",function(){$("#WRAPPER").fadeIn(1500,"ease-in")});"undefined"!=typeof window.H5C3READY&&window.H5C3READY(h5c3.VERSION,window.Modernizr._version,$().jquery)},_checkAllDone:function(){this.$finished||(this.$scripts.length-1===this.$current?(this._onReady(),this.$finished=!0,VLD(h5c3.config.rwdOnly)&&
!1===h5c3.config.rwdOnly&&this.finalize()):(this.$current++,this._loadNextScript()))},que:function(b,c){var e=0;this.setBaseUrl(c);for(e=0;e<b.length;e++)this.add(b[e])},loadPlugins:function(b,c){var e=0;this.setBaseUrl(c);for(e=0;e<b.length;e++)this.add(b[e]+".js")}});
window.h5c3.R2WLCommon=h5c3.Base.extend("h5c3.R2WLCommon",{_CLASSNAME:"R2WLCommon",_CLASSVERSION:"0.1.0"},{app:null,init:function(){this._super()},start:function(){var b=h5c3.r2wl.parseHeader(DOC().all[0].dataset);if(!b)return!1;this.brand=new h5c3.Brand;this.google=new h5c3.Google("UA-35732532-1");this.app=new h5c3.CloudApp(b);this.brand.start();this.google.start();this.app.start()},parseHeader:function(b){me=function(b){return b.role+" : "+b.name+" v"+b.version+"("+b.uuid+")"};if("DOMStringMap"===
ISA(b)){if(VLD(b.role)&&VLD(b.name)&&VLD(b.version)&&VLD(b.uuid)){$good=this.validUUID(b.uuid);if(!$good)return!1;"application"===b.role.toLowerCase()&&(CHK(b.layout,"absolute-all"),CHK(b.typo,"default"),CHK(b.skin,"default"),CHK(b.applet,"default"));return b}return!1}},makeHeader:function(b,c,e,f){VLD(b)||(b="applet");VLD(c)||(c="Noname");VLD(e)||(e="0.0.1");VLD(f)&&$$header.validUUID(f)||(f=$header.generateUUID());b="<div "+('\tdata-role="'+b+'" ')+('\tdata-name="'+c+'" ');b+='\tdata-version="'+
e+'" ';b+='\tdata-uuid="'+f+'" ';b+='\tdata-author="" ';b+='\tdata-copyright="" ';b+='\tdata-scale="1" ';return b+="/>\n"},compile:function(b){return h5c3.lzw.encode(encodeURIComponent(b))},decompile:function(b){return h5c3.lzw.decode(encodeURIComponent(b))},validUUID:function(b){if(VLD(b)&&""!==b&&4==b.split("-").length-1){if("1"==b.charAt(4)&&"9"==b.charAt(17)&&"6"==b.charAt(22)&&"9"==b.charAt(30))return!0;if("file:"===location.protocol&&h5c3.config.devMode)return!1}},generateUUID:function(){return"xxxx1xxx-xxxx-4xx9-yxx6-xxxxxx9xxxxx".replace(/[xy]/g,
function(b){var c=16*Math.random()|0;return("x"==b?c:c&3|8).toString(16)})},onReady:function(){}});
h5c3.Brand=h5c3.Base.extend("h5c3.Brand",{_CLASSNAME:"Brand",_CLASSVERSION:"0.0.2"},{init:function(){this._super()},update:function(){$("#h5c3built").text(h5c3.BUILT);$("#h5c3version").text(h5c3.DISTRO+"-"+h5c3.VERSION);!0===h5c3.devMode?$("#h5c3version").css("color","#FF0000"):$("#h5c3version").css("color","#ddffdd")},populate:function(){var b;b='<style id="h5c3-logo">#h5c3_logo {font-size:1em;display: block;}#hlmc {position: relative;display:block;top:0px;left:0px;width:100%;height:100%;font-family: Neuropol, sans-serif;text-transform: uppercase;text-align: center;}#h5c3_logo .c_H { display:inline; font-size: 100%; color: #e98900; }#h5c3_logo .c_5 { display:inline; font-size: 50%; color: #e98900; }#h5c3_logo .c_C { display:inline; font-size: 100%; color: #000beb; }#h5c3_logo .c_3\t{ display:inline; font-size: 50%; color: #000beb; }#h5c3_logo .w_FW { display:block; font-size: 42%; color: #444444;}</style>\n';b+=
"#i2tm_logo{font-size:3em;display:block;}#i2tm_logo .w_il{display:inline;font-size:100%;color:#00cc00;}";b+="#ilmc {position:relative;display:block;top:0px;left:0px;width:100%;height:100%;font-family:Neuropol,sans-serif;text-transform:uppercase;text-align:center;padding-top:6.25%;}</style>\n";h5c3.r2wl.app.stylesheet.add("brand-logos",b,"R2WL")},logoI2TM:function(b){b=CHK(b,4);return'<div id="i2tm_logo" data-role="applet" style="font-size:'+b+'em"><div id="ilmc"><div class="w_il backlight">i2tm Labs</div></div></div>\n'},
logoH5C3:function(b){b=CHK(b,4);return'<div id="h5c3_logo" class="animateIn" data-role="applet" style="font-size:'+b+'em"><div id="hlmc"><div class="c_H emboss backlight">H</div><div class="c_5 emboss backlight">5</div><div class="c_C emboss backlight">C</div><div class="c_3 emboss backlight">3</div><div class="w_FW emboss backlight">framework</div></div></div>\n'},youAreRunning:function(){var b;b='<h3 style="margin:0">You are running</h3>'+this.logoI2TM(4);b+=this.logoH5C3(5);b+='<p id="h5c3version" class="center">version</p>';
return b+='<p id="h5c3built" class="center">built on</p>'},poweredBy:function(b){b=CHK(b,0.5);return'<div style="font-size:'+b+"em;color:"+(h5c3.devMode?"red":"green")+';width:23%;letter-spacing:0.20em;position: relative;margin:0 auto">Powered By '+h5c3.tag()+"</div>"},start:function(){this.populate();this.update()}});
h5c3.Google=h5c3.Base.extend("h5c3.Google",{_CLASSNAME:"Google",_CLASSVERSION:"0.1.2"},{UID:"",enabled:!1,loaded:!1,version:"",domain:null,gaJsHost:null,init:function(b){this.gaJsHost="https:"==document.location.protocol?"https://ssl.":"http://www.";this.UID=b;"file:"!==document.location.protocol&&this.load(this.gaJsHost+"google-analytics.com/ga.js")},load:function(b){if(!0==this.enabled){var c=DOC().createElement("script");c.type="application/javascript";c.src=b;c.async=!0;c.onloaded=h5c3.bind(this,
this._onLoaded);c.onerror=h5c3.bind(this,this._onError);GET("head")[0].appendChild(c);window.setTimeout(function(){h5c3.google._onError()},5E3)}},push:function(){!0===this.enabled?(adsbygoogle=window.adsbygoogle||[]).push({}):ads=$(".adsbygoogle").css("background","#333")},track:function(){if(!0==this.enabled)try{window._gaq.push(["_setAccount",this.UID]),window._gaq.push(["_setDomainName",document.location.host]),window._gaq.push(["_addIgnoredOrganic",document.location.host]),window._gaq.push(["_trackPageview"])}catch(b){}},
getVersion:function(){try{var b=_gat._getTrackerByName();return VLD(this.version=b._getVersion())}catch(c){return!1}},lookForGoogle:function(){var b=document.getElementsByTagName("script"),c;for(c in b)"undefined"!==typeof b[c].src&&b[c].src.split("?")[0].match(/ga\.js$/)&&(this.loaded=!0,this.getVersion()&&(this.enabled=!0))},_onLoaded:function(){this.google.loaded=!0;this.onReady()},_onError:function(){h5c3.google.loaded=!1;h5c3.google.enabled=!1;this.lookForGoogle();h5c3.google.onReady()},start:function(){}});
h5c3.StyleSheet=h5c3.Base.extend("h5c3.StyleSheet",{_CLASSNAME:"Google",_CLASSVERSION:"0.1.0",_EMPCT:85,_FONTSIZE:16,_MODES:[{w:2560,f:19},{w:1920,f:18},{w:1600,f:17},{w:1440,f:16},{w:1366,f:15},{w:1280,f:14},{w:1024,f:13},{w:768,f:12},{w:480,f:11},{w:320,f:10}]},{r2wl:null,useMQ:!0,appLayout:"",mode:2,mobile:null,reloadRedraw:!1,resizeTimer:0,init:function(b,c){this._super();this.r2wl=c;this.createMediaQueries();this.checkScreenMode();this.initEvents();this.mobile=DOC().createElement("div")},start:function(){this.reviewResolution()},
add:function(b,c,e){""===c||(40>c.length||!VLD(b)||!VLD(e))||GEI(b)||(c=$(c),$(c).data("role",e),e=DOC().createElement("style"),e.id=b,e.type="text/css",e.innerHTML=$(c).text(),document.getElementsByTagName("head")[0].appendChild(e))},remove:function(b){VLD(b)},reviewResolution:function(){if((d=DOC().documentElement.dataset)&&h5c3.r2wl.app.layout.isValid(d.layout))return this.appLayout=d.layout,"absolute-all"===this.appLayout?this.setResolution(window.innerWidth-400):this.setResolution()},initEvents:function(){$(window).resize(function(){clearTimeout(h5c3.r2wl.app.stylesheet.resizeTimer);
h5c3.r2wl.app.stylesheet.resizeTimer=setTimeout(h5c3.r2wl.app.stylesheet._onResizeComplete,200)})},_onScreenSizeChanged:function(){"absolute"===this.layout&&(2>this.mode?($("#RIGHTBAR").css({display:"none",width:"0"}),$("#CONTENT").css({right:"0"})):($("#RIGHTBAR").css({display:"block",width:"12.5em"}),$("#CONTENT").css({right:"12.5em"})),1>this.mode?($("#LEFTBAR").css({display:"none",width:"0"}),$("#CONTENT").css({left:"0"})):($("#LEFTBAR").css({display:"block",width:"15em"}),$("#CONTENT").css({left:"15em"})))},
_onResizeComplete:function(){h5c3.r2wl.app.stylesheet.checkScreenMode();!0===this.reloadRedraw?h5c3.r2wl.app.stylesheet.forceRedraw():h5c3.r2wl.app.layout.reCalc()},forceRedraw:function(){GEI("WRAPPER").style.display="none";location.reload()},checkScreenMode:function(){var b=this.mode;721>window.innerWidth&&0!=b?this.mode=0:720<window.innerWidth&&961>window.innerWidth&&1!=b?this.mode=1:960<window.innerWidth&&1921>window.innerWidth&&2!=b?this.mode=2:1920<window.innerWidth&&3!=b&&(this.mode=3);this.mode!=
b&&this._onScreenSizeChanged()},getFontSize:function(){var b=GEI("WRAPPER");return VLD(b)?(b=window.getComputedStyle(b,null).getPropertyValue("font-size"),fontSize=parseFloat(b)):14},calcRWDValues:function(b){var c={scrn:b,gutter:1};c.em=this.getFontSize();this.mobile?c.full=c.outer=c.cellwidth=c.sixth=c.fourth=c.third=c.half=c.width=Math.floor(b/c.em):(c.width=Math.floor(b/c.em),c.full=c.outer=(0.9*b/c.em).toFixed(2),c.cellwidth=Math.floor(0.1*(c.outer-c.gutter)),c.sixth=(c.outer/6).toFixed(2),c.fourth=
(c.outer/4).toFixed(2),c.third=(c.outer/3).toFixed(2),c.half=(c.outer/2).toFixed(2));c.cellheight=Math.floor(0.1*(window.innerHeight/c.em-c.gutter));c.maxHeight=(window.innerHeight/c.em).toFixed(2);return c},onReady:function(){},createMediaQueries:function(){var b=14,c=((window.screen.availWidth-320)/10).toFixed(2),e='<style data-role="Application">\n';for(i=window.screen.availWidth;319<i;i-=c)e+="@media all and (max-width:"+i+"px) {body,#WRAPPER {font-size:"+b+"px;}}\n",b=(b-0.4).toFixed(2);this.add("Media-Queries",
e+"</style>\n","R2WL")},zoom:function(b,c){for(i=0;9>i&&(b=b.parentElement,-1===b.className.indexOf("r2wl_window "));i++);var e=b.dataset.zoom;VLD(e)||(e=1);c&&7>e?(e++,1<e&&(e=7)):1<e&&(e--,1>e&&(e=1));b.dataset.zoom=e},setResolution:function(b){VLD(b)||(b=window.innerWidth);this.calcRWDValues(b);b="<style data-role=\"Application\">[class*='pct'] {float:left;min-height:3em;min-width:4em}\n#waDIV {width:48em; height:27em;position:relative;}\n";b+="#waCanvas {width:100%;height:100%;}\n";b+=".h5c3_applet {width:0px;height:0px;display:none;}\n";
b+="#HEADER.normal,.HEADER,#LEFTBAR.normal,.LEFTBAR,#RIGHTBAR.normal,.RIGHTBAR,#FOOTER.normal,.FOOTER { background: rgba(255, 255, 255, 0.85); color: rgba(60, 100, 190, 0.85); }\n";b+="#HEADER.light,.HEADER,#LEFTBAR.light,.LEFTBAR,#RIGHTBAR.light,.RIGHTBAR,#FOOTER.light,.FOOTER { background: rgba(255, 255, 255, 0.85); color: rgba(60, 100, 190, 0.85); }\n";b+="#HEADER.dark,.HEADER,#LEFTBAR.dark,.LEFTBAR,#RIGHTBAR.dark,.RIGHTBAR,#FOOTER.dark,.FOOTER { background: rgba(255, 255, 255, 0.85); color: rgba(60, 100, 190, 0.85); }\n";
b+="</style>\n";this.add("common",b,"R2WL")}});
h5c3.Layout=h5c3.Base.extend("h5c3.Layout",{_CLASSNAME:"Layout",_CLASSVERSION:"0.1.0",_layouts:["standard","landing","absolute"]},{r2wl:null,layout:null,header:!1,leftbar:!1,rightbar:!1,footer:!1,dim:{t:5,b:2.5,l:15,r:12.5},init:function(b,c){this._super();this.r2wl=c;this.isValid(b)&&(this.layout=b)},start:function(){this.isValid(this.layout)?this.setLayout(this.layout):this.setLayout("standard")},isValid:function(b){if(!VLD(b))return!1;b.toLowerCase();b=b.split("-");return-1<this.Class._layouts.indexOf(b[0])},
setLayout:function(b){this.layout=b;b=b.split("-");for(i=0;i<b.length;i++)if("all"===b[i]){this.footer=this.rightbar=this.leftbar=this.header=!0;break}else"header"===b[i]?this.header=!0:"left"===b[i]?this.leftbar=!0:"right"===b[i]?this.rightbar=!0:"footer"===b[i]&&(this.footer=!0);this.absolute()},reCalc:function(){},absolute:function(){DOC().body.id="DESKTOP";if(11>document.body.innerHTML.length){var b,c,e=this.dim.t,f=this.dim.b,g=this.dim.l,h=this.dim.r;b="<style>#WRAPPER {position:absolute;min-height: 100%;min-width: 100%;height: 100% !important;height: 100% !important;overflow:hidden;}\n";
c='<div id="WRAPPER" data-type="application" data-layout="absolute">\n';VLD(this.r2wl.app.header.applet)?$applet='<div data-applet="'+this.r2wl.app.header.applet+'">':($applet='<div data-applet="none">',$applet+=this.r2wl.brand.logoI2TM(4),$applet+=this.r2wl.brand.logoH5C3(12),$applet+=this.r2wl.brand.poweredBy(1),$applet+='<p style="text-align:center"><br />Negative ghostrider!...You have not assigned a default applet.<br />Documentation can be found <a href="http://devzone.i2tmlabs.com/">HERE</a>.<p>',
$applet+="</div>");this.layout.header?(b+="#HEADER {position: fixed;z-index: 9999;width: 100% !important;top: 0;height:"+e+"em !important;}\n",c+='<div id="HEADER" ></div>\n'):e=0;c+='<div id="CONTENT">\n';this.layout.leftbar?(b+="#LEFTBAR {position:fixed;z-index: 9999;top:"+e+"em;bottom:"+f+"em;left:0px;width:"+g+"em;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;-o-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}\n",c+='<div id="LEFTBAR"></div>\t\n'):(g=0,b+="#LEFTBAR {position:fixed;z-index: 9999;top:"+
e+"em;bottom:"+f+"em;left:0px;width:"+g+"em;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;-o-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}\n");c+='<div id="VIEWPORT">'+$applet+"</div>\n";this.layout.rightbar?(b+="#RIGHTBAR {position:fixed;z-index: 9999;top:"+e+"em;bottom:"+f+"em;right:0px;width:"+h+"em;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;-o-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}\n",c+='<div id="RIGHTBAR"></div>\n'):
h=0;c+="</div>\x3c!-- CONTENT --\x3e\n";this.layout.footer?(b+="#FOOTER {position: fixed;z-index:9999;width:100%;height:"+f+"em !important;bottom:0;}\n",c+='<div id="FOOTER"></div>\n'):f=0;c+="</div>\n";b=b+("#CONTENT {position: absolute;right:"+h+"em;left:"+g+"em;top:"+e+"em;bottom:"+f+"em;padding:0em;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;-o-box-sizing: border-box;-ms-box-sizing: border-box;box-sizing: border-box;overflow: hidden;}\n")+"#VIEWPORT {width: 100%;height: 100%;overflow: auto;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;-o-box-sizing: border-box;-ms-box-sizing: border-box;box-sizing: border-box;}</style>\n";
this.r2wl.app.stylesheet.add(this.layout,b,"R2WL");document.body.innerHTML=c}}});h5c3.SmartMenu=h5c3.Base.extend("h5c3.SmartMenu",{_CLASSNAME:"SmartMenu",_CLASSVERSION:"0.0.1"},{$_menu:null,init:function(){this._super();"object"===typeof h5c3.config.smartmenu&&(this.$_menu=h5c3.config.smartmenu)}});
h5c3.Applet=h5c3.Pooled.extend("h5c3.Applet",{_CLASSNAME:"Applet",_CLASSVERSION:"0.1.0",params:{required:["role","name","version","uuid"],optional:["author","copyright","scale"]},hasChildren:!1,children:[],create:function(b){var c=this._super();if("Object:Simple"===ISA(b)&&null!==b.header.name)for(var e in b)c[e]=b[e];return c.parse(b)?c:c.name}},{style:"",script:"",html:"",src:null,header:{name:null,version:"",uuid:"",role:"",author:"",copyright:""},created:0,accessed:0,ready:!1,loaded:!1,active:!1,
init:function(){this._super()},scanForApplets:function(b){var c=!1;CHK(b,"");"self"===b?(b=this.$html,c=!0):b=VLD(b)?$(b):$("body");if(!VLD(b))return 0;b=$(b).find("div").filter(function(b){return void 0!==$(this).data("applet")});c&&0<b.length&&(this.hasChildren=!0);return b},embed:function(b,c){$("div[data-applet='"+this.header.name+"']").append(b);this.active=!0;this.setDraggable()},unbed:function(){this.active&&(this.active=!1)},setDraggable:function(){$(function(){$("#VIEWPORT").on("mousedown",
"div",function(){!0===this.draggable?($(this).addClass("draggable"),$(this).addClass("dragging").parents().on("mousemove",function(b){$(".dragging").offset({top:b.pageY-$(".dragging").outerHeight()/2,left:b.pageX-$(".dragging").outerWidth()/2}).on("mouseup",function(){$(this).removeClass("dragging")});"undefined"!=typeof b&&b.preventDefault()})):($(".draggable").removeClass("draggable"),$(this).removeClass("dragging"))}).on("mouseup",function(){$(".draggable").removeClass("draggable")})})},parse:function(b){var c=
null;if("Object:Simple"!==ISA(b)||null===b.header.name){c=$(b);this.header=h5c3.r2wl.parseHeader(c[0].dataset);if(!this.header)return!1;b=$(b).not("comment").not("text")}for(i=0;i<b.length;i++)"applet"===b[i].dataset.role&&"content"===b[i].dataset.type?this.html=b[i].outerHTML:"applet"===b[i].dataset.role&&"style"===b[i].dataset.type?this.style=b[i].outerHTML:"applet"===b[i].dataset.role&&"script"===b[i].dataset.type&&(this.script=b[i].outerHTML);this.style&&h5c3.r2wl.app.stylesheet.add(this.header.name,
this.style,"Applet");this.script&&h5c3.r2wl.app.stylesheet.add(this.header.name,this.script,"Applet");this.html&&this.embed(this.html);return!0},makeHeader:function(b,c,e,f){VLD(b)||(b="applet");VLD(c)||(c="Noname");VLD(e)||(e="0.0.1");VLD(f)&&h5c3.r2wl.validUUID(f)||(f=h5c3.r2wl.generateUUID());b="<div "+('\tdata-role="'+b+'" ')+('\tdata-name="'+c+'" ');b+='\tdata-version="'+e+'" ';b+='\tdata-uuid="'+f+'" ';b+='\tdata-author="" ';b+='\tdata-copyright="" ';b+='\tdata-scale="1" ';return b+="/>\n"},
parseStyle:function(b){return $(b).filter("style").each(function(b){h5c3.r2wl.app.stylesheet.add(this.header.name,this.outerHTML,"Applet");return this.outerHTML.toString()})},parseScript:function(b){return $(b).filter("script").each(function(b){h5c3.r2wl.app.stylesheet.add(this.header.name,this.outerHTML,"Applet");return this.outerHTML.toString()})},verify:function(b,c){var e,f="Validating->";e=0;VLD(b.dataset.role)||(f+="Missing data-role->",c?(b.dataset.role="applet",f+="Fixed->"):e++);VLD(b.dataset.name)?
""===b.dataset.name&&(f+="data-name is empty->",c?(b.dataset.name="GIVE_ME_A_NAME",f+="Fixed->"):e++):(f+="Missing data-name->",c?(b.dataset.name="GIVE_ME_A_NAME",f+="Fixed->"):e++);VLD(b.dataset.version)?""===b.dataset.version&&(f+="data-version is empty->",c?(b.dataset.name="0.0.1",f+="Fixed->"):e++):(f+="Missing data-version->",c?(b.dataset.version="0.0.1",f+="Fixed->"):e++);h5c3.r2wl.validUUID(b.dataset.uuid)||(f+="Missing data-uuid->",c?f=(b.dataset.uuid=h5c3.r2wl.generateUUID())?f+"Created UUID->":
f+"Aborted: Unable to generateUUID.":e++);f=(0===e&&!0!=c?f+"PERFECT!->":f+("Failed ("+e+") issues->"))+"Done.";return{result:e,message:f,applet:b}}});
h5c3.AppletFactory=h5c3.Factory.extend("h5c3.AppletFactory",{_CLASSNAME:"AppletFactory",_CLASSVERSION:"0.3.1",getAppletPath:function(b){return b&&""!=h5c3.config.options.path?h5c3.config.options.path+"applets/":h5c3.path.home+h5c3.path.applets}},{_scanned:[],_history:[],_loadQue:[],started:!1,r2wl:null,style:null,layout:null,_tracker:{failed:0,loading:0,loaded:0,fromConn:0,fromCache:0,loops:0,indexed:!1},throttle:null,init:function(b){this._super("Applet");this.r2wl=b},create:function(b){return this.requestApplet(b)},
add:function(b,c){this._super(b,c)},reset:function(){this._loadQue=[];this._tracker={failed:0,loading:0,loaded:0,fromConn:0,fromCache:0,loops:0}},stop:function(){this.started=!1},start:function(){this.started||(this.reset(),this.started=!0)},onHREFClick:function(b){try{h5c3.r2wl.app.applets.setpage(this.name)}catch(c){AST(null,printStackTrace({e:c}))}},setpage:function(b){try{var c=h5c3.r2wl.app.applets.use({name:b});if(c){var e=c.scanForApplets("self");for(i=0;i<e.length;i++){var f=$(e[i]).attr("data-applet");
h5c3.r2wl.app.applets.use({name:f});$("div[data-applet='"+this.header.name+"']").append($html)}"0"!=$("#VIEWPORT").css("opacity")&&(this.lastContent=GEI("VIEWPORT").innerHTML,$("#VIEWPORT").fadeOut(250,function(){GEI("VIEWPORT").innerHTML=c.html;$("#VIEWPORT").fadeIn(250,"linear")}),h5c3.local.setAppCfg("currentPage",c.name))}}catch(g){AST(null,printStackTrace({e:g}))}},scanAnchors:function(b){var c=0,e=0,f=0;b=VLD(b)?$(b):$("body");if(""!=b[0].id&&(b=b[0].id,-1!=this._scanned.indexOf(b)))return!0;
b=GET("a");for(i=0;i<b.length;i++)if(""!=b[i].hash){var g=b[i].hash.split(".");"#applet"==g[0]&&""!=g[1]&&(b[i].addEventListener("click",this.onHREFClick,!1),-1===this._scanned.indexOf(g[1])?(this._loadQue.push(g[1]),this._scanned.push(g[1]),f++):e++,b[i].name=g[1],c++)}return c},scanHTML:function(b){var c;c=VLD(b)?!1:!0;b=h5c3.Applet.prototype.scanForApplets(b);for(i=0;i<b.length;i++)b[i].style.display=!0===c?"block":"none",this._loadQue.push(b[i].dataset.applet);this._tracker.loading=this._loadQue.length},
checkQue:function(){if(0>=this._loadQue.length){var b=h5c3.local.getAppCfg("currentPage");VLD(b)&&this.setpage(b);return!0}2<this._loadQue.length&&(this._loadQue=this._loadQue.filter(function(b,e){return h5c3.r2wl.app.applets._loadQue.indexOf(b)==e}));this._tracker.loading=this._loadQue.length;b=this._loadQue.shift();this.requestApplet({name:b})},requestApplet:function(b){if(!VLD(b))return!1;var c=!1,e=h5c3.local.getAppFile(b.name);VLD(e)&&(this.onLoad(e),c=!0);e=this._history[b.name];if("undefined"!=
typeof e){this._tracker.fromCache++;if(VLD(e.div))this.onLoad(e.div);this.checkQue();return!0}this._history[b.name]={name:b.name,src:this.Class.getAppletPath(1)+"applet."+b.name+".html",div:b.div};if(!c)try{h5c3.XHR(this._history[b.name].src,h5c3.bind(this,this.onLoad),h5c3.bind(this,this.onError))}catch(f){AST(null,printStackTrace({e:f}))}},_checkAllDone:function(){if(0>=this._loadQue.length)return this.stop(),!0;this.checkQue();this._tracker.loops++;return this._tracker.loops>this._tracker.loading?
!0:!1},onLoad:function(b){if(""===b)return!1;var c;ISA(b);c="Object:Simple"===ISA(b)?!0:!1;b=h5c3.Applet.create(b);this._tracker.loaded++;this._tracker.loading--;"object"===typeof b?(c?b.header.name in this._history&&"undefined"!==typeof this._history[b.header.name].src&&(b.src=this._history[b.header.name].src):h5c3.local.setAppFile(b.header.name,b),this._tracker.fromConn++,this.scanHTML(b.html),this.scanAnchors(b.html),$result=h5c3.r2wl.app.applets.add(b.header.name,b)):(this._tracker.failed++,delete this._history[b],
this.remove(b),$result=!1);this.started=!this._checkAllDone();return $result},onError:function(b){return null},onReady:function(){this.started||(this.scanHTML(),this.scanAnchors(),this.checkQue())}});
window.h5c3.CloudApp=h5c3.Base.extend("h5c3.CloudApp",{_CLASSNAME:"CloudApp",_CLASSVERSION:"0.0.0"},{header:null,skin:{fg:{light:"#cccccc",normal:"#808080",dark:"#303030"},bg:{light:"#aaaaaa",normal:"#404040",dark:"#000000"}},colorOverride:!1,init:function(b){this._super();this.header=b;this.prepare()},prepare:function(){this.skin=(this.colorOverride=CHK(h5c3.local.getGlobalCfg("colorOverride"),!1))?CHK(h5c3.local.getGlobalCfg("mySkin"),this.skin):CHK(h5c3.local.getAppCfg("skin"),this.skin);this.applets=
new h5c3.AppletFactory(h5c3.r2wl);this.stylesheet=new h5c3.StyleSheet(this.header.style,h5c3.r2wl);this.layout=new h5c3.Layout(this.header.layout,h5c3.r2wl)},save:function(){h5c3.local.setGlobalCfg("colorOverride",this.colorOverride);h5c3.local.setAppCfg("skin",this.skin)},start:function(){this.stylesheet.start();this.layout.start();if(this.applets.onReady)this.applets.onReady();window.APP=this},createWindow:function(b,c){ISA(b);"object"!==ISA(c)&&(c={id:"window",height:"17.14em",width:"22.85em",
title:"Unamed Window",statusbar:"",body:"",color:"clr-dark"});var e=DOC.createElement("div");e.id=c.id;e.className="r2wl_window "+c.color;$html='<div class="r2wl_window.r2wl_titleBar">\n';$html+='<div class="r2wl_title left"><span id="windowName">'+$title+"</span></div>\n";$html+='<div class="icons right">\n';$html+='<i class="icon icon-move uiButton"></i>\n';$html+='<i class="icon icon-collapse-alt uiButton"></i>\n';$html+='<i class="icon icon-expand-alt uiButton"></i>\n';$html+="</div>\n";$html+=
"</div>\n";$html+='<div id="windowBody" class="r2wl_body">'+$body+"</div>\n";$html+='<div class="r2wl_statusBar">\n';$html+='<div id="windowStatusBar">'+$status+"</div>\n";$html+="</div>\n";e.innerHTML=$html},zoomIn:function(b){return this.stylesheet.zoom(b,1)},zoomOut:function(b){return this.stylesheet.zoom(b,0)},onReady:function(){}});
h5c3.Image=h5c3.Base.extend("h5c3.Image",{_CLASSNAME:"Image",_CLASSVERSION:"0.1.0"},{width:0,height:0,image:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,scaleX:1,scaleY:1,alpha:1,compositeOperation:null,init:function(b,c,e,f){this._super();this.name=b;this.src=h5c3.loader.makeUrl(c);this.image=new Image;this.onLoadCallback=e;this.onErrorCallback=f;this.image.onload=this._onLoad.bind(this);this.image.onerror=this._onError.bind(this);this.alpha=this.scaleY=this.scaleX=
1;h5c3.loader.started&&this.load()},setAlpha:function(b){this.alpha=b},setScale:function(b,c){this.scaleX=b;this.scaleY=c},setCompositeOperation:function(b){this.compositeOperation=b},load:function(b,c){this.onLoadCallback=b;this.onErrorCallback=c;if(this.loaded&&b)this.onLoadCallback(this);this.image.onload=this._onLoad.bind(this);this.image.onerror=this._onError.bind(this);this.image.src=this.src},reload:function(){this.loaded=!1;this.load()},draw:function(b,c,e,f,g,h,k,l){null!=this.compositeOperation&&
(b.globalCompositeOperation=this.compositeOperation);3==arguments.length?(b.save(),1!=this.alpha&&(b.globalAlpha=this.alpha),b.translate(c+this.width/2,e+this.height/2),b.scale(this.scaleX,this.scaleY),b.drawImage(this.image,0,0,this.width,this.height,-this.width/2,-this.height/2,this.width,this.height)):VLD(l)?(b.save(),1!=this.alpha&&(b.globalAlpha=this.alpha),0>this.scaleX||0>this.scaleY?b.translate(f+h/2*(1==this.scaleX?0:this.scaleX),g+k/2*(1==this.scaleY?0:this.scaleY)):b.translate(f+h/2,g+
k/2),b.rotate(l*(Math.PI/180)),b.scale(this.scaleX,this.scaleY),b.drawImage(this.image,c,e,h,k,-h/2,-k/2,h,k)):(b.save(),1!=this.alpha&&(b.globalAlpha=this.alpha),0>this.scaleX||0>this.scaleY?b.translate(f+-(h/2)*(1==this.scaleX?0:this.scaleX),g+-(k/2)*(1==this.scaleY?0:this.scaleY)):b.translate(f,g),b.scale(this.scaleX,this.scaleY),b.drawImage(this.image,c,e,h,k,0,0,h,k));b.restore();null!=this.compositeOperation&&(b.globalCompositeOperation="source-over");h5c3.device.elementsDrawn++},_onLoad:function(){this.loaded=
!0;this.width=this.image.width;this.height=this.image.height;if(this.onLoadCallback)this.onLoadCallback(this)},_onError:function(){if(this.onErrorCallback)this.onErrorCallback(this)},expand:function(b,c){this.image.width=this.width+b;this.image.height=this.height+c;this.width=this.image.width;this.height=this.image.height},resize:function(b,c){var e=this.width*b,f=this.height*c,g=document.createElement("canvas");g.width=this.width;g.height=this.height;var h=document.createElement("canvas");h.width=
e;h.height=f;var k=h.getContext("2d"),l=k.getImageData(0,0,e,f),g=g.getContext("2d");g.drawImage(this.image,0,0,this.width,this.height,0,0,this.width,this.height);for(var g=g.getImageData(0,0,this.width,this.height),n=0;n<f;n++)for(var m=0;m<e;m++)for(var p=4*(Math.floor(n/c)*this.width+Math.floor(m/b)),w=4*(n*e+m),v=0;4>v;v++)l.data[w+v]=g.data[p+v];k.putImageData(l,0,0);this.image=h;return this}});
h5c3.CanvasImage=h5c3.Base.extend("h5c3.CanvasImage",{},{width:0,height:0,canvas:null,loaded:!0,scaleX:1,scaleY:1,init:function(b){this.canvas=b;this.width=b.width;this.height=b.height},draw:function(b,c,e,f,g,h,k){void 0==h||void 0==k||0==h||0==k?b.drawImage(this.canvas,c,e):b.drawImage(this.canvas,c,e,h,k,f*this.scaleX,g*this.scaleY,h*this.scaleX,k*this.scaleY)},setScale:function(b,c){this.scaleX=b;this.scaleY=c}});
h5c3.ImageTools=h5c3.Base.extend("h5c3.ImageTools",{rotate:function(b,c,e,f){var g=document.createElement("canvas");g.width=c*f;g.height=e;for(var h=g.getContext("2d"),k=0;k<f;k++)h.save(),h.translate(k*c+c/2,e/2),h.rotate(360/f*k*(Math.PI/180)),h.drawImage(b,-(c/2),-(e/2)),h.restore();return new h5c3.CanvasImage(g)}},{});
h5c3.Sound=h5c3.Base.extend("h5c3.Sound",{_CLASSNAME:"SoundFactory",_CLASSVERSION:"0.1.2"},{sounds:[],src:null,name:null,numLoaded:0,loaded:!1,errored:!1,channels:1,onLoadCallback:null,onErrorCallback:null,init:function(b,c,e,f,g,h){this._super();this.name=b;this.channels=f;b=!1;for(f=0;f<e.length;f++)if(h5c3.device.canPlay(e[f])){this.src=h5c3.loader.makeUrl(c+"."+e[f]);b=!0;break}b?h5c3.loader.started&&this.load(g,h):this.errored=!0},pause:function(){if(this.canPlay())for(var b=0,c=this.sounds.length;b<
c;b++)this.sounds[b].pause()},stop:function(){this.canPlay()&&this.pause()},setVolume:function(b){if(this.canPlay())for(var c=0,e=this.sounds.length;c<e;c++)this.sounds[c].volume=b},setLoop:function(b){if(this.canPlay())for(var c=0,e=this.sounds.length;c<e;c++)this.sounds[c].loop=b},getDuration:function(){return this.canPlay()?this.sounds[0].duration:-1},setPlaybackRate:function(b){if(this.canPlay())for(var c=0,e=this.sounds.length;c<e;c++)this.sounds[c].playbackRate=b},setPlayPosition:function(b){if(this.canPlay())for(var c=
0,e=this.sounds.length;c<e;c++)this.sounds[c].currentTime=b},load:function(b,c){this.onLoadCallback=b;this.onErrorCallback=c;if(this.loaded&&b)this.onLoadCallback(this);else for(var e=0;e<this.channels;e++){var f=new Audio;f.preload="auto";f.addEventListener("canplaythrough",this.onLoad.bind(this),!1);f.addEventListener("error",this.onError.bind(this),!1);f.onerror=this.onError.bind(this);f.onload=this.onLoad.bind(this);f.src=this.src;f.load();this.sounds.push(f);if(h5c3.device.isAppMobi)this.onLoad(null)}},
reload:function(){this.errored=this.loaded=!1;this.load()},onLoad:function(b){this.numLoaded++;h5c3.device.isAppMobi||b.target.removeEventListener("canplaythrough",this.onLoad.bind(this),!1);if(this.numLoaded==this.channels&&(this.loaded=!0,this.errored=!1,this.onLoadCallback))this.onLoadCallback(this)},onError:function(){this.errored=!0;this.loaded=!1;if(this.onErrorCallback)this.onErrorCallback(this)},play:function(b){if(!this.canPlay())return null;for(var c=0,e=this.sounds.length;c<e;c++)if(this.sounds[c].paused||
this.sounds[c].ended)return b&&(this.sounds[c].loop=!0),this.sounds[c].play(),this.sounds[c];this.warn(this.name+" - all channels are in use");return null},canPlay:function(){return this.loaded&&h5c3.device.soundEnabled&&!this.errored}});
h5c3.SoundFactory=h5c3.Factory.extend("h5c3.SoundFactory",{_CLASSNAME:"SoundFactory",_CLASSVERSION:"0.1.2"},{init:function(){this._super("Sound")},create:function(b,c){CHK(c,{volume:0.5,loop:!1});var e=h5c3.loader.get(b).resource;e.setVolume(c.volume);e.setLoop(c.loop);return this.add(b,e)},play:function(b,c){this.use(b,c).play(c.loop)}});
h5c3.DataResource=h5c3.Base.extend("h5c3.DataResource",{_CLASSNAME:"DataResource",_CLASSVERSION:"0.1.0"},{data:null,request:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,init:function(b,c,e,f){this._super();this.src=h5c3.loader.makeUrl(c);this.name=b;this.onLoadCallback=e;this.onErrorCallback=f;this.request=new XMLHttpRequest;this.request.onreadystatechange=this.onReadyStateChange.bind(this);this.request.onload=this.onReadyStateChange.bind(this);this.request.onloadend=
this.onReadyStateChange.bind(this);this.load()},load:function(b,c){this.onLoadCallback=b;this.onErrorCallback=c;try{this.request.open("get",this.src),this.request.send(null)}catch(e){}finally{}},reload:function(){this.loaded=!1;this.load()},onReadyStateChange:function(){if(!this.loaded&&4===this.request.readyState)if(200===this.request.status){if(this.loaded=!0,this.data=this.request.responseText,this.onLoadCallback)this.onLoadCallback(this)}else if(404===this.request.status&&(this.warn("resource "+
this.src+" error "+this.request.status),this.onErrorCallback))this.onErrorCallback(this)}});
h5c3.Resources=h5c3.Base.extend("h5c3.Resources",{_CLASSNAME:"Resources",_CLASSVERSION:"0.3.3"},{resources:null,init:function(){this._super();this.loadResources()},loadResources:function(){this.loadGraphics();this.loadAudio()},loadGraphics:function(){if(VLD(h5c3.config.resources)){var b,c=h5c3.config.resources.images;for(b=0;b<c.length;++b)h5c3.loader.add(new h5c3.Image(c[b].name,c[b].file))}},loadAudio:function(){if(VLD(h5c3.config.resources)){var b,c,e,f=h5c3.config.resources.sounds;for(b=0;b<f.length;b++)c=
"true"===f[b].ogg?"ogg":"",e="true"===f[b].mp3?"mp3":"",h5c3.loader.add(new h5c3.Sound(f[b].name,f[b].file,[c,e],f[b].channels))}}});h5c3.SCREEN_CELLS={GRIDX1:0,GRIDX2:1,GRIDX3:2,GRIDX4:4,GRIDX5:8};
h5c3.Device=h5c3.Base.extend("h5c3.Device",{_CLASSNAME:"Device",_CLASSVERSION:"0.1.0"},{device:h5c3.Device,media:h5c3.Media,page:null,loader:null,input:null,inputTimer:null,processTimer:null,xmlParser:null,resourcesLoaded:!1,started:!1,running:!0,fps:30,currentFPS:0,averageFPS:0,totalFPS:0,frameCount:0,tick:0,enablePooling:!0,soundEnabled:!0,elementsDrawn:0,lastProcessMS:0,lastDrawMS:0,elapsed:0,lastFrame:0,now:Date.now(),startTime:0,screen:null,pixelRatio:h5c3.Device.pixelRatio,isiPhone:h5c3.Device.isiPhone,
isiPhone4:h5c3.Device.isiPhone4,isiPad:h5c3.Device.isiPad,isAndroid:h5c3.Device.isAndroid,isTouch:h5c3.Device.isTouch,useTouch:h5c3.Device.useTouch,isiOS:h5c3.Device.isiOS,isiPod:h5c3.Device.isiPod,showDebug:h5c3.devMode,devMode:h5c3.devMode,gameScreenCells:1,init:function(){this._super();this.loader=h5c3.loader;this.input=new h5c3.Input},boot:function(){this.page=new h5c3.Page(this,"H5C3 Unanamed App");this.game=this.page.game;this.tick=1E3/this.fps;this.requestAnimFrame=h5c3.Device.requestAnimFrame;
this.onReady()},initLayout:function(){this.layout={cells:h5c3.SCREEN_CELLS.GRIDX1}},canPlay:function(b){return h5c3.Device.canPlay(b)},onReady:function(){this.started||(this.page.onReady(),this.input._onReady(),this.lastFrame=Date.now(),window.requestAnimationFrame(this.render.bind(this)),this.handleTimers(!0),this.started=!0)},onExit:function(){this.handleTimers(!1);window.cancelAnimationFrame(!0)},handleTimers:function(b){!0===b?(this.inputTimer=new h5c3.AccuTimer(0,6,function(b,e,f){h5c3.device.input.process()}),
this.processTimer=new h5c3.AccuTimer(0,30,function(b,e,f){h5c3.device.running=!h5c3.device.page.game.obj.process()})):this.processTimer=this.inputTimer=null},render:function(b){if(!1!==this.running)try{this.now=this.startTime=Date.now(),this.elapsed=this.now-this.lastFrame,this.elementsDrawn=this.lastDrawMS=0,this.currentFPS=1E3/this.elapsed,this.totalFPS+=this.currentFPS,this.frameCount++,this.lastProcessMS=Date.now()-this.startTime-this.lastDrawMS,this.lastFrame=this.now,this.page.render(),window.requestAnimationFrame(this.render.bind(this))}catch(c){AST(null,
printStackTrace(c))}},isOnScreen:function(b,c,e,f){return h5c3.Math.isRectColliding(b,c,e,f,0,0,this.game.dim.w,this.game.dim.h)}});
h5c3.Input=h5c3.Base.extend("h5c3.Input",{_CLASSNAME:"Input",_CLASSVERSION:"0.1.0",_eventPos:null,getEventPosition:function(b,c){null===this._eventPos&&(this._eventPos=h5c3.Point.create(0,0));var e=c;VLD(c)||(e=this._eventPos);b.pageX||b.pageY?(e.x=b.pageX,e.y=b.pageY):(e.x=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,e.y=b.clientY+document.body.scrollTop+document.documentElement.scrollTop);return e}},{stateBindings:null,states:null,actionBindings:null,mousePos:null,mouseLeftButtonDown:!1,
mouseRightButtonDown:!1,mouseMiddleButtonDown:!1,init:function(){this._super();this.stateBindings=new h5c3.Hashtable;this.states=new h5c3.Hashtable;this.actionBindings=new h5c3.Hashtable;this.mousePos=h5c3.Point.create(0,0)},bindState:function(b,c,e,f){if(null===b.uniqueId)throw"Oops, you can't bind a state to an object if it doesn't have a uniqueId function";e=e.toUpperCase();f={stateName:c,object:b,input:e,state:{on:!1,event:null},uiTarget:f};var g=this.stateBindings.get(e);null===g?this.stateBindings.put(e,
[f]):g.push(f);this.states.put(b.uniqueId+"\\\\"+c,{on:!1,event:null});h5c3.InputType.isPositional(h5c3.InputType.getCode(e))&&this._positionals.push(f)},clearStates:function(b){var c,e,f,g,h,k=this.stateBindings.entries();for(c=0;c<k.length;c++)for(h=k[c],e=0;e<h.length;e++)f=h[e],f.object===b&&(g=this.states.get(next.object.uniqueId+"\\\\"+next.stateName),g.on=!1,g.event=null,h5c3.InputType.isPositional(f.input)&&h5c3.tools.arrayRemove(this._positionals,f))},isInputState:function(b,c){var e=this.states.get(b.uniqueId+
"\\\\"+c);if(null===e)throw"Ooops, unknown state "+c;return e.on},getInputState:function(b,c){return this.states.get(b.uniqueId+"\\\\"+c)},bindAction:function(b,c,e,f){e=e.toUpperCase();var g=this.actionBindings.get(e);null===g?this.actionBindings.put(e,[{actionName:c,object:b,input:e,uiTarget:f}]):g.push({actionName:c,input:e,object:b,uiTarget:f})},fireAction:function(b,c){var e,f,g,h,k,l=this.actionBindings.get(h5c3.InputType.getName(b));if(null===l)return!1;for(e=0;e<l.length;e++)if(f=l[e],g=l[e].object,
!g.isActive||g.isActive())if(h5c3.InputType.isPositional(b)){if(h=this.Class.getEventPosition(c),(k=VLD(f.uiTarget)?f.uiTarget.getScreenRect():g.getScreenRect?g.getScreenRect():null)&&k.containsPoint(h))g.onAction(f.actionName,c,h,f.uiTarget)}else g.onAction(f.actionName);return!0},_onReady:function(){h5c3.device.game.obj.attachTouchEvents(this);window.addEventListener("keydown",this._keyDown.bind(this),!0);window.addEventListener("keyup",this._keyUp.bind(this),!0)},_positionals:[],_checkPositional:function(b){var c,
e,f;for(c=0;c<this._positionals.length;c++)(e=this._positionals[c],"mousemove"===b.type&&h5c3.InputType.isTouch(h5c3.InputType.getCode(e.input))||("touchmove"===b.type&&!h5c3.InputType.isTouch(h5c3.InputType.getCode(e.input))||h5c3.InputType.getCode(e.input)===h5c3.InputType.MOUSE_BUTTON_LEFT_UP||h5c3.InputType.getCode(e.input)===h5c3.InputType.MOUSE_BUTTON_LEFT_DOWN||h5c3.InputType.getCode(e.input)===h5c3.InputType.MOUSE_BUTTON_RIGHT_UP||h5c3.InputType.getCode(e.input)===h5c3.InputType.MOUSE_BUTTON_RIGHT_DOWN||
h5c3.InputType.getCode(e.input)===h5c3.InputType.MOUSE_BUTTON_MIDDLE_UP||h5c3.InputType.getCode(e.input)===h5c3.InputType.MOUSE_BUTTON_MIDDLE_DOWN||h5c3.InputType.getCode(e.input)===h5c3.InputType.MOUSE_CLICK)||!(f=VLD(e.uiTarget)?e.uiTarget.getScreenRect():e.object.getScreenRect?e.object.getScreenRect():null))||(f.containsPoint(this.Class.getEventPosition(b))?(e=this.states.get(e.object.uniqueId+"\\\\"+e.stateName),e.on=!0):(e=this.states.get(e.object.uniqueId+"\\\\"+e.stateName),e.on=!1),e.event=
b)},_changeState:function(b,c,e){var f,g,h,k,l;f=h5c3.InputType.getName(b);if(null===f)return this.warn("Unknown keycode = "+b),!1;g=this.stateBindings.get(f);if(null===g)return!1;for(f=0;f<g.length;f++)if(h=g[f],!h.object.isActive||h.object.isActive())h5c3.InputType.isPositional(b)?(k=this.Class.getEventPosition(e),(l=VLD(h.uiTarget)?h.uiTarget.getScreenRect():h.object.getScreenRect?h.object.getScreenRect():null)?l.containsPoint(k)&&(h=this.states.get(h.object.uniqueId+"\\\\"+h.stateName),h.on=c,
h.event=e):(h=this.states.get(h.object.uniqueId+"\\\\"+h.stateName),h.on=c,h.event=e)):(h=this.states.get(h.object.uniqueId+"\\\\"+h.stateName),h.on=c,h.event=e);return!0},_lastMouseMove:null,process:function(){this._lastMouseMove&&(this._checkPositional(this._lastMouseMove),this.fireAction(h5c3.InputType.MOUSE_MOVE,this._lastMouseMove),this.Class.getEventPosition(this._lastMouseMove,this.mousePos),this._lastMouseMove=null)},_keyDown:function(b){this._changeState(b.keyCode,!0,b)&&b.preventDefault();
this.fireAction(b.keyCode,b)&&b.preventDefault()},_keyUp:function(b){this._changeState(b.keyCode,!1,b)&&b.preventDefault()},_touchStart:function(b){var c;c=0;for(len=b.touches.length;c<len;c++)this._changeState(h5c3.InputType.TOUCH,!0,b.touches[c]),this.fireAction(h5c3.InputType.TOUCH,b.touches[c]);b.preventDefault()},_touchEnd:function(b){var c;c=0;for(len=b.changedTouches.length;c<len;c++)this._changeState(h5c3.InputType.TOUCH,!1,b.changedTouches[c]);b.preventDefault()},_touchMove:function(b){var c;
c=0;for(len=b.touches.length;c<len;c++)this._checkPositional(b.touches[c]);b.preventDefault()},_mouseButton:function(b,c){switch(b.button){case 0:this._changeState(h5c3.InputType.MOUSE_BUTTON_LEFT_DOWN,c,b);this._changeState(h5c3.InputType.MOUSE_BUTTON_LEFT_UP,!c,b);this.fireAction(h5c3.InputType.MOUSE_BUTTON_LEFT_DOWN,b);this.mouseLeftButtonDown=!0;break;case 1:this._changeState(h5c3.InputType.MOUSE_BUTTON_MIDDLE_DOWN,c,b);this._changeState(h5c3.InputType.MOUSE_BUTTON_MIDDLE_UP,!c,b);this.fireAction(h5c3.InputType.MOUSE_BUTTON_MIDDLE_DOWN,
b);this.mouseMiddleButtonDown=!0;break;case 2:this._changeState(h5c3.InputType.MOUSE_BUTTON_RIGHT_DOWN,c,b),this._changeState(h5c3.InputType.MOUSE_BUTTON_RIGHT_UP,!c,b),this.fireAction(h5c3.InputType.MOUSE_BUTTON_RIGHT_DOWN,b),this.mouseRightButtonDown=!0}this.fireAction(h5c3.InputType.MOUSE_CLICK,b);b.preventDefault()},_mouseUp:function(b){this._mouseButton(b,!1)},_mouseDown:function(b){this._mouseButton(b,!0)},_mouseMove:function(b){this._lastMouseMove=b;b.preventDefault()},_contextMenu:function(b){this._changeState(h5c3.InputType.MOUSE_BUTTON_RIGHT_UP,
!0,b);this.fireAction(h5c3.InputType.MOUSE_BUTTON_RIGHT_DOWN,b)},_mouseWheel:function(b){0<b.wheelDelta?this.fireAction(h5c3.InputType.MOUSE_WHEEL_UP,b):this.fireAction(h5c3.InputType.MOUSE_WHEEL_DOWN,b);b.preventDefault()}});
h5c3.InputType=h5c3.Base.extend("h5c3.InputType",{nameToCode:null,codeToName:null,POSITIONAL_EVENT_START:1E3,MOUSE_MOVE:1100,MOUSE_CLICK:1110,MOUSE_BUTTON_LEFT_UP:1200,MOUSE_BUTTON_LEFT_DOWN:1201,MOUSE_BUTTON_RIGHT_UP:1220,MOUSE_BUTTON_RIGHT_DOWN:1221,MOUSE_BUTTON_MIDDLE_UP:1230,MOUSE_BUTTON_MIDDLE_DOWN:1231,MOUSE_WHEEL_UP:1300,MOUSE_WHEEL_DOWN:1301,TOUCH:1E3,TOUCH_MOVE:1001,TOUCH_START:1002,TOUCH_END:1003,TOUCH_CANCEL:1004,TOUCH_LEAVE:1005,init:function(){var b,c;this.nameToCode=new h5c3.Hashtable;
this.codeToName=new h5c3.Hashtable;this.addInput(8,"BACKSPACE");this.addInput(9,"TAB");this.addInput(13,"ENTER");this.addInput(16,"SHIFT");this.addInput(17,"CTRL");this.addInput(18,"ALT");this.addInput(19,"PAUSE");this.addInput(20,"CAPS");this.addInput(27,"ESC");this.addInput(32,"SPACE");this.addInput(33,"PAGE_UP");this.addInput(34,"PAGE_DOWN");this.addInput(35,"END");this.addInput(36,"HOME");this.addInput(37,"LEFT");this.addInput(38,"UP");this.addInput(39,"RIGHT");this.addInput(40,"DOWN");this.addInput(45,
"INSERT");this.addInput(46,"DELETE");for(b=48;91>b;b++)c=String.fromCharCode(b),this.addInput(b,c);this.addInput(91,"WINDOW_LEFT");this.addInput(92,"WINDOW_RIGHT");this.addInput(93,"SELECT");this.addInput(96,"NUM_0");this.addInput(97,"NUM_1");this.addInput(98,"NUM_2");this.addInput(99,"NUM_3");this.addInput(100,"NUM_4");this.addInput(101,"NUM_5");this.addInput(102,"NUM_6");this.addInput(103,"NUM_7");this.addInput(104,"NUM_8");this.addInput(105,"NUM_9");this.addInput(106,"*");this.addInput(107,"+");
this.addInput(109,"-");this.addInput(110,".");this.addInput(111,"/");this.addInput(112,"F1");this.addInput(113,"F2");this.addInput(114,"F3");this.addInput(115,"F4");this.addInput(116,"F5");this.addInput(117,"F6");this.addInput(118,"F7");this.addInput(119,"F8");this.addInput(120,"F9");this.addInput(121,"F10");this.addInput(122,"F11");this.addInput(123,"F12");this.addInput(144,"NUM_LOCK");this.addInput(145,"SCROLL_LOCK");this.addInput(186,";");this.addInput(187,"=");this.addInput(188,",");this.addInput(189,
"-");this.addInput(190,".");this.addInput(191,"/");this.addInput(192,"`");this.addInput(219,"[");this.addInput(220,"\\");this.addInput(221,"]");this.addInput(222,"'");this.addInput(this.TOUCH,"TOUCH");this.addInput(this.MOUSE_BUTTON_LEFT_DOWN,"MOUSE_BUTTON_LEFT_DOWN");this.addInput(this.MOUSE_BUTTON_LEFT_UP,"MOUSE_BUTTON_LEFT_UP");this.addInput(this.MOUSE_BUTTON_RIGHT_DOWN,"MOUSE_BUTTON_RIGHT_DOWN");this.addInput(this.MOUSE_BUTTON_RIGHT_UP,"MOUSE_BUTTON_RIGHT_UP");this.addInput(this.MOUSE_BUTTON_MIDDLE_DOWN,
"MOUSE_BUTTON_MIDDLE_DOWN");this.addInput(this.MOUSE_BUTTON_MIDDLE_UP,"MOUSE_BUTTON_MIDDLE_UP");this.addInput(this.MOUSE_WHEEL_UP,"MOUSE_WHEEL_UP");this.addInput(this.MOUSE_WHEEL_DOWN,"MOUSE_WHEEL_DOWN");this.addInput(this.MOUSE_MOVE,"MOUSE_MOVE");this.addInput(this.MOUSE_CLICK,"MOUSE_CLICK")},isTouch:function(b){return b===this.TOUCH},isPositional:function(b){return b>=this.POSITIONAL_EVENT_START},addInput:function(b,c){this.codeToName.put(b,c);this.nameToCode.put(c,b)},getName:function(b){return this.codeToName.get(b)},
getCode:function(b){return this.nameToCode.get(b)}},{});
h5c3.Page=h5c3.Base.extend("h5c3.Page",{_CLASSNAME:"Page",_CLASSVERSION:"0.1.0"},{device:null,wrapper:{div:null,dim:{w:0,h:0}},banner:{name:null,obj:null,id:null,div:null,dim:{w:0,h:0}},game:{name:null,obj:null,id:null,canvas:null,ctx:null,dim:{w:0,h:0}},touchpad:{name:null,obj:null,id:null,canvas:null,ctx:null,dim:{w:0,h:0}},options:{desktopsuspend:!0,suspend:!0,network:!0},orientation:{event:!1,state:null},devWindow:null,init:function(b,c){this._super();this.device=b;CHK(c,"Undefined Page");DOC().title=
c;this.wrapper.div=GEI("waDIV");this.debug("Initialization started.");this.debug("UA="+window.navigator.userAgent);this.debug("Detected Device Screen Dimensions are ["+window.screen.availWidth+"x"+window.screen.availHeight+"]");this.debug("Detected Device Usable Dimensions are ["+window.innerWidth+"x"+window.innerHeight+"]");this.device.useTouch?(this.debug("Mobile Media Detected "+this.device.media.browser.name+" v"+this.device.media.browser.version+" on "+this.device.media.OS.name),this.initBanner(),
this.initGame(),this.initTouchPad()):(this.debug("Static Media Detected "+this.device.media.browser.name+" v"+this.device.media.browser.version+" on "+this.device.media.OS.name),this.initGame());!0===this.options.suspend?(this.debug("OPTION: Suspened on focus enabled."),window.addEventListener("blur",this._onBlur.bind(this),!0),window.addEventListener("focus",this._onFocus.bind(this),!0)):this.debug("OPTION: Suspened on focus disabled.");!0===this.options.network?(this.debug("OPTION: Network monitoring enabled."),
window.document.addEventListener("offline",this._onOffline.bind(this),!0),window.document.addEventListener("online",this._onOnline.bind(this),!0)):this.debug("OPTION: Network monitoring disabled.");window.onresize=this._onResize.bind(this)},initBanner:function(){var b=GEI("waDIV");this.banner.div=document.createElement("div");this.banner.div.id=this.banner.id="waBannerDIV";this.banner.div.width=window.innerWidth;this.banner.div.height=32;b.appendChild(this.banner.div);this.banner.div||this.debug("Could not get a banner element using the id ["+
this.banner.id+"]. ");this.banner.obj=new h5c3.Banners(this.banner.div);this.banner.obj||this.debug("Invalid Banner class. Must be named [Banners]");this.banner.dim={w:this.banner.div.width,h:this.banner.div.height};this.debug("Created Banner panel ["+this.banner.dim.w+"x"+this.banner.dim.h+"]")},initGame:function(){this.setOrientation();VLD(this.game.canvas=GEI("waCANVAS"))?(this.game.ctx=this.game.canvas.getContext("2d"),this.game.dim={w:this.game.canvas.width,h:this.game.canvas.height},"function"===
typeof Game&&(this.game.obj=new Game(this.game),VLD(this.game.obj)?this.debug("Created Game panel ["+this.game.dim.w+"x"+this.game.dim.h+"]"):this.debug("ERROR: Invalid Game class, Must be named [Game]"))):this.debug("ERROR: Could not attach to a canvas element using the id ["+this.game.id+"]. ")},initTouchPad:function(){var b=GEI("waDIV");this.touchpad.canvas=document.createElement("canvas");this.touchpad.canvas.id=this.touchpad.id="pcTouchCanvas";this.touchpad.canvas.width=1080;this.touchpad.canvas.height=
540;b.appendChild(this.touchpad.canvas);if(!this.touchpad.canvas)throw"device.js::initTouchpad() - Abort! Could not attach to a canvas element using the id ["+this.touchpad.id+"]. ";this.touchpad.ctx=this.touchpad.canvas.getContext("2d");this.touchpad.dim={w:this.touchpad.canvas.width,h:this.touchpad.canvas.height};this.touchpad.obj=new h5c3.TouchPad(this.touchpad.ctx,this.touchpad.dim);if(!this.touchpad.obj)throw"device.js::initTouchpad() - Invalid touchpad class. Must be named [TouchPad]";this.debug("Created Touchpad panel ["+
this.touchpad.dim.w+"x"+this.touchpad.dim.h+"]")},setOrientation:function(){this.device.started&&(window.DeviceOrientationEvent?(this.orientation.event=!0,this.debug("Device Orientation is supported - Event Hooked Added."),window.addEventListener("deviceorientation",this.onDeviceMotion,!1)):(this.orientation.event=!1,this.debug("Device Orientation not supported")),this.orientation.state=h5c3.device.useTouch||window.innerHeight>window.innerWidth?H5c3.ORIENTATION.PORTRAIT:H5C3.ORIENTATION.LANDSCAPE)},
onDeviceMotion:function(b){null!==b.alpha&&null!==b.beta&&null!==b.gamma||!0!==h5c3.device.page.orientation.event||(window.removeEventListener("deviceorientation",this.onDeviceMotion,!1),h5c3.device.page.orientation.event=!1,h5c3.device.page.debug("This device does not REALLY have orientation capabilities - Event Hooked Removed."))},_calcScreenSize:function(){this.orientation.state===H5C3.ORIENTATION.LANDSCAPE?(this.debug("Orientation set to Landscape."),document.fullScreen||GEI("waCANVAS").webkitRequestFullScreen()):
this.debug("Orientation set to Portrait.");this.wrapper.dim.w=window.innerWidth;this.wrapper.div.width=this.wrapper.dim.w+"px";this.wrapper.div.style.width=this.wrapper.dim.w+"px";this.wrapper.dim.h=window.innerHeight;this.wrapper.div.height=this.wrapper.dim.h+"px";this.wrapper.div.style.height=this.wrapper.dim.h+"px";this.debug("Calculated screen space is ["+this.wrapper.dim.w+"x"+this.wrapper.dim.h+"]");var b=this.wrapper.dim.h;h5c3.device.useTouch?(this.game.dim.w=this.wrapper.dim.w,this.game.canvas.style.width=
this.game.dim.w+"px",this.game.dim.h=this.wrapper.dim.w,this.game.canvas.style.height=this.game.dim.h+"px",b-=this.game.dim.h,this.touchpad.dim.w=this.wrapper.dim.w,this.touchpad.canvas.style.width=this.touchpad.dim.w+"px",this.touchpad.dim.h=b,this.touchpad.canvas.style.height=this.touchpad.dim.h+"px",b-=this.touchpad.dim.h):(this.game.dim.w=this.wrapper.dim.w,this.game.canvas.style.width=this.game.dim.w+"px",this.game.dim.h=this.wrapper.dim.h,this.game.canvas.style.height=b+"px",b-=b);this.debug("Used ["+
this.game.dim.w+"x"+this.game.dim.h+"] for Game Panel.");this.debug("Used ["+this.touchpad.dim.w+"x"+this.touchpad.dim.h+"] for Touchpad Panel.");0!==b&&this.debug("Layout was not done correctly. "+b+"px difference.")},render:function(){},waDIV:function(b){CHK(b,!0);this.wrapper.div.display="none";!0===b?this.wrapper.div.innerHTML="":document.location.reload();this.wrapper.div.display="block"},_onBlur:function(b){this.game.obj.onBlur()},_onFocus:function(b){this.game.obj.onFocus()},_onOffline:function(b){this.debug("Lost network connection.")},
_onOnline:function(b){this.debug("Gained network connection.")},_onResize:function(b){this.debug("Dimension changed detected.");this._calcScreenSize();this.game.dim.w=this.game.canvas.width;this.game.dim.h=this.game.canvas.height;this.game.obj.onResize(this.game.dim.w,this.game.dim.h)},onReady:function(){this.debug("onReady Called.");this.game.obj.onReady();if(h5c3.device.useTouch)this.touchpad.obj.onReady()}});
h5c3.Main=h5c3.Base.extend("h5c3.Main",{_CLASSNAME:"Main",_CLASSVERSION:"0.1.0"},{scenes:null,activeScenes:null,paused:!1,ctx:null,dim:null,bQuit:!1,init:function(b){this._super();this.ctx=b.ctx;this.dim=b.dim;this.canvas=b.canvas;this.scenes=new h5c3.LinkedList;this.activeScenes=new h5c3.LinkedList;!0===h5c3.devMode&&(h5c3.device.input.bindAction(this,"developer window","F6"),h5c3.device.input.bindAction(this,"physics debug","F7"),h5c3.device.input.bindAction(this,"pool dump","F8"),h5c3.device.input.bindAction(this,
"toggle sound","F9"),h5c3.device.input.bindAction(this,"reset","F10"),h5c3.device.input.bindAction(this,"exit","F12"))},process:function(){if(this.paused||this.bQuit)return this.bQuit;for(var b=this.getFirstActiveScene();b;)b.object().process(),b=b.next();return this.bQuit},stopAllSounds:function(){for(var b=h5c3.loader.getAllSounds(),c=0;c<b.length;c++)h5c3.device.soundEnabled&&b[c].stop()},onAction:function(b){switch(b){case "reset":h5c3.device.boot();break;case "exit":this.quit();break;case "developer window":VLD(h5c3.device.page.devWindow)&&
h5c3.device.page.devWindow.toggleShow();break;case "toggle sound":this.stopAllSounds();h5c3.device.soundEnabled=!h5c3.device.soundEnabled;h5c3.device.soundEnabled?h5c3.device.page.devWindow.send2Console("Sound Enabled."):h5c3.device.page.devWindow.send2Console("Sound Disabled.");break;case "pool dump":h5c3.device.page.devWindow.send2Console("Object Pool Dump:\n===================");h5c3.device.page.devWindow.send2Console(h5c3.Pool.getStats());break;case "physics debug":for(b=this.getFirstScene();b;){for(var c=
b.object().getFirstActiveLayer();c;){var e=c.object();if(e.Class.isA("h5c3.EntityLayer"))for(e=e.systemManager.systems.first;e;){var f=e.object();f.Class.isA("h5c3.systems.Physics")&&f.setDebug(!f.debug);e=e.next()}c=c.next()}b=b.next()}}},addScene:function(b){try{b.ctx=this.ctx,this.scenes.add(b),this.activeScenes.add(b),this.onSceneAdded(b)}catch(c){AST(null,"Error Adding scene ["+b+"]: "+c)}},onSceneAdded:function(b){},removeScene:function(b){this.scenes.remove(b);this.activeScenes.remove(b);this.onSceneRemoved(b)},
onSceneRemoved:function(b){},activateScene:function(b){"undefined"===typeof b||b.active||(this.activeScenes.add(b),b.active=!0,this.onSceneActivated(b),b.onActivated())},onSceneActivated:function(b){},deactivateScene:function(b){b.active&&(this.activeScenes.remove(b),b.active=!1,this.onSceneDeactivated(b),b.onDeactivated())},onSceneDeactivated:function(b){},getFirstActiveScene:function(){return this.activeScenes.first},getFirstScene:function(){return this.scenes.first},pause:function(){if(!this.paused){h5c3.device.handleTimers(!1);
this.paused=!0;for(var b=this.getFirstScene();b;)b.object().pause(),b=b.next()}},isActive:function(){return!this.paused},resume:function(){if(this.paused){h5c3.device.handleTimers(!0);this.paused=!1;for(var b=this.getFirstScene();b;)b.object().resume(),b=b.next()}},togglePauseResume:function(){this.paused?this.resume():this.pause()},quit:function(b){CHK(b,"Quit Signal Received.");this.onExit();this.bQuit=!0},onExit:function(){},reset:function(){for(var b=this.getFirstScene();b;)b.obj.reset(),b=b.next();
this.scenes.clear();this.activeScenes.clear();this.onReady()},attachTouchEvents:function(b){h5c3.device.useTouch?(this.canvas.addEventListener("touchstart",b._touchStart.bind(b),!0),this.canvas.addEventListener("touchend",b._touchEnd.bind(b),!0),this.canvas.addEventListener("touchmove",b._touchMove.bind(b),!0),h5c3.device.touchpad.canvas.addEventListener("touchstart",b._touchStart.bind(b),!0),h5c3.device.touchpad.canvas.addEventListener("touchend",b._touchEnd.bind(b),!0),h5c3.device.touchpad.canvas.addEventListener("touchmove",
b._touchMove.bind(b),!0)):(this.canvas.addEventListener("selectstart",function(b){b.preventDefault();return!1},!1),this.canvas.addEventListener("mouseup",b._mouseUp.bind(b),!0),this.canvas.addEventListener("mousedown",b._mouseDown.bind(b),!0),this.canvas.addEventListener("mousemove",b._mouseMove.bind(b),!0),this.canvas.addEventListener("mousewheel",b._mouseWheel.bind(b),!0),this.canvas.addEventListener("contextmenu",b._contextMenu.bind(b),!0))},onReady:function(){!0===h5c3.devMode&&h5c3.loader.setDisableCache();
if(!1===h5c3.device.resourcesLoaded)try{h5c3.resources.loadResources(),h5c3.loader.start(this.onLoading.bind(this),this.onLoaded.bind(this)),h5c3.device.resourcesLoaded=!0}catch(b){console.log("ERROR: "+b)}},onResize:function(b,c){for(var e=this.getFirstActiveScene();e;)e.obj.onResize(b,c),e=e.next()},onBlur:function(b){this.paused||this.pause()},onFocus:function(b){this.paused&&this.resume()},onLoading:function(b){},onLoaded:function(b,c){},getScreenRect:function(){return h5c3.Rect.create(0,0,h5c3.device.dimGame.w,
h5c3.device.dimGame.h)}});h5c3.systems={};
h5c3.systems.System=h5c3.Base.extend("h5c3.System",{_CLASSNAME:"Systems",_CLASSVERSION:"0.1.0"},{layer:null,componentTypes:null,systemManager:null,delay:0,_lastRun:0,init:function(b,c){this._super();this.delay=CHK(c,0);if(!b instanceof Array)throw"Invalid component types array. Use a blank array ([]) if there are no components handled by the system.";this.componentTypes=b},processAll:function(){},onResize:function(){},onOriginChange:function(b,c){},onAddedToLayer:function(b){},onRemovedFromLayer:function(b){}});
h5c3.systems.EntitySystem=h5c3.systems.System.extend("h5c3.systems.EntitySystem",{_CLASSNAME:"EntitySystem",_CLASSVERSION:"0.1.0"},{entities:null,suicides:null,init:function(b,c){this._super(b,c);this.entities=new h5c3.LinkedList;this.suicides=new h5c3.LinkedList},addIfMatched:function(b){for(var c=0;c<this.componentTypes.length;c++)if(b.hasComponentOfType(this.componentTypes[c])){this.entities.add(b);this.onEntityAdded(b);break}},add:function(b){this.entities.has(b)||(this.entities.add(b),this.onEntityAdded(b))},
remove:function(b){if(this.entities.remove(b))this.onEntityRemoved(b)},removeIfNotMatched:function(b){for(var c=0;c<this.componentTypes.length;c++)if(b.hasComponentOfType(this.componentTypes[c]))return;this.remove(b)},processAll:function(){for(var b=this.entities.first;b;)this.process(b.obj),b=b.next();for(b=this.suicides.first;b;)this.remove(b.obj),b=b.next();this.suicides.clear()},process:function(b){},suicide:function(b){this.suicides.add(b)},onEntityAdded:function(b){},onEntityRemoved:function(b){},
onComponentAdded:function(b,c){},onComponentRemoved:function(b,c){}});h5c3.components={};h5c3.components.Component=h5c3.Pooled.extend("h5c3.components.Component",{_CLASSNAME:"Component",_CLASSVERSION:"0.1.0",create:function(){var b=this._super();b.active=!0;return b}},{_entity:null,_type:null,init:function(b){this._super();this._type=b},getType:function(){return this._type.toLowerCase()},getEntity:function(){return this._entity},onBeforeRemoved:function(){}});
h5c3.SystemManager=h5c3.Base.extend("h5c3.SystemManager",{_CLASSNAME:"SystemManager",_CLASSVERSION:"0.1.0"},{systems:null,systemsByComponentType:null,layer:null,init:function(b){this.systems=new h5c3.LinkedList;this.systemsByComponentType=new h5c3.Hashtable;this.layer=b},add:function(b){b.layer=this.layer;b.systemManager=this;this.systems.add(b);if(!VLD(b.componentTypes))throw"systemmanager.js::add() - Invalid component types: it can be empty, but not undefined. Did you forget to add an init method to your system and/or not call this._super(componentTypes)";
for(var c=0;c<b.componentTypes.length;c++){var e=b.componentTypes[c].toLowerCase(),f=this.systemsByComponentType.get(e);null==f&&(f=new h5c3.LinkedList,this.systemsByComponentType.put(e,f));f.has(b)||f.add(b)}for(c=this.layer.entityManager.entities.first;c;)this._handleEntityAdded(c.object()),c=c.next();b.onAddedToLayer(this.layer)},remove:function(b){b.onRemovedFromLayer(b.layer);this.systems.remove(b);for(var c=0;c<b.componentTypes;c++){var e=this.systemsByComponentType.get(b.componentTypes[c].toLowerCase());
assert(null!=e,"Oops, trying to remove a system and it's not in the by type list");b.systemManager=null;e.remove(b)}},getByComponentType:function(b){return this.systemsByComponentType.get(b)},onOriginChange:function(b,c){for(var e=this.systems.first;e;)e.object().onOriginChange(b,c),e=e.next()},_handleEntityAdded:function(b){for(var c=b.getComponentTypes(),e=0;e<c.length;e++){var f=this.systemsByComponentType.get(c[e].toLowerCase());if(f)for(f=f.first;f;)f.obj.add(b),f=f.next()}},_handleEntityRemoved:function(b){var c=
b.getAllComponents();if(null!=c)for(var c=c.keys(),e=0;e<c.length;e++){var f=this.systemsByComponentType.get(c[e].toLowerCase());if(f)for(f=f.first;f;)f.obj.remove(b),f=f.next()}},_handleComponentAdded:function(b,c){var e=this.systemsByComponentType.get(c.getType());if(null!=e)for(e=e.first;e;)e.obj.add(b),e.obj.onComponentAdded(b,c),e=e.next()},_handleComponentRemoved:function(b,c){var e=this.systemsByComponentType.get(c.getType());if(null!=e)for(e=e.first;e;)e.obj.removeIfNotMatched(b),e.obj.onComponentRemoved(b,
c),e=e.next()},processAll:function(){for(var b=this.systems.first;b;){if(0==b.obj.delay||h5c3.device.now-b.obj._lastRun>b.obj.delay)b.obj.processAll(),0!=b.obj.delay&&(b.obj._lastRun=h5c3.device.now);b=b.next()}},onResize:function(b,c){for(var e=this.systems.first;e;)e.obj.onResize(b,c),e=e.next()}});
h5c3.EntityManager=h5c3.Base.extend("h5c3.EntityManager",{_CLASSNAME:"EntityManager",_CLASSVERSION:"0.1.0"},{entitiesByTag:null,componentsByEntity:null,componentsByEntityPlusType:null,entities:null,entitySuicides:null,layer:null,init:function(b){this.layer=b;this.entitiesByTag=new h5c3.HashList;this.entities=new h5c3.LinkedList;this.componentsByEntity=new h5c3.Hashmap;this.componentsByEntityPlusType=new h5c3.Hashmap;this.entitySuicides=new h5c3.LinkedList},cleanup:function(){for(var b=this.entitySuicides.first;b;)this._doRemoveEntity(b.object()),
b=b.next();this.entitySuicides.clear()},add:function(b,c){this.entities.add(b);void 0!=c&&this.entitiesByTag.add(c,b);var e=b.getAllComponents();if(null!=e)for(var e=e.values(),f=0;f<e.length;f++)this._addToComponentMap(b,e[f]);this.layer.systemManager._handleEntityAdded(b)},remove:function(b){this.entitySuicides.has(b)||(this.entitySuicides.add(b),b.active=!1)},removeComponent:function(b,c){this._removeFromComponentMap(b,c);this.layer.systemManager._handleComponentRemoved(b,c);b._handleComponentRemoved(c);
c._entity=null},addTag:function(b,c){-1==b.tags.indexOf(c.toLowerCase())&&(this.entitiesByTag.add(c.toLowerCase(),b),b.tags.push(c.toLowerCase()))},removeTag:function(b,c){this.entitiesByTag.remove(c.toLowerCase(),b);b.tags.remove(c.toLowerCase())},getTagged:function(b){return this.entitiesByTag.get(b.toLowerCase())},activate:function(b){b.active||(this.layer.systemManager._handleEntityAdded(b),b.active=!0)},deactivate:function(b){b.active&&(this.layer.systemManager._handleEntityRemoved(b),b.active=
!1)},_doRemoveEntity:function(b){this.entities.remove(b);var c=b.getAllComponents();if(null!=c)for(var c=c.values(),e=0;e<c.length;e++)this._removeFromComponentMap(b,c[e]);for(c=0;c<b.tags.length;c++)this.entitiesByTag.remove(b.tags[c],b);this.layer.systemManager._handleEntityRemoved(b);b.release()},addComponent:function(b,c){this._addToComponentMap(b,c);b._handleComponentAdded(c);this.layer.systemManager._handleComponentAdded(b,c);c._entity=b;return c},getComponent:function(b,c){return this.componentsByEntityPlusType.get(b.objectId+
":"+c)},getComponents:function(b){return this.componentsByEntity.get(b.objectId)},hasComponentOfType:function(b,c){return this.componentsByEntityPlusType.containsKey(b.objectId+":"+c)},_addToComponentMap:function(b,c){if(this.componentsByEntityPlusType.get(b.objectId+":"+c.getType()))throw"entitymanager.js::_addToComponentMap() - adding component "+c.getType()+" to entity "+b+" when it already has one of that type";this.componentsByEntityPlusType.put(b.objectId+":"+c.getType(),c);this.componentsByEntity.put(b.objectId,
c)},_removeFromComponentMap:function(b,c){c.onBeforeRemoved();this.componentsByEntityPlusType.remove(b.objectId+":"+c.getType());this.componentsByEntity.remove(b.objectId);c.release()}});h5c3.lang||(h5c3.lang={$developer:"Developer",$production:"Production"});h5c3.init()&&h5c3.run();
