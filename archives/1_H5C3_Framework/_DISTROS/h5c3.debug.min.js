/*
 H5C3 Framework v0.9.9-alpha-Developer
 Built Fri Sep 20 16:30:45 2013
 http://h5c3.i2tmlabs.com/?license.txt
 Copyright 2013 by i2tm labs - all rights reserved.
 2013 by i2tm labs - all rights reserved.
*/
(function(){var b={pad:function(b,c,h){b+="";h=h?h:" ";if(b.length<c)for(;b.length<c;)b+=h;return b},objToString:function(b,c){if("undefined"===typeof b)return b;$lf="undefined"===typeof c||!1===c?", ":"\n";var h="",k;for(k in b)b.hasOwnProperty(k)&&("object"===typeof b[k]&&(h+="\n",b[k]=this.objToString(b[k],c)),h+=k+"::"+b[k]+$lf);return h+=$lf},camelize:function(){return this.replace(/\-(\w)/g,function(b,c){return c.toUpperCase()})},contains:function(b){b="string"===typeof b?b:b.toString();return-1<
this.indexOf(b)},count:function(b){"[object RegExp]"!==Object.prototype.toString.call(b)&&(b=b.toString().replace(/\$\^\[\]\{\}\(\)\?\:\.\+\*/g,"\\$1"));b=RegExp(b?b.source:".","g");return(this.match(b)||[]).length},enclose:function(b,c){return(b=b||"")+this+(c?c:b)},extract:function(b,c){c=void 0===c?0:c;if(!b.global)return this.match(b)[c]||"";for(var h,k=[];h=b.exec(this);)k[k.length]=h[c]||"";return k},forEach:function(b){for(var c,h=-1;c=this[++h];)b.call(this,c,h);return!0},forEachWord:function(b){var c=
this,h=-1;c.replace(/\b([\w\-]+)\b/g,function(k,l){b.call(c,l,++h);return k});return!0},linkify:function(b){return this.replace(/(^|\s)((?:f|ht)tps?:\/\/[^\s]+)/g,b||'$1<a href="$2">$2</a>')},many:function(b){return Array(b?b+1:2).join(this)},randomize:function(){return this.split("").sort(function(){return 0.5<Math.random()?-1:1}).join("")},remove:function(b){return this.replace(b||/./g,"")},reverse:function(){return this.split("").reverse().join("")},shorten:function(b,c){var h=this.substring(0,
b||this.length);return h+(h===this?"":c||"")},sort:function(){return Array.prototype.sort.apply(this.split(""),arguments).join("")},toDOM:function(){document.createElement("div").innerHTML=this;return Array.prototype.slice.call(div.childNodes)},trim:function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},wrap:function(b,c,h){c=c||"\n";b=b||75;return this?this.match(RegExp(".{1,"+b+"}(\\s|$)"+(h?"|.{"+b+"}|.+$":"|\\S+?(\\s|$)"),"g")).join(c):this}},c;for(c in b)String.prototype[c]=String.prototype[c]||
b[c]})();
(function(b,c){"object"===typeof exports?module.exports=c():b.printStackTrace=c()})(this,function(){function b(c){c=c||{guess:!0};var f=c.e||null;c=!!c.guess;var g=new b.implementation,h=g.run(f);h.push(f);return c?g.guessAnonymousFunctions(h):h}b.implementation=function(){};b.implementation.prototype={run:function(b,f){b=b||this.createException();f=f||this.mode(b);return"other"===f?this.other(arguments.callee):this[f](b)},createException:function(){try{this.undef()}catch(b){return b}},mode:function(b){return b.arguments&&b.stack?
"chrome":b.stack&&b.sourceURL?"safari":b.stack&&b.number?"ie":b.stack&&b.fileName?"firefox":b.message&&b["opera#sourceloc"]?!b.stacktrace||-1<b.message.indexOf("\n")&&b.message.split("\n").length>b.stacktrace.split("\n").length?"opera9":"opera10a":b.message&&b.stack&&b.stacktrace?0>b.stacktrace.indexOf("called from line")?"opera10b":"opera11":b.stack&&!b.fileName?"chrome":"other"},instrumentFunction:function(c,f,g){c=c||window;var h=c[f];c[f]=function(){g.call(this,b().slice(4));return c[f]._instrumented.apply(this,
arguments)};c[f]._instrumented=h},deinstrumentFunction:function(b,f){b[f].constructor===Function&&(b[f]._instrumented&&b[f]._instrumented.constructor===Function)&&(b[f]=b[f]._instrumented)},chrome:function(b){return(b.stack+"\n").replace(/^\s+(at eval )?at\s+/gm,"").replace(/^([^\(]+?)([\n$])/gm,"{anonymous}() ($1)$2").replace(/^Object.<anonymous>\s*\(([^\)]+)\)/gm,"{anonymous}() ($1)").replace(/^(.+) \((.+)\)$/gm,"$1@$2").split("\n").slice(1,-1)},safari:function(b){return b.stack.replace(/\[native code\]\n/m,
"").replace(/^(?=\w+Error\:).*$\n/m,"").replace(/^@/gm,"{anonymous}()@").split("\n")},ie:function(b){return b.stack.replace(/^\s*at\s+(.*)$/gm,"$1").replace(/^Anonymous function\s+/gm,"{anonymous}() ").replace(/^(.+)\s+\((.+)\)$/gm,"$1@$2").split("\n").slice(1)},firefox:function(b){return b.stack.replace(/(?:\n@:0)?\s+$/m,"").replace(/^(?:\((\S*)\))?@/gm,"{anonymous}($1)@").split("\n")},opera11:function(b){var f=/^.*line (\d+), column (\d+)(?: in (.+))? in (\S+):$/;b=b.stacktrace.split("\n");for(var g=
[],h=0,k=b.length;h<k;h+=2){var l=f.exec(b[h]);if(l){var m=l[4]+":"+l[1]+":"+l[2],l=l[3]||"global code",l=l.replace(/<anonymous function: (\S+)>/,"$1").replace(/<anonymous function>/,"{anonymous}");g.push(l+"@"+m+" -- "+b[h+1].replace(/^\s+/,""))}}return g},opera10b:function(b){var f=/^(.*)@(.+):(\d+)$/;b=b.stacktrace.split("\n");for(var g=[],h=0,k=b.length;h<k;h++){var l=f.exec(b[h]);l&&g.push((l[1]?l[1]+"()":"global code")+"@"+l[2]+":"+l[3])}return g},opera10a:function(b){var f=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;
b=b.stacktrace.split("\n");for(var g=[],h=0,k=b.length;h<k;h+=2){var l=f.exec(b[h]);l&&g.push((l[3]||"{anonymous}")+"()@"+l[2]+":"+l[1]+" -- "+b[h+1].replace(/^\s+/,""))}return g},opera9:function(b){var f=/Line (\d+).*script (?:in )?(\S+)/i;b=b.message.split("\n");for(var g=[],h=2,k=b.length;h<k;h+=2){var l=f.exec(b[h]);l&&g.push("{anonymous}()@"+l[2]+":"+l[1]+" -- "+b[h+1].replace(/^\s+/,""))}return g},other:function(b){for(var f=/function\s*([\w\-$]+)?\s*\(/i,g=[],h,k;b&&b.arguments&&10>g.length;)h=
f.test(b.toString())?RegExp.$1||"{anonymous}":"{anonymous}",k=Array.prototype.slice.call(b.arguments||[]),g[g.length]=h+"("+this.stringifyArguments(k)+")",b=b.caller;return g},stringifyArguments:function(b){for(var f=[],g=Array.prototype.slice,h=0;h<b.length;++h){var k=b[h];void 0===k?f[h]="undefined":null===k?f[h]="null":k.constructor&&(k.constructor===Array?f[h]=3>k.length?"["+this.stringifyArguments(k)+"]":"["+this.stringifyArguments(g.call(k,0,1))+"..."+this.stringifyArguments(g.call(k,-1))+"]":
k.constructor===Object?f[h]="#object":k.constructor===Function?f[h]="#function":k.constructor===String?f[h]='"'+k+'"':k.constructor===Number&&(f[h]=k))}return f.join(",")},sourceCache:{},ajax:function(b){var f=this.createXMLHTTPObject();if(f)try{return f.open("GET",b,!1),f.send(null),f.responseText}catch(g){}return""},createXMLHTTPObject:function(){for(var b,f=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},
function(){return new ActiveXObject("Microsoft.XMLHTTP")}],g=0;g<f.length;g++)try{return b=f[g](),this.createXMLHTTPObject=f[g],b}catch(h){}},isSameDomain:function(b){return"undefined"!==typeof location&&-1!==b.indexOf(location.hostname)},getSource:function(b){b in this.sourceCache||(this.sourceCache[b]=this.ajax(b).split("\n"));return this.sourceCache[b]},guessAnonymousFunctions:function(b){for(var f=0;f<b.length;++f){var g=/^(.*?)(?::(\d+))(?::(\d+))?(?: -- .+)?$/,h=b[f],k=/\{anonymous\}\(.*\)@(.*)/.exec(h);
if(k){var l=g.exec(k[1]);l&&(g=l[1],k=l[2],l=l[3]||0,g&&(this.isSameDomain(g)&&k)&&(g=this.guessAnonymousFunction(g,k,l),b[f]=h.replace("{anonymous}",g)))}}return b},guessAnonymousFunction:function(b,f,g){var h;try{h=this.findFunctionName(this.getSource(b),f)}catch(k){h="getSource failed with url: "+b+", exception: "+k.toString()}return h},findFunctionName:function(b,f){for(var g=/function\s+([^(]*?)\s*\(([^)]*)\)/,h=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,k=/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,
l="",m,p=Math.min(f,20),n,q=0;q<p;++q)if(m=b[f-q-1],n=m.indexOf("//"),0<=n&&(m=m.substr(0,n)),m)if(l=m+l,(m=h.exec(l))&&m[1]||(m=g.exec(l))&&m[1]||(m=k.exec(l))&&m[1])return m[1];return"(?)"}};return b});"object"!==typeof JSON&&(JSON={});
(function(){function b(b){return 10>b?"0"+b:b}function c(b){h.lastIndex=0;return h.test(b)?'"'+b.replace(h,function(b){var c=m[b];return"string"===typeof c?c:"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+b+'"'}function f(b,g){var h,m,u,v,s=k,t,r=g[b];r&&("object"===typeof r&&"function"===typeof r.toJSON)&&(r=r.toJSON(b));"function"===typeof p&&(r=p.call(g,b,r));switch(typeof r){case "string":return c(r);case "number":return isFinite(r)?String(r):"null";case "boolean":case "null":return String(r);
case "object":if(!r)return"null";k+=l;t=[];if("[object Array]"===Object.prototype.toString.apply(r)){v=r.length;for(h=0;h<v;h+=1)t[h]=f(h,r)||"null";u=0===t.length?"[]":k?"[\n"+k+t.join(",\n"+k)+"\n"+s+"]":"["+t.join(",")+"]";k=s;return u}if(p&&"object"===typeof p)for(v=p.length,h=0;h<v;h+=1)"string"===typeof p[h]&&(m=p[h],(u=f(m,r))&&t.push(c(m)+(k?": ":":")+u));else for(m in r)Object.prototype.hasOwnProperty.call(r,m)&&(u=f(m,r))&&t.push(c(m)+(k?": ":":")+u);u=0===t.length?"{}":k?"{\n"+k+t.join(",\n"+
k)+"\n"+s+"}":"{"+t.join(",")+"}";k=s;return u}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var g=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,k,l,m={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},p;"function"!==typeof JSON.stringify&&(JSON.stringify=function(b,c,g){var h;l=k="";if("number"===typeof g)for(h=0;h<g;h+=1)l+=" ";else"string"===typeof g&&(l=g);if((p=c)&&"function"!==typeof c&&("object"!==typeof c||"number"!==typeof c.length))throw Error("JSON.stringify");return f("",{"":b})});
"function"!==typeof JSON.parse&&(JSON.parse=function(b,c){function f(b,g){var h,k,l=b[g];if(l&&"object"===typeof l)for(h in l)Object.prototype.hasOwnProperty.call(l,h)&&(k=f(l,h),void 0!==k?l[h]=k:delete l[h]);return c.call(b,g,l)}var h;b=String(b);g.lastIndex=0;g.test(b)&&(b=b.replace(g,function(b){return"\\u"+("0000"+b.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(b.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return h=eval("("+b+")"),"function"===typeof c?f({"":h},""):h;throw new SyntaxError("JSON.parse");})})();
var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(b){var c="",f,g,h,k,l,m,p=0;for(b=Base64._utf8_encode(b);p<b.length;)f=b.charCodeAt(p++),g=b.charCodeAt(p++),h=b.charCodeAt(p++),k=f>>2,f=(f&3)<<4|g>>4,l=(g&15)<<2|h>>6,m=h&63,isNaN(g)?l=m=64:isNaN(h)&&(m=64),c=c+this._keyStr.charAt(k)+this._keyStr.charAt(f)+this._keyStr.charAt(l)+this._keyStr.charAt(m);return c},decode:function(b){var c=[],f,g,h,k,l,m=0;for(b=b.replace(/[^A-Za-z0-9\+\/\=]/g,"");m<
b.length;)f=this._keyStr.indexOf(b.charAt(m++)),g=this._keyStr.indexOf(b.charAt(m++)),k=this._keyStr.indexOf(b.charAt(m++)),l=this._keyStr.indexOf(b.charAt(m++)),f=f<<2|g>>4,g=(g&15)<<4|k>>2,h=(k&3)<<6|l,c.push(String.fromCharCode(f)),64!=k&&c.push(String.fromCharCode(g)),64!=l&&c.push(String.fromCharCode(h));c.join("");return c},_utf8_encode:function(b){if(null===b||"undefined"===typeof b)return"";b+="";var c="",f,g,h=0;f=g=0;for(var h=b.length,k=0;k<h;k++){var l=b.charCodeAt(k),m=null;128>l?g++:
m=127<l&&2048>l?String.fromCharCode(l>>6|192,l&63|128):String.fromCharCode(l>>12|224,l>>6&63|128,l&63|128);null!==m&&(g>f&&(c+=b.slice(f,g)),c+=m,f=g=k+1)}g>f&&(c+=b.slice(f,h));return c},_utf8_decode:function(b){var c=[],f=0,g=0,h=0,k=0,l=0;for(b+="";f<b.length;)h=b.charCodeAt(f),128>h?(c[g++]=String.fromCharCode(h),f++):191<h&&224>h?(k=b.charCodeAt(f+1),c[g++]=String.fromCharCode((h&31)<<6|k&63),f+=2):(k=b.charCodeAt(f+1),l=b.charCodeAt(f+2),c[g++]=String.fromCharCode((h&15)<<12|(k&63)<<6|l&63),
f+=3);return c.join("")}};DOC=function(){return document};GQS=function(b,c,f){CHK(f,DOC());return f.querySelector("div[data-"+b+'="'+c+'"]')};GEI=function(b){return DOC().getElementById(b)};GEN=function(b){return DOC().getElementsByName(b)};GEC=function(b){return DOC().getElementsByClass(b)};GET=function(b){return DOC().getElementsByTagName(b)};CNT=function(b){return"string"===typeof b?GEI(b):b};CTX=function(b){return CNT(b).getContext("2d")};ESA=function(b,c,f){CNT(b).setAttribute(c,f)};
EGA=function(b,c){CNT(b).getAttribute(c)};AEA=function(b,c,f,g){var h=CNT(b);c=DOC().createElement(c);f&&(c.id=f);g&&(c.innerHTML=g);h.parentNode.insertBefore(c,b);return h.parentNode.id};AET=function(b,c,f,g){b=CNT(b);c=DOC().createElement(c);f&&(c.id=f);g&&(c.innerHTML=g);b.appendChild(c);return c};
PUW=function(b,c,f,g,h){var k=window.screen.availWidth/2-g/2,l=window.screen.availHeight/2-h/2;!0===f?(b=window.open(b,c,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no"),b.moveTo(0,0),b.resizeTo(window.screen.availWidth,window.screen.availHeight)):b=window.open(b,c,"toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width="+g+", height="+h+", top="+l+", left="+k);b&&!b.closed&&"undefined"!==
b.closed&&0!==b.screenX||window.alert("Please change your popup settings for this domain.");return b};
ISA=function(b){what=function(b){return Object.prototype.toString.call(b).remove("[").remove("]").split(" ").pop()};kind=function(b,f){if(null===f)return"null";if("undefined"===f)return"undefined";if("Object"!==b&&"Function"!==b)return b;if("Object"===b)return"undefined"!==typeof f.constructor?"undefined"!==typeof f.Class?"undefined"!==typeof f.Class._CLASSNAME?f.Class._CLASSNAME:"undefined"!==typeof f.name&&""!==f.name?"Object:"+f.name:"Object:Unnamed":"Object:Simple":"undefined"!==typeof f.toString?
b:"Object";if("Function"===b&&"undefined"!==typeof f.arguments)return"undefined"!==typeof f.prototype?"undefined"!==typeof f.name&&""!==f.name?"Method:"+f.name:"Method:Unnamed":b};return kind(what(b),b)};VLD=function(b){return!(null===b||"undefined"===b||void 0===b||""===b)};CHK=function(b,c){return VLD(b)?b:c};AST=function(b,c){if(!b)throw c;};RUN=function(b){VLD(h5c3.bootstrap)&&h5c3.applets.use({file:b})};
ERR=_DBG_=function(b,c){if(VLD(h5c3)&&VLD(h5c3.errorhandler)){var f=DOC().createEvent("Event");f.initEvent("H5C3Error",!0,!0);f.arguments=arguments;DOC().dispatchEvent(f)}else VLD(console)&&("string"===typeof c?f=c:"object"===typeof c||"function"===typeof c?(c.fullName?f=c.fullName:c._CLASSNAME&&(f=c._CLASSNAME),f+="-"+c._CLASSVERSION):f="Unknown",console.log(f+":"+b))};
var h5c3={_CLASSNAME:"H5C3",_CLASSVERSION:"0.5.1",NAME:"H5C3 Framework",VERSION:"0.9.9-alpha",DISTRO:"Developer",BUILT:"Fri Sep 20 16:30:45 2013",path:{home:"http://h5c3.i2tmlabs.com/",base:"public/sandbox/",applets:"public/applets/",scripts:"public/shared/js/",styles:"public/shared/css/",images:"public/shared/img/",plugins:"public/shared/plugins/",user:"public/users/",app:window.location.protocol+"//"+window.location.host+window.location.pathname.split("/").slice(0,-1).join("/")+"/"},hasOwn:Object.prototype.hasOwnProperty,
isH5C3:function(b){return"object"===typeof b&&"function"===typeof b.isH5C3},isFunction:function(b){return!!(b&&b.constructor&&b.call&&b.apply)},isWindow:function(b){return!(!b||!b.setInterval)},isArray:Array.isArray||function(b){return b.constructor===Array},isString:function(b){return"string"==typeof b},isObject:function(b){return b===Object(b)},isPlainObject:function(b){if(!b||this.isObject(b)||b.nodeType||this.isWindow(b))return!1;try{if(b.constructor&&!this.hasOwn.call(b,"constructor")&&!this.hasOwn.call(b.constructor.prototype,
"isPrototypeOf"))return!1}catch(c){return!1}for(var f in b);return void 0===f||this.hasOwn.call(b,f)},bind:function(b,c){return function(){c.apply(b,arguments)}},extend:function(){var b,c,f,g,h,k=arguments[0]||{},l=1,m=arguments.length,p=!1;"boolean"===typeof k&&(p=k,k=arguments[1]||{},l=2);"object"===typeof k||h5c3.isFunction(k)||(k={});m===l&&(k=this,--l);for(;l<m;l++)if(null!=(b=arguments[l]))for(c in b)f=k[c],g=b[c],k!==g&&(p&&g&&(this.isPlainObject(g)||(h=this.isArray(g)))?(h?(h=!1,f=f&&this.isArray(f)?
f:[]):f=f&&this.isPlainObject(f)?f:{},k[c]=this.extend(p,f,g)):void 0!==g&&(k[c]=g));return k},devMode:!1,ready:!1,init:function(){_DBG_("Initializing...",this);var b;b="No Configuration file detected.\nYour very first script tag should be as below. You can change the path/file for the data-config attribute.\n"+('EXAMPLE: <script src="'+this.usePath("script")+'int/h5c3.debug.min.js" data-config="assets/config.js">\x3c/script>');if(config&&config.app&&config.options)this.config=config,this.ready=!0;
else if(AST(!this.getConfig(),b))return this.ready;this.devMode="Developer"===this.DISTRO||"Developer"===this.DISTRO?!0:!1;return this.ready},usePath:function(b){switch(b.toLowerCase()){case "home":return this.path.home;case "base":return this.path.home+path.base;case "applets":return this.path.home+path.applets;case "scripts":return this.path.home+path.scripts;case "styles":return this.path.home+path.styles;case "images":return this.path.home+path.images;case "plugins":return this.path.home+path.plugins;
case "user":return this.path.home+path.user;case "app":return this.path.app}},getConfig:function(){if("file:"!==location.protocol&&"undefined"===typeof this.config){var b=document.getElementsByTagName("script")[0];if(0===b.children.length)b.dataset.config&&(this.path.config=this.path.app+b.dataset.config);else for(i=0;i<b.children.length;i++)b.children[i].dataset.config&&(this.path.config=this.path.app+b.children[i].dataset.config);this.path.config&&this.XHR(this.path.config,function(){_DBG_("Loaded")},
function(){_DBG_("Error")})}},tag:function(){return this.NAME+" v"+this.VERSION+"-"+this.DISTRO},XHR:function(b,c,f,g,h,k){function l(b){b.req=printStackTrace.implementation.prototype.createXMLHTTPObject();if("withCredentials"in b.req){b.req.open(b.method,b.url,!0);b.req.onerror=b.onError;b.req.onreadystatechange=function(){!0===b.trace&&_DBG_(String.prototype.objToString({url:b.url,state:this.readyState,status:this.status,text:this.statusText},!1),h5c3);4===b.req.readyState&&(200<=b.req.status&&
400>b.req.status?(_DBG_(b.url+" SUCCESSFUL",h5c3),b.onLoad(b.req.responseText)):(_DBG_(b.url+" UNSUCCESSFUL - Check path & Filename.",h5c3),b.req.abort()))};try{b.req.send(b.data)}catch(c){AST(null,printStackTrace({e:c}))}}}function m(b){b.req=new XDomainRequest;b.req.open(b.method,b.url);b.req.onerror=b.onError;b.req.onload=function(){c(b.req.responseText)};b.req.send(b.data)}if(VLD(b)&&""!==b){k=h5c3.devMode&&!0!=k?!1:!0;h={req:"",url:b,trace:k};h.method=CHK(g,"GET");h.onLoad=CHK(c,this._onLoad);
h.onError=CHK(f,this._onError);h.data=CHK(f,0);f=b.indexOf("http");(a=b.indexOf("applet."))&&-1===f&&_DBG_("You cannot load Applets off local filesystem. Trying H5C3 Public archive...");try{if(XMLHttpRequest)return l(h);if(XDomainRequest)return m(h)}catch(p){}}else f(Error("URL provided is invalid ["+b+"]"))},clientFS_exists:function(b,c){storageRootEntry.getFile(b,{create:!1},function(){c(!0)},function(){c(!1)})},run:function(){VLD(this.bootstrap)||(this.bootstrap=new h5c3.Bootstrap)}};
h5c3.push=Array.prototype.push;h5c3.merge=function(b,c){var f=b.length,g=0;if("number"===typeof c.length)for(var h=c.length;g<h;g++)b[f++]=c[g];else for(;void 0!==c[g];)b[f++]=c[g++];b.length=f;return b};h5c3.makeArray=function(b,c){var f=c||[];null!=b&&(null==b.length||h5c3.isString(b)||h5c3.isFunction(b)||h5c3.isWindow(b)?h5c3.push.call(f,b):h5c3.merge(f,b));return f};
h5c3.each=function(b,c,f){var g,h=0,k=b.length,l=void 0===k||h5c3.isFunction(b);if(f)if(l)for(g in b){if(!1===c.apply(b[g],f))break}else for(;h<k&&!1!==c.apply(b[h++],f););else if(l)for(g in b){if(!1===c.call(b[g],g,b[g]))break}else for(;h<k&&!1!==c.call(b[h],h,b[h++]););return b};h5c3._flagsCache={};h5c3.createFlags=function(b){var c=h5c3._flagsCache[b]={},f,g;b=b.split(/\s+/);f=0;for(g=b.length;f<g;f++)c[b[f]]=!0;return c};
h5c3.Callbacks=function(b){b=b?h5c3._flagsCache[b]||h5c3.createFlags(b):{};var c=[],f=[],g,h,k,l,m,p=function(f){var g,h,k;g=0;for(h=f.length;g<h;g++)k=f[g],h5c3.isArray(k)?p(k):h5c3.isFunction(k)&&(b.unique&&q.has(k)||c.push(k))},n=function(n,p){p=p||[];g=!b.memory||[n,p];h=!0;m=k||0;k=0;for(l=c.length;c&&m<l;m++)if(!1===c[m].apply(n,p)&&b.stopOnFalse){g=!0;break}h=!1;c&&(b.once?!0===g?q.disable():c=[]:f&&f.length&&(g=f.shift(),q.fireWith(g[0],g[1])))},q={add:function(){if(c){var b=c.length;p(arguments);
h?l=c.length:g&&!0!==g&&(k=b,n(g[0],g[1]))}return this},remove:function(){if(c)for(var f=arguments,g=0,k=f.length;g<k;g++)for(var n=0;n<c.length&&(f[g]!==c[n]||(h&&n<=l&&(l--,n<=m&&m--),c.splice(n--,1),!b.unique));n++);return this},has:function(b){if(c)for(var f=0,g=c.length;f<g;f++)if(b===c[f])return!0;return!1},empty:function(){c=[];return this},disable:function(){c=f=g=void 0;return this},disabled:function(){return!c},lock:function(){f=void 0;g&&!0!==g||q.disable();return this},locked:function(){return!f},
fireWith:function(c,k){f&&(h?b.once||f.push([c,k]):b.once&&g||n(c,k));return this},fire:function(){q.fireWith(this,arguments);return this},fired:function(){return!!g}};return q};
h5c3.extend({Deferred:function(b){var c=h5c3.Callbacks("once memory"),f=h5c3.Callbacks("once memory"),g=h5c3.Callbacks("memory"),h="pending",k={resolve:c,reject:f,notify:g},l={done:c.add,fail:f.add,progress:g.add,state:function(){return h},isResolved:c.fired,isRejected:f.fired,then:function(b,c,f){m.done(b).fail(c).progress(f);return this},always:function(){m.done.apply(m,arguments).fail.apply(m,arguments);return this},pipe:function(b,c,f){return h5c3.Deferred(function(g){h5c3.each({done:[b,"resolve"],
fail:[c,"reject"],progress:[f,"notify"]},function(b,c){var f=c[0],h=c[1],k;if(h5c3.isFunction(f))m[b](function(){if((k=f.apply(this,arguments))&&h5c3.isFunction(k.promise))k.promise().then(g.resolve,g.reject,g.notify);else g[h+"With"](this===m?g:this,[k])});else m[b](g[h])})}).promise()},promise:function(b){if(null==b)b=l;else for(var c in l)b[c]=l[c];return b}},m=l.promise({}),p;for(p in k)m[p]=k[p].fire,m[p+"With"]=k[p].fireWith;m.done(function(){h="resolved"},f.disable,g.lock).fail(function(){h=
"rejected"},c.disable,g.lock);b&&b.call(m,m);return m},when:function(b){function c(b){return function(c){h[b]=1<arguments.length?g.call(arguments,0):c;--p||n.resolveWith(n,h)}}function f(b){return function(c){m[b]=1<arguments.length?g.call(arguments,0):c;n.notifyWith(q,m)}}var g=[].slice,h=g.call(arguments,0),k=0,l=h.length,m=Array(l),p=l,n=1>=l&&b&&h5c3.isFunction(b.promise)?b:h5c3.Deferred(),q=n.promise();if(1<l){for(;k<l;k++)h[k]&&h[k].promise&&h5c3.isFunction(h[k].promise)?h[k].promise().then(c(k),
n.reject,f(k)):--p;p||n.resolveWith(n,h)}else n!==b&&n.resolveWith(n,l?[b]:[]);return q}});
(function(b){var c=/_|-/,f=/::/,g=/([A-Z]+)([A-Z][a-z])/g,h=/([a-z\d])([A-Z])/g,k=/([a-z\d])([A-Z])/g,l=/\{([^\}]+)\}/g,m=/\./,p=function(b){return(b=typeof b)&&("function"==b||"object"==b)},n=function(c,f,g){c=c?c.split(m):[];var h=c.length;f=b.isArray(f)?f:[f||window];var k,l,n,q=0;if(0==h)return f[0];for(;k=f[q++];){for(n=0;n<h-1&&p(k);n++)k=k[c[n]]||g&&(k[c[n]]={});if(p(k)&&(l=k[c[n]]||g&&(k[c[n]]={}),void 0!==l))return!1===g&&delete k[c[n]],l}},q=b.String={getObject:n,capitalize:function(b){return b.charAt(0).toUpperCase()+
b.substr(1)},camelize:function(b){b=q.classize(b);return b.charAt(0).toLowerCase()+b.substr(1)},classize:function(b,f){for(var g=b.split(c),h=0;h<g.length;h++)g[h]=q.capitalize(g[h]);return g.join(f||"")},niceName:function(b){return q.classize(b," ")},underscore:function(b){return b.replace(f,"/").replace(g,"$1_$2").replace(h,"$1_$2").replace(k,"_").toLowerCase()},sub:function(b,c,f){var g=[];g.push(b.replace(l,function(b,h){var k=n(h,c,"boolean"==typeof f?!f:f),l=typeof k;if("object"!==l&&"function"!==
l||null===l)return""+k;g.push(k);return""}));return 1>=g.length?g[0]:g}}})(h5c3);
(function(b){var c=!1,f=b.makeArray,g=b.isFunction,h=b.isArray,k=b.extend,l=function(b){if(!b||"object"!=typeof b)return b;if(b instanceof Array){for(var c=[],f=0;f<b.length;f++)c[f]=l(b[f]);return c}c={};for(f in b)c[f]=l(b[f]);return c},m=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,p=function(b,c,f){f=f||b;for(var h in b)f[h]=g(b[h])&&g(c[h])&&m.test(b[h])?function(b,f){return function(){var g=this._super,h;this._super=c[b];h=f.apply(this,arguments);this._super=g;return h}}(h,b[h]):b[h]},n=b.Class=
function(){if(arguments.length)return n.extend.apply(n,arguments)};k(n,{callback:function(b){var c=f(arguments),g;b=c.shift();h(b)||(b=[b]);g=this;return function(){for(var k=c.concat(f(arguments)),l,m=b.length,n=0,p;n<m;n++)if(p=b[n])(l="string"==typeof p)&&g._set_called&&(g.called=p),k=(l?g[p]:p).apply(g,k||[]),n<m-1&&(k=!h(k)||k._use_call?[k]:k);return k}},getObject:b.String.getObject,newInstance:function(){var b=this.rawInstance(),c;b.setup&&(c=b.setup.apply(b,arguments));for(var f in b.__proto__)b[f]=
l(b[f]);b.init&&b.init.apply(b,h(c)?c:arguments);return b},setup:function(b,c){this.defaults=k(!0,{},b.defaults,this.defaults);void 0==this._types&&(this._types=[]);this._types.push(this.fullName);void 0==this._fullTypeName&&(this._fullTypeName="|");this._fullTypeName+=this.fullName+"|";return arguments},rawInstance:function(){c=!0;var b=new this;c=!1;return b},extend:function(b,g,h){function m(){if(!c)try{return this.constructor!==m&&arguments.length?arguments.callee.extend.apply(arguments.callee,
arguments):this.Class.newInstance.apply(this.Class,arguments)}catch(b){return _DBG_(printStackTrace({e:b}),this.Class),null}}"string"!=typeof b&&(h=g,g=b,b=null);h||(h=g,g=null);h=h||{};var v=this.prototype,s,t,r,y;this.isA=function(b){return-1!=this._fullTypeName.indexOf("|"+b+"|")};c=!0;y=new this;c=!1;p(h,v,y);for(s in this)this.hasOwnProperty(s)&&(m[s]=l(this[s]));p(g,this,m);b&&(v=b.split(/\./),t=v.pop(),s="",0<v.length&&(r=s=n.getObject(v.join("."),window,!0)),s[t]=m);k(m,{prototype:y,namespace:r,
shortName:t,constructor:m,fullName:b});m.prototype.Class=m.prototype.constructor=m;t=m.setup.apply(m,[this].concat(f(arguments)));m.init&&m.init.apply(m,t||[]);return m}});n.prototype.callback=n.callback})(h5c3);
h5c3.Base=h5c3.Class("h5c3.Base",{_CLASSVERSION:"0.4.3",totalObjects:0,WARN:"WARN",DEBUG:"DEBUG",ERROR:"ERROR",INFO:"INFO",log:function(b,c,f){var g=GEI("waConsoleLog"),h="";b&&(h=":"+b);b=[this.fullName+h+"\t\t ["+c+"] \t\t"].concat(Array.prototype.slice.call(f));VLD(g)&&(g.value+=b+"\n",g.scrollTop=g.scrollHeight);window.console.log.apply(console,b)},warn:function(b){this.log(null,this.WARN,b)},debug:function(b){this.log(null,this.DEBUG,b)},error:function(b){this.log(null,this.ERROR,b)},info:function(b){this.log(null,
this.INFO,b)},assert:function(b,c){if(!c)throw b;}},{objectId:0,uniqueId:null,init:function(){},setup:function(){this.objectId=this.Class.totalObjects++;this.uniqueId=this.Class.fullName+":"+this.objectId},getUniqueId:function(){return this.uniqueId},hashCode:function(){return this.getUniqueId()},warn:function(){this.Class.log(this.objectId,this.Class.WARN,arguments)},debug:function(){this.Class.log(this.objectId,this.Class.DEBUG,arguments)},error:function(){this.Class.log(this.objectId,this.Class.ERROR,
arguments)},info:function(){this.Class.log(this.objectId,this.Class.INFO,arguments)},toString:function(){return this.Class.fullName+" [id: "+this.objectId+"]"}});
h5c3.Device=h5c3.Base.extend("h5c3.Device",{_CLASSNAME:"Device",_CLASSVERSION:"1.1.0",pixelRatio:0,isiPhone:!1,isiPhone4:!1,isiPad:!1,isiPod:!1,isAndroid:!1,isTouch:!1,isFirefox:!1,isChrome:!1,isOpera:!1,isIE:!1,ieVersion:0,requestAnimFrame:null,hasMemoryProfiling:!1,canPlayOgg:!1,canPlayMP3:!1,canPlayWav:!1,init:function(){this.pixelRatio=window.devicePixelRatio||1;this.isiPhone=-1!=navigator.userAgent.toLowerCase().indexOf("iphone");this.isiPod=-1!=navigator.userAgent.toLowerCase().indexOf("ipod");
this.isiPhone4=2==this.pixelRatio&&this.isiPhone;this.isiPad=-1!=navigator.userAgent.toLowerCase().indexOf("ipad");this.isAndroid=-1!=navigator.userAgent.toLowerCase().indexOf("android");this.isFirefox=-1!=navigator.userAgent.toLowerCase().indexOf("firefox");this.isChrome=-1!=navigator.userAgent.toLowerCase().indexOf("chrome");this.isOpera=-1!=navigator.userAgent.toLowerCase().indexOf("opera");this.isTouch="undefined"!==window.ontouchstart;this.isiOS=this.isiPhone||this.iPad||this.isiPod;void 0!=
window.performance&&(this.hasMemoryProfiling=window.performance.memory);/MSIE (\d+\.\d+);/.test(navigator.userAgent)&&(this.ieVersion=new Number(RegExp.$1),this.isIE=!0);var b=new Audio;b.canPlayType("audio/ogg")&&(this.canPlayOgg=!0);b.canPlayType("audio/mpeg")&&(this.canPlayMP3=!0);b.canPlayType("audio/x-wav")&&(this.canPlayWav=!0);this.requestAnimFrame=function(){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||
window.msRequestAnimationFrame||function(b){window.setTimeout(b,16,Date.now())};return function(f,g){b.apply(window,[f,g])}}()},canPlay:function(b){return"mp3"===b.toLowerCase()&&this.canPlayMP3||"ogg"===b.toLowerCase()&&this.canPlayOgg||"wav"===b.toLowerCase()&&this.canPlayWav?!0:!1},getUsedHeap:function(){return this.hasMemoryProfiling?window.performance.memory.usedJSHeapSize:0},getTotalHeap:function(){return this.hasMemoryProfiling?window.performance.memory.totalJSHeapSize:0}},{});
h5c3.HashList=h5c3.Base.extend("h5c3.HashList",{_CLASSNAME:"HashList",_CLASSVERSION:"0.4.4"},{hashtable:null,init:function(){this.hashtable=new h5c3.Hashtable},add:function(b,c){var f=this.hashtable.get(b);null==f&&(f=new pc.LinkedList,this.hashtable.put(b,f));f.add(c)},remove:function(b,c){var f=this.hashtable.get(b);if(null==f)throw"No list for a key in hashlist when removing";f.remove(c)},get:function(b){return this.hashtable.get(b)}});
h5c3.Hashtable=function(){function b(c){if("string"==typeof c)return c;if(typeof c.hashCode==n)return c=c.hashCode(),"string"==typeof c?c:b(c);if(typeof c.toString==n)return c.toString();try{return String(c)}catch(f){return Object.prototype.toString.call(c)}}function c(b,c){return b.equals(c)}function f(b,c){return typeof c.equals==n?c.equals(b):b===c}function g(b){return function(c){if(null===c)throw Error("null is not a valid "+b);if("undefined"==typeof c)throw Error(b+" must not be undefined");
}}function h(b,c,f,g){this[0]=b;this.entries=[];this.addEntry(c,f);null!==g&&(this.getEqualityFunction=function(){return g})}function k(b){return function(c){for(var f=this.entries.length,g,h=this.getEqualityFunction(c);f--;)if(g=this.entries[f],h(c,g[0]))switch(b){case u:return!0;case v:return g;case s:return[f,g[1]]}return!1}}function l(b){return function(c){for(var f=c.length,g=0,h=this.entries.length;g<h;++g)c[f+g]=this.entries[g][b]}}function m(b,c){var f=b[c];return f&&f instanceof h?f:null}
function p(c,f){var g=this,k=[],l={},s=typeof c==n?c:b,v=typeof f==n?f:null;this.put=function(b,c){x(b);w(c);var f=s(b),g,n=null;(g=m(l,f))?(f=g.getEntryForKey(b))?(n=f[1],f[1]=c):g.addEntry(b,c):(g=new h(f,b,c,v),k[k.length]=g,l[f]=g);return n};this.get=function(b){x(b);var c=s(b);if(c=m(l,c))if(b=c.getEntryForKey(b))return b[1];return null};this.containsKey=function(b){x(b);var c=s(b);return(c=m(l,c))?c.containsKey(b):!1};this.containsValue=function(b){w(b);for(var c=k.length;c--;)if(k[c].containsValue(b))return!0;
return!1};this.clear=function(){k.length=0;l={}};this.isEmpty=function(){return!k.length};var u=function(b){return function(){for(var c=[],f=k.length;f--;)k[f][b](c);return c}};this.keys=u("keys");this.values=u("values");this.entries=u("getEntries");this.remove=function(b){x(b);var c=s(b),f=null,g=m(l,c);if(g&&(f=g.removeEntryForKey(b),null!==f&&!g.entries.length)){a:{for(b=k.length;b--;)if(g=k[b],c===g[0])break a;b=null}q(k,b);delete l[c]}return f};this.size=function(){for(var b=0,c=k.length;c--;)b+=
k[c].entries.length;return b};this.each=function(b){for(var c=g.entries(),f=c.length,h;f--;)h=c[f],b(h[0],h[1])};this.putAll=function(b,c){for(var f=b.entries(),h,k,l,m=f.length,p=typeof c==n;m--;)h=f[m],k=h[0],h=h[1],p&&(l=g.get(k))&&(h=c(k,l,h)),g.put(k,h)};this.clone=function(){var b=new p(c,f);b.putAll(g);return b};this.toString=function(){for(var b="",c=this.keys(),f=0;f<c.length;f++)var g=this.get(c[f]),b=b+(c[f].toString()+" = "+g.toString()+"\n");return b}}var n="function",q=typeof Array.prototype.splice==
n?function(b,c){b.splice(c,1)}:function(b,c){var f,g,h;if(c===b.length-1)b.length=c;else for(f=b.slice(c+1),b.length=c,g=0,h=f.length;g<h;++g)b[c+g]=f[g]},x=g("key"),w=g("value"),u=0,v=1,s=2;h.prototype={getEqualityFunction:function(b){return typeof b.equals==n?c:f},getEntryForKey:k(v),getEntryAndIndexForKey:k(s),removeEntryForKey:function(b){return(b=this.getEntryAndIndexForKey(b))?(q(this.entries,b[0]),b[1]):null},addEntry:function(b,c){this.entries[this.entries.length]=[b,c]},keys:l(0),values:l(1),
getEntries:function(b){for(var c=b.length,f=0,g=this.entries.length;f<g;++f)b[c+f]=this.entries[f].slice(0)},containsKey:k(u),containsValue:function(b){for(var c=this.entries.length;c--;)if(b===this.entries[c][1])return!0;return!1}};return p}();h5c3.LinkedNode=h5c3.Base.extend("h5c3.LinkedNode",{_CLASSVERSION:"0.1.0"},{obj:null,nextLinked:null,prevLinked:null,free:!0,init:function(){this._super()},next:function(){return this.nextLinked},object:function(){return this.obj},prev:function(){return this.prevLinked}});
h5c3.LinkedList=h5c3.Base.extend("h5c3.LinkedList",{_CLASSNAME:"LinkedList",_CLASSVERSION:"0.1.0"},{first:null,last:null,count:0,objToNodeMap:null,init:function(){this._super();this.objToNodeMap=new h5c3.Hashtable},getNode:function(b){return this.objToNodeMap.get(b.getUniqueId())},addNode:function(b){var c=new h5c3.LinkedNode;c.obj=b;c.prevLinked=null;c.nextLinked=null;c.free=!1;this.objToNodeMap.put(b.getUniqueId(),c);return c},add:function(b){var c=this.getNode(b);if(null==c)c=this.addNode(b);else{if(!1===
c.free)throw"Attempting to add object: "+b.getUniqueId()+" twice to list "+this.getUniqueId();c.obj=b;c.free=!1;c.nextLinked=null;c.prevLinked=null}if(null==this.first)this.last=this.first=c,c.nextLinked=null,c.prevLinked=null;else{if(null==this.last)throw"Hmm, no last in the list -- that shouldn't happen here";this.last.nextLinked=c;c.prevLinked=this.last;this.last=c;c.nextLinked=null}this.count++;this.showDebug&&this.dump("after add")},has:function(b){b=this.getNode(b);return!(null===b||!0===b.free)},
moveUp:function(b){this.dump("before move up");b=this.getNode(b);if(!b)throw"Oops, trying to move an object that isn't in the list";if(null!=b.prevLinked){var c=b.prevLinked,f=c.prevLinked;b==this.last&&(this.last=c);var g=b.nextLinked;f&&(f.nextLinked=b);b.nextLinked=c;b.prevLinked=c.prevLinked;c.nextLinked=g;c.prevLinked=b;this.first==c&&(this.first=b)}},moveDown:function(b){b=this.getNode(b);if(!b)throw"Oops, trying to move an object that isn't in the list";if(null!=b.nextLinked){var c=b.nextLinked;
this.moveUp(c.obj);this.last==c&&(this.last=b)}},sort:function(b){for(var c=[],f=this.first;f;)c.push(f.object()),f=f.next();this.clear();c.sort(b);for(b=0;b<c.length;b++)this.add(c[b])},remove:function(b){this.showDebug&&this.dump("before remove of "+b);b=this.getNode(b);if(null===b||!0===b.free)return!1;null!=b.prevLinked&&(b.prevLinked.nextLinked=b.nextLinked);null!=b.nextLinked&&(b.nextLinked.prevLinked=b.prevLinked);null==b.prevLinked&&(this.first=b.nextLinked);null==b.nextLinked&&(this.last=
b.prevLinked);b.free=!0;b.prevLinked=null;b.nextLinked=null;this.count--;this.showDebug&&this.dump("after remove");return!0},clear:function(){for(var b=this.first;null!=b;)b.free=!0,b=b.nextLinked;this.first=null;this.count=0},length:function(){return this.count},dump:function(b){_DBG_("===================="+b+"=====================",this.Class);for(b=this.first;null!=b;)_DBG_("{"+b.obj.toString()+"} previous="+(b.prevLinked?b.prevLinked.obj:"NULL"),this.Class),b=b.next();b="Last: {"+(this.last?this.last.obj:
"NULL")+"} First: {"+(this.first?this.first.obj:"NULL")+"}";_DBG_("===================================",this.Class);_DBG_(b,this.Class)}});
h5c3.PerformanceMeasure=h5c3.Base.extend("h5c3.PerformanceMeasure",{_CLASSNAME:"PerformanceMeasure",_CLASSVERSION:"0.1.0",history:[],clearHistory:function(){history.length=0}},{timeStart:0,timeEnd:0,timeDelat:0,memStart:0,memEnd:0,memDelta:0,description:null,init:function(b){this.description=b;this.start();this.Class.history.push(this)},start:function(){this.timeStart=Date.now();this.memStart=h5c3.Device.getUsedHeap()},end:function(){this.timeEnd=Date.now();this.timeDelta=this.timeEnd-this.timeStart;
this.memEnd=h5c3.Device.getUsedHeap();this.memDelta=this.memEnd<this.memStart?0:this.memEnd-this.memStart;return this.toString()},toString:function(){return this.description+" took "+this.timeDelta+"ms, "+(0==this.memDelta?"unknown":this.memDelta)+" byte(s)"}});
h5c3.Pool=h5c3.Base.extend("h5c3.Pool",{_CLASSNAME:"Pool",_CLASSVERSION:"0.1.0",INITIAL_POOL_SIZE:1,pools:new h5c3.Hashtable,totalPooled:0,totalUsed:0,acquire:function(b){var c=this.getPool(b);if(void 0==c||null==c)c=new h5c3.Pool(b,this.INITIAL_POOL_SIZE),this.pools.put(b.fullName,c);return c.acquire()},release:function(b){var c=this.pools.get(b.Class.fullName);if(void 0==c)throw"Oops, trying to release an object of type "+b.Class.fullName+" but no pool exists. Did you new an object instead of using create.";
c.release(b)},getPool:function(b){return this.pools.get(b.fullName)},getStats:function(){for(var b="",c=this.pools.keys(),f=0;f<c.length;f++)var g=c[f],h=this.pools.get(g),b=b+(g+": "+h.getStats()+"\n");return b}},{freeList:null,expansion:1,traces:null,init:function(b,c){this._super();this.classType=b;this.freeList=[];this.expand(c)},startTracing:function(){this.tracing||(this.tracing=!0,this.traces?this.traces.clear():this.traces=new h5c3.Hashtable)},stopTracing:function(){this.tracing=!1},expand:function(b){h5c3.Pool.totalPooled+=
b;for(var c=0;c<b;c++)this.freeList.push(new this.classType)},getFreeCount:function(){return this.freeList.length},acquire:function(){0>=this.freeList.length&&(this.expansion=Math.round(1.2*this.expansion)+1,this.expand(this.expansion));if(this.tracing){for(var b=printStackTrace(),c=b.length-1;0==b[c].indexOf("Class.addTo")&&0<c;)c--;var f=this.traces.get(b[c]);null==f?this.traces.put(b[c],{value:1}):f.value++}return this.freeList.pop()},release:function(b){this.freeList.push(b)},getStats:function(){var b=
this.Class.fullName+" stats: "+this.freeList.length+" free.";if(this.tracing){var b=b+"TRACING\n",c=this.traces.keys(),f;for(f in c)b+=c[f]+" ("+this.traces.get(c[f]).value+")\n"}return b},dump:function(b){this.info("================== "+b+" ===================");this.info("FREE");this.freeList.dump()},size:function(){return this.freeList.length},getFreeList:function(){return this.freeList}});
h5c3.DualPool=h5c3.Pool.extend("h5c3.DualPool",{_CLASSNAME:"DualPool",_CLASSVERSION:"0.1.0",acquire:function(b){var c=this.getPool(b);if(void 0==c||null==c)c=new h5c3.DualPool(b,this.INITIAL_POOL_SIZE),this.pools.put(b.fullName,c);return c.acquire()},getStats:function(){for(var b="",c=this.pools.keys(),f=0;f<c.length;f++)var g=c[f],h=this.pools.get(g),b=b+(g+" (free: "+h.freeList.length()+" used: "+h.usedList.length()+")\n");return b}},{freeList:null,usedList:null,init:function(b,c){this.classType=
b;this.usedList=new h5c3.LinkedList;this.freeList=new h5c3.LinkedList;this.expand(c)},expand:function(b){h5c3.Pool.totalPooled+=b;for(var c=0;c<b;c++)this.freeList.add(new this.classType)},returnObj:null,acquire:function(){null==this.freeList.first&&this.expand(Math.round(this.size()/5)+1);this.returnObj=this.freeList.first.obj;this.freeList.remove(this.returnObj);this.returnObj.destroyed=!1;this.usedList.add(this.returnObj);if(this.tracing){for(var b=printStackTrace(),c=b.length-1;0==b[c].indexOf("Class.addTo")&&
0<c;)c--;var f=this.traces.get(b[c]);null==f?this.traces.put(b[c],{value:1}):f.value++}return this.returnObj},release:function(b){this.freeList.add(b);this.usedList.remove(b)},dump:function(b){this.info("================== "+b+" ===================");this.info("FREE");this.freeList.dump();this.info("USED");this.usedList.dump()},size:function(){return this.freeList.count+this.usedList.count},getUsedList:function(){return this.usedList}});
h5c3.Pooled=h5c3.Base.extend("h5c3.Pooled",{_CLASSNAME:"Pooled",_CLASSVERSION:"0.1.0",create:function(){return h5c3.Pool.acquire(this)},getPool:function(){return h5c3.Pool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease();h5c3.Pool.release(this)},onRelease:function(){}});
h5c3.DualPooled=h5c3.Base.extend("h5c3.DualPooled",{_CLASSNAME:"DualPooled",_CLASSVERSION:"0.1.0",create:function(){return h5c3.DualPool.acquire(this)},getPool:function(){return h5c3.DualPool.getPool(this)}},{destroyed:!1,init:function(){this._super()},release:function(){this.onRelease();h5c3.DualPool.release(this)},onRelease:function(){}});h5c3.factories={};h5c3.plugin=new h5c3.Hashtable;h5c3.systems=new h5c3.Hashtable;h5c3.components=new h5c3.Hashtable;_DBG_(h5c3.tag()+" loaded.",h5c3);
h5c3.ErrorHandler=h5c3.Base.extend("h5c3.ErrorHandler",{_CLASSNAME:"ErrorHandler",_CLASSVERSION:"0.1.0",tag:function(){return this._CLASSNAME+" v"+this._CLASSVERSION}},{ready:!1,errArgs:null,done:!1,total:0,currOurs:!1,currType:null,currMSG:!1,currStack:!1,currCaller:!1,whoName:"",whoPath:"",init:function(){this._super();DOC().addEventListener("H5C3Error",h5c3.bind(this,this.onH5C3Error),!1);_DBG_("Listening.",this.Class);this.ready=!0},_handleWhatArray:function(b){if("Array"===ISA(b)){this.currType=
1;var c=b.pop(),f=1<c.length?c.pop():c;if(VLD(f)){"undefined"===ISA(f.message)?this.currMSG=c.toString():this.currMSG=f.__proto__.name+":"+f.message;"Array"!==ISA(c)&&(c=b);for(i=0;i<c.length;i++)if(loc=c[i].contains("@file:"))$tmp3=c[i].split("@file:"),c[i]=$tmp3[0];this.currStack=c;return b}}},reset:function(){this.total=0;this.currOurs=!1;this.currType=-1;this.currMSG="";this.currStack=!1;this.currCaller=""},who:function(){CHK(this.errArgs,null);CHK(this.whoName,"Unknown");for(i=0;i<this.errArgs.length;i++)"string"!==
typeof this.errArgs[i]&&(this.errArgs[i]._fullTypeName?(this.whoName=this.errArgs[i].fullName+"-"+this.errArgs[i]._CLASSVERSION,this.whoPath=this.errArgs[i]._fullTypeName):this.errArgs[i]._CLASSNAME?(this.whoName=this.errArgs[i]._CLASSNAME+"-"+this.errArgs[i]._CLASSVERSION,this.whoPath="h5c3"):CHK(this.whoName,"Unknown"));this.whoName=String.prototype.pad(this.whoName,30);this.whoPath=String.prototype.pad(this.whoPath,50)},what:function(){switch(this.errArgs.length){case 1:h5c3.isString(this.errArgs[0])?
(this.currType=0,this.currMSG=this.errArgs[0]):h5c3.isArray(this.errArgs[0])?this._handleWhatArray(this.errArgs[0]):h5c3.isH5C3(this.errArgs[0])?this.currType=2:h5c3.isObject(this.errArgs)?this.currType=3:h5c3.isFunction(this.errArgs)&&(this.currType=4);break;case 2:h5c3.isString(this.errArgs[0])&&(h5c3.isH5C3(this.errArgs[1])||h5c3.isObject(this.errArgs[1])||h5c3.isFunction(this.errArgs[1]))?(this.currType=0,this.who(this.errArgs[1]),this.currMSG=this.errArgs[0]):h5c3.isArray(this.errArgs[0])&&this._handleWhatArray(this.errArgs[0])}},
when:function(){},prepEmail:function(){return'<a href="mailto:support@i2tmlabs.com?subject=H5C3%20Error%20Report&body=What:'+this.whoName+"\nError:"+this.currMSG+"\nTrace:"+this.currStack.toString()+"\nDistro:"+h5c3.tag()+'\n">Is this our fault? Send It!</a>'},display:function(){switch(this.currType){case 0:console.log("411:%c%s %s > %s","color: green;",this.whoName,this.whoPath,this.currMSG);break;case 1:console.error("911:%cOH SNAP! - Sucks to be you right now.\n%s %s > %s\nTrace: %O","color: red;",
this.whoName,this.whoPath,this.currMSG,this.currStack)}},onH5C3Error:function(b){this.done=!1;this.reset();this.errArgs=b.arguments;this.what();this.who();this.display();this.done=!0}});h5c3.errorhandler=new h5c3.ErrorHandler;
h5c3.LZW=h5c3.Base.extend("h5c3.LZW",{_CLASSNAME:"LZW",_CLASSVERSION:"1.0.0"},{init:function(){this._super()},encode:function(b){var c={};b=(b+"").split("");for(var f=[],g,h=b[0],k=256,l=1;l<b.length;l++)g=b[l],null!=c[h+g]?h+=g:(f.push(1<h.length?c[h]:h.charCodeAt(0)),c[h+g]=k,k++,h=g);f.push(1<h.length?c[h]:h.charCodeAt(0));for(l=0;l<f.length;l++)f[l]=String.fromCharCode(f[l]);return f.join("")},decode:function(b){var c={};b=(b+"").split("");for(var f=b[0],g=f,h=[f],k=256,l,m=1;m<b.length;m++)l=
b[m].charCodeAt(0),l=256>l?b[m]:c[l]?c[l]:g+f,h.push(l),f=l.charAt(0),c[k]=g+f,k++,g=l;return h.join("")}});
h5c3.Tools=h5c3.Base.extend("h5c3.Tools",{_CLASSNAME:"Tools",_CLASSVERSION:"0.5.6",arrayRemove:function(b,c){for(var f=b.length-1;0<=f;f--)b[f]==c&&b.splice(f,1)},arrayExclusiveAdd:function(b,c){-1==b.indexOf(c)&&b.push(c)},mapDOM:function(b,c){function f(b,c){c.type=b.nodeName;var g=b.childNodes;if(null!=g&&g.length){c.content=[];for(var m=0;m<g.length;m++)3==g[m].nodeType?c.content.push(g[m].nodeValue):(c.content.push({}),f(g[m],c.content[c.content.length-1]))}if(null!=b.attributes&&b.attributes.length)for(c.attributes=
{},m=0;m<b.attributes.length;m++)c.attributes[b.attributes[m].nodeName]=b.attributes[m].nodeValue}var g={};"string"===typeof b&&(window.DOMParser?(parser=new DOMParser,docNode=parser.parseFromString(b,"text/xml")):(docNode=new ActiveXObject("Microsoft.XMLDOM"),docNode.async=!1,docNode.loadXML(b)),b=docNode.firstChild);f(b,g);return c?JSON.stringify(g):g},xmlToJson:function(b,c){var f={toObj:function(b){var c={};if(1==b.nodeType){if(b.attributes.length)for(var g=0;g<b.attributes.length;g++)c[b.attributes[g].nodeName]=
(b.attributes[g].nodeValue||"").toString();if(b.firstChild){for(var m=g=0,p=!1,n=b.firstChild;n;n=n.nextSibling)1==n.nodeType?p=!0:3==n.nodeType&&n.nodeValue.match(/[^ \f\n\r\t\v]/)?g++:4==n.nodeType&&m++;if(p)if(2>g&&2>m)for(f.removeWhite(b),n=b.firstChild;n;n=n.nextSibling)3==n.nodeType?c["#text"]=f.escape(n.nodeValue):4==n.nodeType?c["#cdata"]=f.escape(n.nodeValue):c[n.nodeName]?c[n.nodeName]instanceof Array?c[n.nodeName][c[n.nodeName].length]=f.toObj(n):c[n.nodeName]=[c[n.nodeName],f.toObj(n)]:
c[n.nodeName]=f.toObj(n);else b.attributes.length?c["#text"]=f.escape(f.innerXml(b)):c=f.escape(f.innerXml(b));else if(g)b.attributes.length?c["#text"]=f.escape(f.innerXml(b)):c=f.escape(f.innerXml(b));else if(m)if(1<m)c=f.escape(f.innerXml(b));else for(n=b.firstChild;n;n=n.nextSibling)c["#cdata"]=f.escape(n.nodeValue)}b.attributes.length||b.firstChild||(c=null)}else 9==b.nodeType?c=f.toObj(b.documentElement):alert("unhandled node type: "+b.nodeType);return c},toJson:function(b,c,g){var m=c?'"'+c+
'"':"";if(b instanceof Array){for(var p=0,n=b.length;p<n;p++)b[p]=f.toJson(b[p],"",g+"\t");m+=(c?":[":"[")+(1<b.length?"\n"+g+"\t"+b.join(",\n"+g+"\t")+"\n"+g:b.join(""))+"]"}else if(null==b)m+=(c&&":")+"null";else if("object"==typeof b){p=[];for(n in b)p[p.length]=f.toJson(b[n],n,g+"\t");m+=(c?":{":"{")+(1<p.length?"\n"+g+"\t"+p.join(",\n"+g+"\t")+"\n"+g:p.join(""))+"}"}else m="string"==typeof b?m+((c&&":")+'"'+b.toString()+'"'):m+((c&&":")+b.toString());return m},innerXml:function(b){var c="";if("innerHTML"in
b)c=b.innerHTML;else{var f=function(b){var c="";if(1==b.nodeType){for(var c=c+("<"+b.nodeName),g=0;g<b.attributes.length;g++)c+=" "+b.attributes[g].nodeName+'="'+(b.attributes[g].nodeValue||"").toString()+'"';if(b.firstChild){c+=">";for(g=b.firstChild;g;g=g.nextSibling)c+=f(g);c+="</"+b.nodeName+">"}else c+="/>"}else 3==b.nodeType?c+=b.nodeValue:4==b.nodeType&&(c+="<![CDATA["+b.nodeValue+"]]\x3e");return c};for(b=b.firstChild;b;b=b.nextSibling)c+=f(b)}return c},escape:function(b){return b.replace(/[\\]/g,
"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(b){b.normalize();for(var c=b.firstChild;c;)if(3==c.nodeType)if(c.nodeValue.match(/[^ \f\n\r\t\v]/))c=c.nextSibling;else{var g=c.nextSibling;b.removeChild(c);c=g}else 1==c.nodeType&&f.removeWhite(c),c=c.nextSibling;return b}};9==b.nodeType&&(b=b.documentElement);var g=f.toJson(f.toObj(f.removeWhite(b)),b.nodeName,"\t");return"{\n"+c+(c?g.replace(/\t/g,c):g.replace(/\t|\n/g,""))+"\n}"}},{});
h5c3.tools=new h5c3.Tools;
h5c3.Media=h5c3.Base.extend("h5c3.Media",{_CLASSNAME:"Media",_CLASSVERSION:"0.7.7",browser:{name:"Unknown",version:"Unknown"},OS:{name:"Unknown",version:"Unknown"},init:function(){this.browser.name=this.searchString(this.dataBrowser)||"Unknown";this.browser.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"Unknown";this.OS.name=this.searchString(this.dataOS)||"Unknown";this.OS.version=this.searchString(this.dataOS)||"Unknown"},searchString:function(b){for(var c=0;c<
b.length;c++){var f=b[c].string,g=b[c].prop;this.versionSearchString=b[c].versionSearch||b[c].identity;if(f){if(-1!=f.indexOf(b[c].subString))return b[c].identity}else if(g)return b[c].identity}},searchVersion:function(b){var c=b.indexOf(this.versionSearchString);if(-1!=c)return parseFloat(b.substring(c+this.versionSearchString.length+1))},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},
{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,
subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"},{prop:window.opera,identity:"Opera"}],dataOS:[{string:navigator.platform,subString:"Win64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"WOW64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"Win32",identity:"Windows 32Bit"},{string:navigator.platform,subString:"x86_64",identity:"Windows 64Bit"},{string:navigator.platform,
subString:"x86-64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"x64;",identity:"Windows 64Bit"},{string:navigator.platform,subString:"x64_64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"Win64",identity:"Windows 64Bit"},{string:navigator.platform,subString:"Mac",identity:"Macintosh"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"},{string:navigator.platform,subString:"Android",
identity:"Android"}]},{});
h5c3.Hashmap=h5c3.Base.extend("h5c3.Hashmap",{_CLASSNAME:"Hashmap",_CLASSVERSION:"0.5.7"},{length:0,items:{},put:function(b,c){if(!VLD(b))throw"invaid key";this.items[b]=c;this.length++},get:function(b){return this.items[b]},hasKey:function(b){return this.items.hasOwnProperty(b)},remove:function(b){this.hasKey(b)&&(this.length--,delete this.items[b])},keys:function(){var b,c=[];for(b in this.items)c.push(b);return c},values:function(){var b,c=[];for(b in this.items)c.push(this.items[b]);return c},
clear:function(){this.items={};this.length=0}});
h5c3.LocalStorage=h5c3.Base.extend("h5c3.LocalStorage",{_CLASSNAME:"LocalStorage",_CLASSVERSION:"0.1.5",create:function(b){this._addMethods();return this._prepare(b)?this.prototype:!1},_addMethods:function(){Storage.prototype.setObject=function(b,c){var f=JSON.stringify(c);this.setItem(b,f)};Storage.prototype.getObject=function(b){b=this.getItem(b);if(VLD(b))return $tmp2=JSON.parse(b)}},setup:function(b){"String"===ISA(b)&&(VLD(this.prototype.data[b])||(this.prototype.data[b]={}),VLD(this.prototype.data[b].cfg)||
(this.prototype.data[b].cfg={}),VLD(this.prototype.data[b].files)||(this.prototype.data[b].files={}))},isSupported:function(){var b="Checking for Local Storage Support...";"undefined"!==typeof Storage?(b+="Supported.",this.prototype.supported=!0):(b+="Not Supported.",this.prototype.supported=!1);_DBG_(b,this);return this.prototype.supported},load:function(b){this.prototype.data.global=localStorage.getObject("global");this.prototype.data[b]=localStorage.getObject(b);this.setup("global");this.setup(b)},
remove:function(b){this.enabled&&this.isSupported()&&($use=0===b?"global":this.prototype.appName,localStorage.removeItem($use),_DBG_("Removed "+$use+".",this))},what_where:function(b){return 0===b?{where:"global",what:"cfg"}:1===b?{where:"global",what:"files"}:2===b?{where:this.prototype.appName,what:"cfg"}:3===b?{where:this.prototype.appName,what:"files"}:null},get:function(b,c){if(this.enabled&&this.isSupported()){$use=this.what_where(c);try{if(b in this.prototype.data[$use.where][$use.what])return this.prototype.data[$use.where][$use.what][b]}catch(f){localStorage.removeItem(this.prototype.data[$use.where][$use.what][b]),
_DBG_("Removed corrupted entry "+$use.where+"->"+$use.what+"->"+b,this),_DBG_(printStackTrace({e:f}),this)}}return null},set:function(b,c,f){if(this.enabled&&this.isSupported()){f=this.what_where(f);try{return this.prototype.data[f.where][f.what][b]=c,localStorage.setObject(f.where,this.prototype.data[f.where]),this.prototype.data[f.where][f.what][b]}catch(g){_DBG_(printStackTrace({e:g}),this)}}},_prepare:function(b){this.enabled&&this.isSupported()&&(this.prototype.appName=(new String(config.app.name.split(" ").join(""))).camelize(),
this.load(this.prototype.appName),"firstVisit"in this.prototype.data.global.cfg||(this.set("firstVisit",!0,0),this.set("firstVisitTime",Date.now(),0)),"firstVisit"in this.prototype.data[this.prototype.appName].cfg||(this.set("firstVisit",!0,2),this.set("firstVisitTime",Date.now(),2)));return!0}},{data:{},appName:"",supported:!1,enabled:!1,init:function(){this._super()},removeGlobal:function(){this.Class.remove(0)},removeApp:function(){this.Class.remove(1)},getGlobalCfg:function(b){return this.Class.get(b,
0)},setGlobalCfg:function(b,c){this.Class.set(b,c,0)},getGlobalFile:function(b){return this.Class.get(b,1)},setGlobalFile:function(b,c){this.Class.set(b,c,1)},getAppCfg:function(b){return this.Class.get(b,2)},setAppCfg:function(b,c){this.Class.set(b,c,2)},getAppFile:function(b){return this.Class.get(b,3)},setAppFile:function(b,c){this.Class.set(b,c,3)}});
h5c3.AccuTimer=function(b,c,f,g){function h(){if(m++>=k)g(k,m);else{f(k,m,c);var b=(new Date).getTime()-p-m*l;window.setTimeout(h,l-b)}}0>=b&&(b=864E5);0>=c&&(c=1);var k=b/100*(c/10),l=b/k,m=0,p=(new Date).getTime();window.setTimeout(h,l)};h5c3.CallMebackIn=function(b,c){if(VLD(c))return window.setTimeout(c,b)};h5c3.FactoryWorker=h5c3.Pooled.extend("h5c3.Applet",{_CLASSNAME:"FactoryWorker",_CLASSVERSION:"0.1.3",_lastUsed:0,create:function(b){var c=this._super();return c.parse(b)?c:c.name}},{});
h5c3.Factory=h5c3.Base.extend("h5c3.Factory",{_CLASSNAME:"Factory",_CLASSVERSION:"1.3.6"},{onChanged:function(){},objects:{},idleLifeSpan:0,count:0,init:function(b,c){this._super();CHK(b,"Undefined Factory");CHK(c,0);this.factoryType=b;this.setLife(c);_DBG_(b+" Factory Initialized.",this.Class)},setLife:function(b){b*=1E3;this.idleLifeSpan!=b&&(0===b?_DBG_("Life Span is now indefinite.",this.Class):_DBG_("Life Span is set to "+this.idleLifeSpan+" seconds.",this.Class),this.idleLifeSpan=b)},create:function(){},
add:function(b,c){if(VLD(c)){if("function"===typeof this.onChanged)this.onChanged({name:b,action:"Added"});this.objects[b]=c;this.count++;return this.objects[b]}_DBG_("You cannot add ["+b+"] which is null or undefined to the ["+this.factoryType+"] store",this.Class)},remove:function(b){if(this.exists(b))try{if("function"===typeof this.onChanged)this.onChanged({name:b,action:"Removed"});delete this.objects[b];this.count--;0>this.count&&(this.count=0)}catch(c){AST(null,"No object ["+b+" exists in ["+
this.factoryType+"] store to remove.")}},exists:function(b){return this.objects.hasOwnProperty(b)?!0:!1},use:function(b){null!=typeof b&&"object"===typeof b?b=this.exists(b.name)?this.objects[b.name]:this.create(b):(this.info("Factory::use(object) - No longer takes 2 params, use object format."),b=null);return b}});
h5c3.Plugin=h5c3.Base.extend("h5c3.Plugin",{_CLASSNAME:"Plugin",_CLASSVERSION:"0.5.9"},{NAME:"Plugin",VERSION:"0.1.0",DESCRIPTION:"Base class for all plugins.",srcDir:"js/",requires:[],uses:[],init:function(b){this._super();"object"===typeof b&&(this.property=b);_DBG_("Initializing.",this.Class);this._load()},_load:function(){_DBG_("Loading Plugin "+this.NAME+" v"+this.VERSION,this.Class);if(VLD(this.uses)&&0<this.uses.length)for(var b=0,b=0;b<$this.uses.length;b++)this.add($scripts[b]);else _DBG_("No external files used by plugin.",
this.Class);_DBG_("Complete.",this.Class)},main:function(b){CHK(b,{})},done:function(){}});
h5c3.Loader=h5c3.Base.extend("h5c3.Loader",{_CLASSNAME:"Loader",_CLASSVERSION:"0.6.3"},{State:{QUEUED:0,LOADING:1,READY:2,FAILED:3},timer:null,resources:new h5c3.Hashtable,loadingListener:null,loadedListener:null,progress:0,totalBeingLoaded:0,errored:0,baseUrl:"",times:{start:0,end:0,lapsed:0},started:!1,finished:!0,_noCacheString:"",init:function(){this._super();_DBG_("Loader timer started.",this.Class);this.timer=new h5c3.AccuTimer(-1,0.5,function(){h5c3.loader.start()},function(){_DBG_("Loader timer stopped.",
this.Class)})},setDisableCache:function(){this._noCacheString="?nocache="+Date.now()},setBaseUrl:function(b){this.baseUrl=b},setListener:function(b,c){this.loadingListener=b;this.loadedListener=c},loadFile:function(b){var c=null,f=b.substr(b.lastIndexOf(".")+1);"js"===f?(c=document.createElement("script"),c.setAttribute("type","text/javascript"),c.setAttribute("src",b)):"css"===f?(c=document.createElement("link"),c.setAttribute("rel","stylesheet"),c.setAttribute("type","text/css"),c.setAttribute("href",
b)):"html"===f&&(c=document.createElement("applet"),c.setAttribute("type","text/html"),c.setAttribute("href",b));"undefined"!==c&&document.getElementsByTagName("head")[0].appendChild(c)},add:function(b){b.name=b.name.toLowerCase();this.resources.put(b.name.toLowerCase(),{resource:b,state:this.State.QUEUED});_DBG_("Adding resource "+b.src+" to the queue.",this.Class)},get:function(b){var c=this.resources.get(b.toLowerCase());VLD(c)||(this.error(this.uniqueId+"Unable to get resource "+b+". Did you forget to add it to the config?"),
c=null);return c},getAllSounds:function(){var b=[],c=this.resources.keys(),f,g;for(f=0;f<c.length;f++)g=this.resources.get(c[f]).resource,g.Class.isA("h5c3.Sound")&&b.push(g);return b},getAllImages:function(){var b=[],c=this.resources.keys(),f,g;for(f=0;f<c.length;f++)g=this.resources.get(c[f]),g.isA("h5c3.Image")&&b.push(g);return b},start:function(b,c){if(!this.started){this.started=!0;this.times.start=(new Date).getTime();var f,g,h;this.setListener(b,c);this.errored=this.progress=0;g=this.resources.keys();
for(f=0;f<g.length;f++)h=this.resources.get(g[f]),h.state===this.State.QUEUED&&(h.resource.load(this._onLoad.bind(this),this._onError.bind(this)),h.state=this.State.LOADING,this.totalBeingLoaded++);_DBG_("Loading "+this.totalBeingLoaded+" resource(s).",this.Class)}},makeUrl:function(b){return this.baseUrl+b+this._noCacheString},_onLoad:function(b){var c=this.resources.get(b.name);VLD(c)?(c.state=this.State.READY,this.progress++,VLD(this.loadingListener)&&this.loadingListener(Math.round(100*(this.progress/
this.totalBeingLoaded))),_DBG_(b.Class.shortName+" - "+b.name+" loaded ("+Math.round(100*(this.progress/this.totalBeingLoaded))+"% done)",this.Class)):this.error("Unable to get resource ["+b.name+"] - Please make sure you are using all lowercase.");this._checkAllDone()},_onError:function(b){this.resources.get(b.name).state=this.State.FAILED;this.progress++;this.errored++;VLD(this.loadingListener)&&this.loadingListener(this.progress/this.totalBeingLoaded);this.warn(b.name+" ("+b.src+") failed.");this._checkAllDone()},
_checkAllDone:function(){this.progress>=this.totalBeingLoaded&&(this.times.end=(new Date).getTime(),this.times.lapsed=this.times.start-this.times.end,this.finished=!0,this.started=!1,VLD(this.loadedListener)&&this.loadedListener(this.progress,this.errored),_DBG_("Resource Loader idle.",this.Class),this.totalBeingLoaded=this.errored=this.progress=0)}});h5c3.THROTTLESTYLE={RELAXED:0,STRICT:1,AGGRESSIVE:2,GEEZUS:3};
h5c3.Throttle=h5c3.Base.extend("h5c3.Throttle",{_CLASSNAME:"Throttle",_CLASSVERSION:"0.1.0",_style:h5c3.THROTTLESTYLE.STRICT,_AEPS:0,_current:0,_maximum:0,_minumum:0,_average:0,_interval:0,_throttle:null,_que:new h5c3.Hashtable,_reset:function(b,c,f){this._current=this._AEPS=0;this._maximum=b;this._minumum=c;this._average=Math.floor((b+c)/2);this._interval=f},_setStyle:function(b){if(this._style!==b){b<h5c3.THROTTLESTYLE.RELAXED&&(b=h5c3.THROTTLESTYLE.RELAXED);b<h5c3.THROTTLESTYLE.GEEZUS&&(b=h5c3.THROTTLESTYLE.GEEZUS);
this._style=b;switch(b){case THROTTLESTYLE.RELAXED:this._reset(11,20,10);break;case THROTTLESTYLE.STRICT:this._reset(6,10,5);break;case THROTTLESTYLE.AGGRESSIVE:this._reset(2.6,5,2.5);break;case THROTTLESTYLE.GEEZUS:this._reset(0,2.5,1.25)}this._evOnChanged()}},_evOnChanged:function(){this._stop();if("function"===typeof onChanged)this.onChanged(this._style);this._start()},_start:function(){this._running||(this._throttle=new h5c3.AccuTimer(this._interval,this._average,h5c3.bind(this,this._onProcess),
h5c3.bind(this,this._onEvaluate)),this._running=!0)},_stop:function(){this._running&&(delete this._throttle,this._running=!1)},_onProcess:function(){},_onEvaluate:function(){}},{init:function(b){this._super();this._setStyle(b)},add:function(b){var c=Date();c.getTime();c.toTimeString();this.que.put(c,b)},onProcess:function(){},onChanged:function(){}});
h5c3.Bootstrap=h5c3.Base.extend("h5c3.Bootstrap",{_CLASSNAME:"Bootstrap",_CLASSVERSION:"0.2.2"},{$baseUrl:"",$current:0,$finished:!1,$noCacheString:"",$scripts:[],init:function(){_DBG_("Initializing.",this.Class);this.$loc=this.getFileName();this._BrowserIsChrome();this.setBaseUrl(h5c3.path.home+h5c3.path.scripts+"ext/");VLD(window.Modernizr)||this.add("modernizr.all.release.js");VLD(window.jQuery)||this.add("jquery/jquery-1.10.2.min.js");h5c3.devMode&&this.handleFiles();this._start()},prepareRWD:function(){h5c3.loader=
new h5c3.Loader;h5c3.lzw=new h5c3.LZW;h5c3.local=h5c3.LocalStorage.create();h5c3.resources=new h5c3.Resources;h5c3.r2wl=new h5c3.R2WLCommon;h5c3.r2wl.start();h5c3.loader.start();$(window).load(function(){});$(document).ready(function(){})},createCanvas:function(){var b=GEI("waDIV"),c=b.clientWidth,b=b.clientHeight,f=h5c3.config.screen.target.width,g=h5c3.config.screen.target.height,h=AET("waDIV","canvas","waCANVAS");h.style.width=c+"px";h.style.height=b+"px";h.style.minWidth=c+"px";h.style.minHeight=
b+"px";h.style.maxWidth=c+"px";h.style.maxHeight=b+"px";h.width=f;h.height=g;h.style.background="Black";h5c3.config.options.fullscreen?(_DBG_("OPTION: Fullscreen mode enabled.",this.Class),DOC().addEventListener("webkitfullscreenchange",h5c3.bootstrap._onFullscreenChange),h.webkitRequestFullScreen()):_DBG_("OPTION: Fullscreen mode disabled.",this.Class);return!0},handleFiles:function(){VLD(h5c3.config)?(0<h5c3.config.files.length&&(_DBG_("Loading application files.",this.Class),this.que(h5c3.config.files,
"assets/js/")),0<h5c3.config.plugins.length&&(_DBG_("Loading application plugins.",this.Class),this.loadPlugins(h5c3.config.plugins,h5c3.path.base+h5c3.path.plugins)),h5c3.config.rwdOnly||this.que(["game.min.js"],"assets/js/")):_DBG_("h5c3.config is not defined. Cannot load and configure properly.",this.Class)},getFileName:function(){var b=document.location.href,b=b.substring(0,-1===b.indexOf("#")?b.length:b.indexOf("#")),b=b.substring(0,-1===b.indexOf("?")?b.length:b.indexOf("?"));return b=b.substring(b.lastIndexOf("/")+
1,b.length)},_onFullscreenChange:function(){var b=GEI("waCANVAS");document.mozFullScreen||document.webkitIsFullScreen?(b.style.width=window.screen.width+"px",b.style.height=window.screen.height+"px"):(b.style.width=h5c3.config.screen.width+"px",b.style.height=h5c3.config.screen.height+"px")},_BrowserIsChrome:function(){var b=/chrome/.test(window.navigator.userAgent.toLowerCase()),c=GEI("playnow"),f=GEI("cantplay");if(null!=c&&null!=f){if(b)return c.style.display="block",f.style.display="none",!0;
c.style.display="none";f.style.display="block";return!1}},setDisableCache:function(){this.$noCacheString=h5c3.config.devMode?"?nocache="+Date.now():""},setBaseUrl:function(b){this.$baseUrl=b},_makeUrl:function(b){return this.$baseUrl+b+this.$noCacheString},add:function(b){_DBG_("Added "+b+" to download que.",this.Class);this.$scripts.push(this._makeUrl(b))},_start:function(){_DBG_("Loading source files...",this.Class);this.$current=0;this._loadNextScript()},loadScript:function(b,c,f){if(!VLD(b)||
""===b)return!1;b=this._makeUrl(b);var g=DOC().createElement("script");g.type="application/javascript";g.src=b;g.async=!1;g.onloaded=c;g.onerror=f;GET("head")[0].appendChild(g)},_loadNextScript:function(){var b=this.$scripts[this.$current],c=window.document.createElement("script");c.type="application/javascript";c.src=b;c.async=!1;VLD(b)&&(c.onload=function(){h5c3.bootstrap._checkAllDone()},c.onerror=function(){_DBG_("h5c3.Bootstrap::_loadNextScript() - Could not load javascript file: "+c.src)},window.document.getElementsByTagName("head")[0].appendChild(c))},
finalize:function(){this.createCanvas()?(h5c3.device=new h5c3.Device,_DBG_("CloudApp Mode Requested...",this.Class),h5c3.device.boot()):_DBG_("ERROR: Something went wrong with preparing the canvas. Do you have a DIV with the ID of waCANVAS in your document?",this.Class)},_onReady:function(){this.prepareRWD();if(h5c3.r2wl.onReady)h5c3.r2wl.onReady();$("#OVERLAY").fadeOut(750,"linear",function(){$("#WRAPPER").fadeIn(1500,"ease-in")});"undefined"!=typeof window.H5C3READY&&window.H5C3READY(h5c3.VERSION,
window.Modernizr._version,$().jquery)},_checkAllDone:function(){this.$finished||(this.$scripts.length-1===this.$current?(VLD(window.Modernizr)&&_DBG_("Modernizr v"+window.Modernizr._version+" detected.",this.Class),VLD(window.jQuery)&&_DBG_("jQuery v"+$().jquery+" detected.",this.Class),this._onReady(),this.$finished=!0,VLD(h5c3.config.rwdOnly)&&!1===h5c3.config.rwdOnly&&this.finalize(),_DBG_("H5C3 Framework successfully loaded.",this.Class)):(this.$current++,this._loadNextScript()))},que:function(b,
c){_DBG_("que("+c+")",this.Class);var f=0;this.setBaseUrl(c);for(f=0;f<b.length;f++)this.add(b[f])},loadPlugins:function(b,c){_DBG_("loadPlugins("+c+")",this.Class);var f=0;this.setBaseUrl(c);for(f=0;f<b.length;f++)this.add(b[f]+".js")}});
window.h5c3.R2WLCommon=h5c3.Base.extend("h5c3.R2WLCommon",{_CLASSNAME:"R2WLCommon",_CLASSVERSION:"0.1.0"},{app:null,init:function(){this._super();_DBG_("Rich & Responsive Web Layer (R2WL) Initialized.",this.Class)},start:function(){var b=h5c3.r2wl.parseHeader(DOC().all[0].dataset);if(!b)return _DBG_("Invalid Application header.",this),!1;this.brand=new h5c3.Brand;this.google=new h5c3.Google("UA-35732532-1");this.app=new h5c3.CloudApp(b);this.brand.start();this.google.start();this.app.start()},parseHeader:function(b){me=
function(b){return b.role+" : "+b.name+" v"+b.version+"("+b.uuid+")"};if("DOMStringMap"===ISA(b)){if(VLD(b.role)&&VLD(b.name)&&VLD(b.version)&&VLD(b.uuid)){$good=this.validUUID(b.uuid);if(!$good)return _DBG_(me(b)+" Invalid or Not a Genuine UUID.",this),!1;"application"===b.role.toLowerCase()&&(CHK(b.layout,"absolute-all"),CHK(b.typo,"default"),CHK(b.skin,"default"),CHK(b.applet,"default"));_DBG_(me(b)+" Validated.",this);return b}return!1}},makeHeader:function(b,c,f,g){VLD(b)||(b="applet");VLD(c)||
(c="Noname");VLD(f)||(f="0.0.1");VLD(g)&&$$header.validUUID(g)||(g=$header.generateUUID());b="<div "+('\tdata-role="'+b+'" ')+('\tdata-name="'+c+'" ');b+='\tdata-version="'+f+'" ';b+='\tdata-uuid="'+g+'" ';b+='\tdata-author="" ';b+='\tdata-copyright="" ';b+='\tdata-scale="1" ';return b+="/>\n"},compile:function(b){return h5c3.lzw.encode(encodeURIComponent(b))},decompile:function(b){return h5c3.lzw.decode(encodeURIComponent(b))},validUUID:function(b){if(VLD(b)&&""!==b&&4==b.split("-").length-1){if("1"==
b.charAt(4)&&"9"==b.charAt(17)&&"6"==b.charAt(22)&&"9"==b.charAt(30))return!0;if("file:"===location.protocol&&h5c3.config.devMode)return _DBG_("Validation Failed, Bad UUID!",this),!1}},generateUUID:function(){return"xxxx1xxx-xxxx-4xx9-yxx6-xxxxxx9xxxxx".replace(/[xy]/g,function(b){var c=16*Math.random()|0;return("x"==b?c:c&3|8).toString(16)})},onReady:function(){}});
h5c3.Brand=h5c3.Base.extend("h5c3.Brand",{_CLASSNAME:"Brand",_CLASSVERSION:"0.0.2"},{init:function(){this._super()},update:function(){$("#h5c3built").text(h5c3.BUILT);$("#h5c3version").text(h5c3.DISTRO+"-"+h5c3.VERSION);!0===h5c3.devMode?$("#h5c3version").css("color","#FF0000"):$("#h5c3version").css("color","#ddffdd")},populate:function(){var b;b='<style id="h5c3-logo">#h5c3_logo {font-size:1em;display: block;}#hlmc {position: relative;display:block;top:0px;left:0px;width:100%;height:100%;font-family: Neuropol, sans-serif;text-transform: uppercase;text-align: center;}#h5c3_logo .c_H { display:inline; font-size: 100%; color: #e98900; }#h5c3_logo .c_5 { display:inline; font-size: 50%; color: #e98900; }#h5c3_logo .c_C { display:inline; font-size: 100%; color: #000beb; }#h5c3_logo .c_3\t{ display:inline; font-size: 50%; color: #000beb; }#h5c3_logo .w_FW { display:block; font-size: 42%; color: #444444;}</style>\n';
b+="#i2tm_logo{font-size:3em;display:block;}#i2tm_logo .w_il{display:inline;font-size:100%;color:#00cc00;}";b+="#ilmc {position:relative;display:block;top:0px;left:0px;width:100%;height:100%;font-family:Neuropol,sans-serif;text-transform:uppercase;text-align:center;padding-top:6.25%;}</style>\n";h5c3.r2wl.app.stylesheet.add("brand-logos",b,"R2WL")},logoI2TM:function(b){b=CHK(b,4);return'<div id="i2tm_logo" data-role="applet" style="font-size:'+b+'em"><div id="ilmc"><div class="w_il backlight">i2tm Labs</div></div></div>\n'},
logoH5C3:function(b){b=CHK(b,4);return'<div id="h5c3_logo" class="animateIn" data-role="applet" style="font-size:'+b+'em"><div id="hlmc"><div class="c_H emboss backlight">H</div><div class="c_5 emboss backlight">5</div><div class="c_C emboss backlight">C</div><div class="c_3 emboss backlight">3</div><div class="w_FW emboss backlight">framework</div></div></div>\n'},youAreRunning:function(){var b;b='<h3 style="margin:0">You are running</h3>'+this.logoI2TM(4);b+=this.logoH5C3(5);b+='<p id="h5c3version" class="center">version</p>';
return b+='<p id="h5c3built" class="center">built on</p>'},poweredBy:function(b){b=CHK(b,0.5);return'<div style="font-size:'+b+"em;color:"+(h5c3.devMode?"red":"green")+';width:23%;letter-spacing:0.20em;position: relative;margin:0 auto">Powered By '+h5c3.tag()+"</div>"},start:function(){this.populate();this.update()}});
h5c3.Google=h5c3.Base.extend("h5c3.Google",{_CLASSNAME:"Google",_CLASSVERSION:"0.1.2"},{UID:"",enabled:!1,loaded:!1,version:"",domain:null,gaJsHost:null,init:function(b){this.gaJsHost="https:"==document.location.protocol?"https://ssl.":"http://www.";this.UID=b;"file:"!==document.location.protocol?this.load(this.gaJsHost+"google-analytics.com/ga.js"):_DBG_("Google Integration is ready, But your running in developer mode.",this.Class)},load:function(b){if(!0==this.enabled){_DBG_("Requesting Google API.",
this.Class);var c=DOC().createElement("script");c.type="application/javascript";c.src=b;c.async=!0;c.onloaded=h5c3.bind(this,this._onLoaded);c.onerror=h5c3.bind(this,this._onError);GET("head")[0].appendChild(c);window.setTimeout(function(){_DBG_([{msg:"Google API, no loaded event after 5 seconds."}],this.Class);h5c3.google._onError()},5E3)}},push:function(){!0===this.enabled?(_DBG_("Google Push.",this.Class),(adsbygoogle=window.adsbygoogle||[]).push({})):ads=$(".adsbygoogle").css("background","#333")},
track:function(){if(!0==this.enabled){_DBG_("Google Track.",this.Class);try{window._gaq.push(["_setAccount",this.UID]),window._gaq.push(["_setDomainName",document.location.host]),window._gaq.push(["_addIgnoredOrganic",document.location.host]),window._gaq.push(["_trackPageview"])}catch(b){_DBG_(printStrackTrace({e:e},this.Class))}}},getVersion:function(){try{var b=_gat._getTrackerByName();return VLD(this.version=b._getVersion())}catch(c){return _DBG_(printStrackTrace({e:e},this.Class)),!1}},lookForGoogle:function(){_DBG_("Determining issue with Google...",
this.Class);var b=document.getElementsByTagName("script"),c;for(c in b)"undefined"!==typeof b[c].src&&b[c].src.split("?")[0].match(/ga\.js$/)&&(_DBG_("The Google API IS Loaded.",this.Class),this.loaded=!0,this.getVersion()&&(_DBG_("Google API v"+this.version+" is active.",this.Class),this.enabled=!0))},_onLoaded:function(){_DBG_("Google code received.",this.Class);this.google.loaded=!0;this.onReady()},_onError:function(){_DBG_([{msg:"Google code failed to load."}],this.Class);h5c3.google.loaded=!1;
h5c3.google.enabled=!1;this.lookForGoogle();h5c3.google.onReady()},start:function(){""===this.UID?_DBG_("You did not set your Google Unique ID in the config file.",this.Class):_DBG_("Using your Google Unique ID "+this.UID,this.Class);this.enabled?_DBG_("Google communication is enabled.",this.Class):_DBG_("Google communication is NOT enabled.",this.Class)}});
h5c3.StyleSheet=h5c3.Base.extend("h5c3.StyleSheet",{_CLASSNAME:"Google",_CLASSVERSION:"0.1.0",_EMPCT:85,_FONTSIZE:16,_MODES:[{w:2560,f:19},{w:1920,f:18},{w:1600,f:17},{w:1440,f:16},{w:1366,f:15},{w:1280,f:14},{w:1024,f:13},{w:768,f:12},{w:480,f:11},{w:320,f:10}]},{r2wl:null,useMQ:!0,appLayout:"",mode:2,mobile:null,reloadRedraw:!1,resizeTimer:0,init:function(b,c){this._super();this.r2wl=c;this.createMediaQueries();this.checkScreenMode();this.initEvents();this.mobile=DOC().createElement("div")},start:function(){this.reviewResolution()},
add:function(b,c,f){""===c||(40>c.length||!VLD(b)||!VLD(f))||GEI(b)||(c=$(c),$(c).data("role",f),f=DOC().createElement("style"),f.id=b,f.type="text/css",f.innerHTML=$(c).text(),document.getElementsByTagName("head")[0].appendChild(f),_DBG_("Added Stylesheet "+b,this.Class))},remove:function(b){VLD(b)},reviewResolution:function(){if(d=DOC().documentElement.dataset){if(h5c3.r2wl.app.layout.isValid(d.layout))return _DBG_("Valid Layout ["+d.layout+"] detected.",this.Class),this.appLayout=d.layout,"absolute-all"===
this.appLayout?this.setResolution(window.innerWidth-400):this.setResolution();_DBG_("Not a valid layout. ["+d.layout+"]",this.Class)}},initEvents:function(){$(window).resize(function(){clearTimeout(h5c3.r2wl.app.stylesheet.resizeTimer);h5c3.r2wl.app.stylesheet.resizeTimer=setTimeout(h5c3.r2wl.app.stylesheet._onResizeComplete,200)})},_onScreenSizeChanged:function(){_DBG_("Window Size has changed.",this.Class);"absolute"===this.layout&&(2>this.mode?($("#RIGHTBAR").css({display:"none",width:"0"}),$("#CONTENT").css({right:"0"})):
($("#RIGHTBAR").css({display:"block",width:"12.5em"}),$("#CONTENT").css({right:"12.5em"})),1>this.mode?($("#LEFTBAR").css({display:"none",width:"0"}),$("#CONTENT").css({left:"0"})):($("#LEFTBAR").css({display:"block",width:"15em"}),$("#CONTENT").css({left:"15em"})))},_onResizeComplete:function(){_DBG_("Window resize detected.");h5c3.r2wl.app.stylesheet.checkScreenMode();!0===this.reloadRedraw?h5c3.r2wl.app.stylesheet.forceRedraw():h5c3.r2wl.app.layout.reCalc()},forceRedraw:function(){GEI("WRAPPER").style.display=
"none";location.reload()},checkScreenMode:function(){var b=this.mode;721>window.innerWidth&&0!=b?this.mode=0:720<window.innerWidth&&961>window.innerWidth&&1!=b?this.mode=1:960<window.innerWidth&&1921>window.innerWidth&&2!=b?this.mode=2:1920<window.innerWidth&&3!=b&&(this.mode=3);this.mode!=b&&this._onScreenSizeChanged()},getFontSize:function(){var b=GEI("WRAPPER");return VLD(b)?(b=window.getComputedStyle(b,null).getPropertyValue("font-size"),fontSize=parseFloat(b)):14},calcRWDValues:function(b){var c=
{scrn:b,gutter:1};c.em=this.getFontSize();this.mobile?c.full=c.outer=c.cellwidth=c.sixth=c.fourth=c.third=c.half=c.width=Math.floor(b/c.em):(c.width=Math.floor(b/c.em),c.full=c.outer=(0.9*b/c.em).toFixed(2),c.cellwidth=Math.floor(0.1*(c.outer-c.gutter)),c.sixth=(c.outer/6).toFixed(2),c.fourth=(c.outer/4).toFixed(2),c.third=(c.outer/3).toFixed(2),c.half=(c.outer/2).toFixed(2));c.cellheight=Math.floor(0.1*(window.innerHeight/c.em-c.gutter));c.maxHeight=(window.innerHeight/c.em).toFixed(2);return c},
onReady:function(){_DBG_("Stylesheet Ready.",this.Class)},createMediaQueries:function(){var b=14,c=((window.screen.availWidth-320)/10).toFixed(2),f='<style data-role="Application">\n';for(i=window.screen.availWidth;319<i;i-=c)f+="@media all and (max-width:"+i+"px) {body,#WRAPPER {font-size:"+b+"px;}}\n",b=(b-0.4).toFixed(2);f+="</style>\n";_DBG_("Dynamic Media Queries for ["+window.screen.availWidth+"x"+window.screen.availHeight+"] created.",this.Class);this.add("Media-Queries",f,"R2WL")},zoom:function(b,
c){for(i=0;9>i&&(b=b.parentElement,-1===b.className.indexOf("r2wl_window "));i++);var f=b.dataset.zoom;VLD(f)||(f=1);c&&7>f?(f++,1<f&&(f=7)):1<f&&(f--,1>f&&(f=1));b.dataset.zoom=f},setResolution:function(b){VLD(b)||(b=window.innerWidth);this.calcRWDValues(b);var c;c="<style data-role=\"Application\">[class*='pct'] {float:left;min-height:3em;min-width:4em}\n#waDIV {width:48em; height:27em;position:relative;}\n";c+="#waCanvas {width:100%;height:100%;}\n";c+=".h5c3_applet {width:0px;height:0px;display:none;}\n";
c+="#HEADER.normal,.HEADER,#LEFTBAR.normal,.LEFTBAR,#RIGHTBAR.normal,.RIGHTBAR,#FOOTER.normal,.FOOTER { background: rgba(255, 255, 255, 0.85); color: rgba(60, 100, 190, 0.85); }\n";c+="#HEADER.light,.HEADER,#LEFTBAR.light,.LEFTBAR,#RIGHTBAR.light,.RIGHTBAR,#FOOTER.light,.FOOTER { background: rgba(255, 255, 255, 0.85); color: rgba(60, 100, 190, 0.85); }\n";c+="#HEADER.dark,.HEADER,#LEFTBAR.dark,.LEFTBAR,#RIGHTBAR.dark,.RIGHTBAR,#FOOTER.dark,.FOOTER { background: rgba(255, 255, 255, 0.85); color: rgba(60, 100, 190, 0.85); }\n";
c+="</style>\n";_DBG_("Dynamic Stylesheet created for "+b,this.Class);this.add("common",c,"R2WL")}});
h5c3.Layout=h5c3.Base.extend("h5c3.Layout",{_CLASSNAME:"Layout",_CLASSVERSION:"0.1.0",_layouts:["standard","landing","absolute"]},{r2wl:null,layout:null,header:!1,leftbar:!1,rightbar:!1,footer:!1,dim:{t:5,b:2.5,l:15,r:12.5},init:function(b,c){this._super();this.r2wl=c;this.isValid(b)?(this.layout=b,_DBG_("Valid layout ["+b+"] detected.",this)):_DBG_("Unknown layout ["+b+"] Did you forget to load the plugin that implements is?",this)},start:function(){this.isValid(this.layout)?this.setLayout(this.layout):
this.setLayout("standard")},isValid:function(b){if(!VLD(b))return!1;b.toLowerCase();b=b.split("-");return-1<this.Class._layouts.indexOf(b[0])},setLayout:function(b){this.layout=b;b=b.split("-");for(i=0;i<b.length;i++)if("all"===b[i]){this.footer=this.rightbar=this.leftbar=this.header=!0;break}else"header"===b[i]?this.header=!0:"left"===b[i]?this.leftbar=!0:"right"===b[i]?this.rightbar=!0:"footer"===b[i]&&(this.footer=!0);this.absolute()},reCalc:function(){},absolute:function(){DOC().body.id="DESKTOP";
if(11>document.body.innerHTML.length){var b,c,f=this.dim.t,g=this.dim.b,h=this.dim.l,k=this.dim.r;b="<style>#WRAPPER {position:absolute;min-height: 100%;min-width: 100%;height: 100% !important;height: 100% !important;overflow:hidden;}\n";c='<div id="WRAPPER" data-type="application" data-layout="absolute">\n';VLD(this.r2wl.app.header.applet)?$applet='<div data-applet="'+this.r2wl.app.header.applet+'">':($applet='<div data-applet="none">',$applet+=this.r2wl.brand.logoI2TM(4),$applet+=this.r2wl.brand.logoH5C3(12),
$applet+=this.r2wl.brand.poweredBy(1),$applet+='<p style="text-align:center"><br />Negative ghostrider!...You have not assigned a default applet.<br />Documentation can be found <a href="http://devzone.i2tmlabs.com/">HERE</a>.<p>',$applet+="</div>");this.layout.header?(b+="#HEADER {position: fixed;z-index: 9999;width: 100% !important;top: 0;height:"+f+"em !important;}\n",c+='<div id="HEADER" ></div>\n'):f=0;c+='<div id="CONTENT">\n';this.layout.leftbar?(b+="#LEFTBAR {position:fixed;z-index: 9999;top:"+
f+"em;bottom:"+g+"em;left:0px;width:"+h+"em;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;-o-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}\n",c+='<div id="LEFTBAR"></div>\t\n'):(h=0,b+="#LEFTBAR {position:fixed;z-index: 9999;top:"+f+"em;bottom:"+g+"em;left:0px;width:"+h+"em;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;-o-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}\n");c+='<div id="VIEWPORT">'+$applet+"</div>\n";this.layout.rightbar?
(b+="#RIGHTBAR {position:fixed;z-index: 9999;top:"+f+"em;bottom:"+g+"em;right:0px;width:"+k+"em;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;-o-box-sizing:border-box;-ms-box-sizing:border-box;box-sizing:border-box;}\n",c+='<div id="RIGHTBAR"></div>\n'):k=0;c+="</div>\x3c!-- CONTENT --\x3e\n";this.layout.footer?(b+="#FOOTER {position: fixed;z-index:9999;width:100%;height:"+g+"em !important;bottom:0;}\n",c+='<div id="FOOTER"></div>\n'):g=0;c+="</div>\n";b=b+("#CONTENT {position: absolute;right:"+
k+"em;left:"+h+"em;top:"+f+"em;bottom:"+g+"em;padding:0em;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;-o-box-sizing: border-box;-ms-box-sizing: border-box;box-sizing: border-box;overflow: hidden;}\n")+"#VIEWPORT {width: 100%;height: 100%;overflow: auto;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;-o-box-sizing: border-box;-ms-box-sizing: border-box;box-sizing: border-box;}</style>\n";this.r2wl.app.stylesheet.add(this.layout,b,"R2WL");document.body.innerHTML=c}else _DBG_("Hand coded "+
this.layout+" layout detected, Skipping Dynamic creation.",this)}});h5c3.SmartMenu=h5c3.Base.extend("h5c3.SmartMenu",{_CLASSNAME:"SmartMenu",_CLASSVERSION:"0.0.1"},{$_menu:null,init:function(){this._super();"object"===typeof h5c3.config.smartmenu&&(this.$_menu=h5c3.config.smartmenu)}});
h5c3.Applet=h5c3.Pooled.extend("h5c3.Applet",{_CLASSNAME:"Applet",_CLASSVERSION:"0.1.0",params:{required:["role","name","version","uuid"],optional:["author","copyright","scale"]},hasChildren:!1,children:[],create:function(b){var c=this._super();if("Object:Simple"===ISA(b)&&null!==b.header.name)for(var f in b)c[f]=b[f];return c.parse(b)?c:c.name}},{style:"",script:"",html:"",src:null,header:{name:null,version:"",uuid:"",role:"",author:"",copyright:""},created:0,accessed:0,ready:!1,loaded:!1,active:!1,
init:function(){this._super()},scanForApplets:function(b){var c=!1;CHK(b,"");"self"===b?(b=this.$html,c=!0):b=VLD(b)?$(b):$("body");if(!VLD(b))return 0;_DBG_("Scanning "+b[0].nodeName+" for applets...",this.Class);b=$(b).find("div").filter(function(b){return void 0!==$(this).data("applet")});c&&0<b.length&&(this.hasChildren=!0);return b},embed:function(b,c){$("div[data-applet='"+this.header.name+"']").append(b);this.active=!0;this.setDraggable()},unbed:function(){this.active&&(this.active=!1)},setDraggable:function(){$(function(){$("#VIEWPORT").on("mousedown",
"div",function(){!0===this.draggable?($(this).addClass("draggable"),$(this).addClass("dragging").parents().on("mousemove",function(b){$(".dragging").offset({top:b.pageY-$(".dragging").outerHeight()/2,left:b.pageX-$(".dragging").outerWidth()/2}).on("mouseup",function(){$(this).removeClass("dragging")});"undefined"!=typeof b&&b.preventDefault()})):($(".draggable").removeClass("draggable"),$(this).removeClass("dragging"))}).on("mouseup",function(){$(".draggable").removeClass("draggable")})})},parse:function(b){var c=
null;if("Object:Simple"!==ISA(b)||null===b.header.name){c=$(b);this.header=h5c3.r2wl.parseHeader(c[0].dataset);if(!this.header)return!1;b=$(b).not("comment").not("text")}for(i=0;i<b.length;i++)"applet"===b[i].dataset.role&&"content"===b[i].dataset.type?this.html=b[i].outerHTML:"applet"===b[i].dataset.role&&"style"===b[i].dataset.type?this.style=b[i].outerHTML:"applet"===b[i].dataset.role&&"script"===b[i].dataset.type&&(this.script=b[i].outerHTML);this.style&&h5c3.r2wl.app.stylesheet.add(this.header.name,
this.style,"Applet");this.script&&h5c3.r2wl.app.stylesheet.add(this.header.name,this.script,"Applet");this.html&&this.embed(this.html);return!0},makeHeader:function(b,c,f,g){VLD(b)||(b="applet");VLD(c)||(c="Noname");VLD(f)||(f="0.0.1");VLD(g)&&h5c3.r2wl.validUUID(g)||(g=h5c3.r2wl.generateUUID());b="<div "+('\tdata-role="'+b+'" ')+('\tdata-name="'+c+'" ');b+='\tdata-version="'+f+'" ';b+='\tdata-uuid="'+g+'" ';b+='\tdata-author="" ';b+='\tdata-copyright="" ';b+='\tdata-scale="1" ';return b+="/>\n"},
parseStyle:function(b){return $(b).filter("style").each(function(b){h5c3.r2wl.app.stylesheet.add(this.header.name,this.outerHTML,"Applet");return this.outerHTML.toString()})},parseScript:function(b){return $(b).filter("script").each(function(b){h5c3.r2wl.app.stylesheet.add(this.header.name,this.outerHTML,"Applet");return this.outerHTML.toString()})},verify:function(b,c){var f,g="Validating->";f=0;VLD(b.dataset.role)||(g+="Missing data-role->",c?(b.dataset.role="applet",g+="Fixed->"):f++);VLD(b.dataset.name)?
""===b.dataset.name&&(g+="data-name is empty->",c?(b.dataset.name="GIVE_ME_A_NAME",g+="Fixed->"):f++):(g+="Missing data-name->",c?(b.dataset.name="GIVE_ME_A_NAME",g+="Fixed->"):f++);VLD(b.dataset.version)?""===b.dataset.version&&(g+="data-version is empty->",c?(b.dataset.name="0.0.1",g+="Fixed->"):f++):(g+="Missing data-version->",c?(b.dataset.version="0.0.1",g+="Fixed->"):f++);h5c3.r2wl.validUUID(b.dataset.uuid)||(g+="Missing data-uuid->",c?g=(b.dataset.uuid=h5c3.r2wl.generateUUID())?g+"Created UUID->":
g+"Aborted: Unable to generateUUID.":f++);g=(0===f&&!0!=c?g+"PERFECT!->":g+("Failed ("+f+") issues->"))+"Done.";return{result:f,message:g,applet:b}}});
h5c3.AppletFactory=h5c3.Factory.extend("h5c3.AppletFactory",{_CLASSNAME:"AppletFactory",_CLASSVERSION:"0.3.1",getAppletPath:function(b){return b&&""!=h5c3.config.options.path?h5c3.config.options.path+"applets/":h5c3.path.home+h5c3.path.applets}},{_scanned:[],_history:[],_loadQue:[],started:!1,r2wl:null,style:null,layout:null,_tracker:{failed:0,loading:0,loaded:0,fromConn:0,fromCache:0,loops:0,indexed:!1},throttle:null,init:function(b){this._super("Applet");this.r2wl=b},create:function(b){return this.requestApplet(b)},
add:function(b,c){this._super(b,c)},reset:function(){this._loadQue=[];this._tracker={failed:0,loading:0,loaded:0,fromConn:0,fromCache:0,loops:0}},stop:function(){this.started=!1},start:function(){this.started||(this.reset(),this.started=!0)},onHREFClick:function(b){try{h5c3.r2wl.app.applets.setpage(this.name)}catch(c){AST(null,printStackTrace({e:c}))}},setpage:function(b){try{var c=h5c3.r2wl.app.applets.use({name:b});if(c){var f=c.scanForApplets("self");for(i=0;i<f.length;i++){var g=$(f[i]).attr("data-applet");
h5c3.r2wl.app.applets.use({name:g});$("div[data-applet='"+this.header.name+"']").append($html)}"0"!=$("#VIEWPORT").css("opacity")&&(this.lastContent=GEI("VIEWPORT").innerHTML,$("#VIEWPORT").fadeOut(250,function(){GEI("VIEWPORT").innerHTML=c.html;$("#VIEWPORT").fadeIn(250,"linear")}),h5c3.local.setAppCfg("currentPage",c.name))}}catch(h){AST(null,printStackTrace({e:h}))}},scanAnchors:function(b){var c="Scanning ",f=0,g=0,h=0;b=VLD(b)?$(b):$("body");if(""!=b[0].id){if(b=b[0].id,-1!=this._scanned.indexOf(b))return!0}else b=
b[0].nodeName;c+=b+" for Links...";b=GET("a");for(i=0;i<b.length;i++)if(""!=b[i].hash){var k=b[i].hash.split(".");"#applet"==k[0]&&""!=k[1]&&(b[i].addEventListener("click",this.onHREFClick,!1),-1===this._scanned.indexOf(k[1])?(this._loadQue.push(k[1]),this._scanned.push(k[1]),h++):g++,b[i].name=k[1],f++)}_DBG_(c+"Found "+f+" linked applets. [Cached:"+g+", Qued:"+h+", Total:"+f+"]",this.Class);return f},scanHTML:function(b){var c;c=VLD(b)?!1:!0;b=h5c3.Applet.prototype.scanForApplets(b);for(i=0;i<b.length;i++)b[i].style.display=
!0===c?"block":"none",this._loadQue.push(b[i].dataset.applet);this._tracker.loading=this._loadQue.length;_DBG_("A total of "+this._tracker.loading+" applets were found.",this.Class)},checkQue:function(){_DBG_("Checking Que...",this.Class);if(0>=this._loadQue.length){var b=h5c3.local.getAppCfg("currentPage");VLD(b)&&this.setpage(b);return!0}2<this._loadQue.length&&(this._loadQue=this._loadQue.filter(function(b,f){return h5c3.r2wl.app.applets._loadQue.indexOf(b)==f}));this._tracker.loading=this._loadQue.length;
b=this._loadQue.shift();this.requestApplet({name:b})},requestApplet:function(b){if(!VLD(b))return!1;var c="Received request for: "+b.name+"... ",f=!1,g=h5c3.local.getAppFile(b.name);VLD(g)&&(c+="Found in local Storage.",this.onLoad(g),f=!0);g=this._history[b.name];if("undefined"!=typeof g){this._tracker.fromCache++;_DBG_(c+"Found in cache. ",this.Class);if(VLD(g.div))this.onLoad(g.div);this.checkQue();return!0}f||(c+="Not cached. ");this._history[b.name]={name:b.name,src:this.Class.getAppletPath(1)+
"applet."+b.name+".html",div:b.div};if(!f)try{c+="Requesting remote transfer. ",h5c3.XHR(this._history[b.name].src,h5c3.bind(this,this.onLoad),h5c3.bind(this,this.onError))}catch(h){AST(null,printStackTrace({e:h}))}_DBG_(c,this.Class)},_checkAllDone:function(){if(0>=this._loadQue.length)return _DBG_("Load Complete. Cache: "+this._tracker.fromCache+", Remote: "+this._tracker.fromConn+", Failed: "+this._tracker.failed+", Total: "+this._tracker.loaded,this.Class),this.stop(),!0;this.checkQue();this._tracker.loops++;
return this._tracker.loops>this._tracker.loading?!0:!1},onLoad:function(b){if(""===b)return!1;var c;ISA(b);if("Object:Simple"===ISA(b)){c=!0;var f=h5c3.Applet.create(b)}else c=!1,f=h5c3.Applet.create(b);this._tracker.loaded++;this._tracker.loading--;"object"===typeof f?(c?f.header.name in this._history&&"undefined"!==typeof this._history[f.header.name].src&&(f.src=this._history[f.header.name].src):h5c3.local.setAppFile(f.header.name,f),this._tracker.fromConn++,this.scanHTML(f.html),this.scanAnchors(f.html),
$result=h5c3.r2wl.app.applets.add(f.header.name,f)):(this._tracker.failed++,delete this._history[f],this.remove(f),_DBG_(["Unable to identify applet, discarding.",b]),$result=!1);this.started=!this._checkAllDone();return $result},onError:function(b){return null},onReady:function(){this.started||(this.scanHTML(),this.scanAnchors(),this.checkQue())}});
window.h5c3.CloudApp=h5c3.Base.extend("h5c3.CloudApp",{_CLASSNAME:"CloudApp",_CLASSVERSION:"0.0.0"},{header:null,skin:{fg:{light:"#cccccc",normal:"#808080",dark:"#303030"},bg:{light:"#aaaaaa",normal:"#404040",dark:"#000000"}},colorOverride:!1,init:function(b){this._super();this.header=b;this.prepare()},prepare:function(){this.skin=(this.colorOverride=CHK(h5c3.local.getGlobalCfg("colorOverride"),!1))?CHK(h5c3.local.getGlobalCfg("mySkin"),this.skin):CHK(h5c3.local.getAppCfg("skin"),this.skin);this.applets=
new h5c3.AppletFactory(h5c3.r2wl);this.stylesheet=new h5c3.StyleSheet(this.header.style,h5c3.r2wl);this.layout=new h5c3.Layout(this.header.layout,h5c3.r2wl)},save:function(){h5c3.local.setGlobalCfg("colorOverride",this.colorOverride);h5c3.local.setAppCfg("skin",this.skin)},start:function(){this.stylesheet.start();this.layout.start();if(this.applets.onReady)this.applets.onReady();window.APP=this},createWindow:function(b,c){ISA(b);"object"!==ISA(c)&&(c={id:"window",height:"17.14em",width:"22.85em",
title:"Unamed Window",statusbar:"",body:"",color:"clr-dark"});var f=DOC.createElement("div");f.id=c.id;f.className="r2wl_window "+c.color;$html='<div class="r2wl_window.r2wl_titleBar">\n';$html+='<div class="r2wl_title left"><span id="windowName">'+$title+"</span></div>\n";$html+='<div class="icons right">\n';$html+='<i class="icon icon-move uiButton"></i>\n';$html+='<i class="icon icon-collapse-alt uiButton"></i>\n';$html+='<i class="icon icon-expand-alt uiButton"></i>\n';$html+="</div>\n";$html+=
"</div>\n";$html+='<div id="windowBody" class="r2wl_body">'+$body+"</div>\n";$html+='<div class="r2wl_statusBar">\n';$html+='<div id="windowStatusBar">'+$status+"</div>\n";$html+="</div>\n";f.innerHTML=$html},zoomIn:function(b){return this.stylesheet.zoom(b,1)},zoomOut:function(b){return this.stylesheet.zoom(b,0)},onReady:function(){}});
h5c3.Image=h5c3.Base.extend("h5c3.Image",{_CLASSNAME:"Image",_CLASSVERSION:"0.1.0"},{width:0,height:0,image:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,scaleX:1,scaleY:1,alpha:1,compositeOperation:null,init:function(b,c,f,g){this._super();this.name=b;this.src=h5c3.loader.makeUrl(c);this.image=new Image;this.onLoadCallback=f;this.onErrorCallback=g;this.image.onload=this._onLoad.bind(this);this.image.onerror=this._onError.bind(this);this.alpha=this.scaleY=this.scaleX=
1;h5c3.loader.started&&this.load()},setAlpha:function(b){this.alpha=b},setScale:function(b,c){this.scaleX=b;this.scaleY=c},setCompositeOperation:function(b){this.compositeOperation=b},load:function(b,c){this.onLoadCallback=b;this.onErrorCallback=c;if(this.loaded&&b)this.onLoadCallback(this);this.image.onload=this._onLoad.bind(this);this.image.onerror=this._onError.bind(this);this.image.src=this.src},reload:function(){this.loaded=!1;this.load()},draw:function(b,c,f,g,h,k,l,m){null!=this.compositeOperation&&
(b.globalCompositeOperation=this.compositeOperation);3==arguments.length?(b.save(),1!=this.alpha&&(b.globalAlpha=this.alpha),b.translate(c+this.width/2,f+this.height/2),b.scale(this.scaleX,this.scaleY),b.drawImage(this.image,0,0,this.width,this.height,-this.width/2,-this.height/2,this.width,this.height)):VLD(m)?(b.save(),1!=this.alpha&&(b.globalAlpha=this.alpha),0>this.scaleX||0>this.scaleY?b.translate(g+k/2*(1==this.scaleX?0:this.scaleX),h+l/2*(1==this.scaleY?0:this.scaleY)):b.translate(g+k/2,h+
l/2),b.rotate(m*(Math.PI/180)),b.scale(this.scaleX,this.scaleY),b.drawImage(this.image,c,f,k,l,-k/2,-l/2,k,l)):(b.save(),1!=this.alpha&&(b.globalAlpha=this.alpha),0>this.scaleX||0>this.scaleY?b.translate(g+-(k/2)*(1==this.scaleX?0:this.scaleX),h+-(l/2)*(1==this.scaleY?0:this.scaleY)):b.translate(g,h),b.scale(this.scaleX,this.scaleY),b.drawImage(this.image,c,f,k,l,0,0,k,l));b.restore();null!=this.compositeOperation&&(b.globalCompositeOperation="source-over");h5c3.device.elementsDrawn++},_onLoad:function(){this.loaded=
!0;this.width=this.image.width;this.height=this.image.height;if(this.onLoadCallback)this.onLoadCallback(this)},_onError:function(){if(this.onErrorCallback)this.onErrorCallback(this)},expand:function(b,c){this.image.width=this.width+b;this.image.height=this.height+c;this.width=this.image.width;this.height=this.image.height},resize:function(b,c){var f=this.width*b,g=this.height*c,h=document.createElement("canvas");h.width=this.width;h.height=this.height;var k=document.createElement("canvas");k.width=
f;k.height=g;var l=k.getContext("2d"),m=l.getImageData(0,0,f,g),h=h.getContext("2d");h.drawImage(this.image,0,0,this.width,this.height,0,0,this.width,this.height);for(var h=h.getImageData(0,0,this.width,this.height),p=0;p<g;p++)for(var n=0;n<f;n++)for(var q=4*(Math.floor(p/c)*this.width+Math.floor(n/b)),x=4*(p*f+n),w=0;4>w;w++)m.data[x+w]=h.data[q+w];l.putImageData(m,0,0);this.image=k;return this}});
h5c3.CanvasImage=h5c3.Base.extend("h5c3.CanvasImage",{},{width:0,height:0,canvas:null,loaded:!0,scaleX:1,scaleY:1,init:function(b){this.canvas=b;this.width=b.width;this.height=b.height},draw:function(b,c,f,g,h,k,l){void 0==k||void 0==l||0==k||0==l?b.drawImage(this.canvas,c,f):b.drawImage(this.canvas,c,f,k,l,g*this.scaleX,h*this.scaleY,k*this.scaleX,l*this.scaleY)},setScale:function(b,c){this.scaleX=b;this.scaleY=c}});
h5c3.ImageTools=h5c3.Base.extend("h5c3.ImageTools",{rotate:function(b,c,f,g){var h=document.createElement("canvas");h.width=c*g;h.height=f;for(var k=h.getContext("2d"),l=0;l<g;l++)k.save(),k.translate(l*c+c/2,f/2),k.rotate(360/g*l*(Math.PI/180)),k.drawImage(b,-(c/2),-(f/2)),k.restore();return new h5c3.CanvasImage(h)}},{});
h5c3.Sound=h5c3.Base.extend("h5c3.Sound",{_CLASSNAME:"SoundFactory",_CLASSVERSION:"0.1.2"},{sounds:[],src:null,name:null,numLoaded:0,loaded:!1,errored:!1,channels:1,onLoadCallback:null,onErrorCallback:null,init:function(b,c,f,g,h,k){this._super();this.name=b;this.channels=g;b=!1;for(g=0;g<f.length;g++)if(h5c3.device.canPlay(f[g])){this.src=h5c3.loader.makeUrl(c+"."+f[g]);b=!0;break}b?h5c3.loader.started&&this.load(h,k):this.errored=!0;_DBG_("Initializaed.",this.Class)},pause:function(){if(this.canPlay()){for(var b=
0,c=this.sounds.length;b<c;b++)this.sounds[b].pause();_DBG_("Paused.",this.Class)}},stop:function(){this.canPlay()&&this.pause()},setVolume:function(b){if(this.canPlay()){for(var c=0,f=this.sounds.length;c<f;c++)this.sounds[c].volume=b;_DBG_("Volume set to "+b+" for all channels.",this.Class)}},setLoop:function(b){if(this.canPlay())for(var c=0,f=this.sounds.length;c<f;c++)this.sounds[c].loop=b},getDuration:function(){return this.canPlay()?this.sounds[0].duration:-1},setPlaybackRate:function(b){if(this.canPlay())for(var c=
0,f=this.sounds.length;c<f;c++)this.sounds[c].playbackRate=b},setPlayPosition:function(b){if(this.canPlay())for(var c=0,f=this.sounds.length;c<f;c++)this.sounds[c].currentTime=b},load:function(b,c){this.onLoadCallback=b;this.onErrorCallback=c;if(this.loaded&&b)this.onLoadCallback(this);else for(var f=0;f<this.channels;f++){var g=new Audio;g.preload="auto";g.addEventListener("canplaythrough",this.onLoad.bind(this),!1);g.addEventListener("error",this.onError.bind(this),!1);g.onerror=this.onError.bind(this);
g.onload=this.onLoad.bind(this);g.src=this.src;g.load();this.sounds.push(g);if(h5c3.device.isAppMobi)this.onLoad(null)}},reload:function(){this.errored=this.loaded=!1;this.load()},onLoad:function(b){this.numLoaded++;_DBG_("Loaded ("+this.numLoaded+")",this.Class);h5c3.device.isAppMobi||b.target.removeEventListener("canplaythrough",this.onLoad.bind(this),!1);if(this.numLoaded==this.channels&&(this.loaded=!0,this.errored=!1,this.onLoadCallback))this.onLoadCallback(this)},onError:function(){_DBG_("Error on load.",
this.Class);this.errored=!0;this.loaded=!1;if(this.onErrorCallback)this.onErrorCallback(this)},play:function(b){if(!this.canPlay())return null;for(var c=0,f=this.sounds.length;c<f;c++)if(this.sounds[c].paused||this.sounds[c].ended)return b&&(this.sounds[c].loop=!0),this.sounds[c].play(),this.sounds[c];this.warn(this.name+" - all channels are in use");return null},canPlay:function(){return this.loaded&&h5c3.device.soundEnabled&&!this.errored}});
h5c3.SoundFactory=h5c3.Factory.extend("h5c3.SoundFactory",{_CLASSNAME:"SoundFactory",_CLASSVERSION:"0.1.2"},{init:function(){this._super("Sound")},create:function(b,c){CHK(c,{volume:0.5,loop:!1});var f=h5c3.loader.get(b).resource;f.setVolume(c.volume);f.setLoop(c.loop);return this.add(b,f)},play:function(b,c){this.use(b,c).play(c.loop)}});
h5c3.DataResource=h5c3.Base.extend("h5c3.DataResource",{_CLASSNAME:"DataResource",_CLASSVERSION:"0.1.0"},{data:null,request:null,src:null,name:null,loaded:!1,onLoadCallback:null,onErrorCallback:null,init:function(b,c,f,g){this._super();this.src=h5c3.loader.makeUrl(c);this.name=b;this.onLoadCallback=f;this.onErrorCallback=g;this.request=new XMLHttpRequest;this.request.onreadystatechange=this.onReadyStateChange.bind(this);this.request.onload=this.onReadyStateChange.bind(this);this.request.onloadend=
this.onReadyStateChange.bind(this);this.load()},load:function(b,c){this.onLoadCallback=b;this.onErrorCallback=c;try{this.request.open("get",this.src),this.request.send(null)}catch(f){}finally{}},reload:function(){this.loaded=!1;this.load()},onReadyStateChange:function(){if(!this.loaded&&4===this.request.readyState)if(200===this.request.status){if(this.loaded=!0,this.data=this.request.responseText,this.onLoadCallback)this.onLoadCallback(this)}else if(404===this.request.status&&(this.warn("resource "+
this.src+" error "+this.request.status),this.onErrorCallback))this.onErrorCallback(this)}});
h5c3.Resources=h5c3.Base.extend("h5c3.Resources",{_CLASSNAME:"Resources",_CLASSVERSION:"0.3.3"},{resources:null,init:function(){this._super();this.loadResources()},loadResources:function(){_DBG_("Queing internal resources.",this.Class);this.loadGraphics();this.loadAudio()},loadGraphics:function(){if(VLD(h5c3.config.resources)){_DBG_("Queing images resources.",this.Class);var b,c=h5c3.config.resources.images;for(b=0;b<c.length;++b)h5c3.loader.add(new h5c3.Image(c[b].name,c[b].file))}else _DBG_("No graphic resources to que. (Did you forget to add them to the config?)",
this.Class)},loadAudio:function(){if(VLD(h5c3.config.resources)){_DBG_("Queing audio resources.",this.Class);var b,c,f,g=h5c3.config.resources.sounds;for(b=0;b<g.length;b++)c="true"===g[b].ogg?"ogg":"",f="true"===g[b].mp3?"mp3":"",h5c3.loader.add(new h5c3.Sound(g[b].name,g[b].file,[c,f],g[b].channels))}else _DBG_("No audio resources to que. (Did you forget to add them to the config?)",this.Class)}});h5c3.SCREEN_CELLS={GRIDX1:0,GRIDX2:1,GRIDX3:2,GRIDX4:4,GRIDX5:8};
h5c3.Device=h5c3.Base.extend("h5c3.Device",{_CLASSNAME:"Device",_CLASSVERSION:"0.1.0"},{device:h5c3.Device,media:h5c3.Media,page:null,loader:null,input:null,inputTimer:null,processTimer:null,xmlParser:null,resourcesLoaded:!1,started:!1,running:!0,fps:30,currentFPS:0,averageFPS:0,totalFPS:0,frameCount:0,tick:0,enablePooling:!0,soundEnabled:!0,elementsDrawn:0,lastProcessMS:0,lastDrawMS:0,elapsed:0,lastFrame:0,now:Date.now(),startTime:0,screen:null,pixelRatio:h5c3.Device.pixelRatio,isiPhone:h5c3.Device.isiPhone,
isiPhone4:h5c3.Device.isiPhone4,isiPad:h5c3.Device.isiPad,isAndroid:h5c3.Device.isAndroid,isTouch:h5c3.Device.isTouch,useTouch:h5c3.Device.useTouch,isiOS:h5c3.Device.isiOS,isiPod:h5c3.Device.isiPod,showDebug:h5c3.devMode,devMode:h5c3.devMode,gameScreenCells:1,init:function(){this._super();_DBG_("Initialization started.",this.Class);this.loader=h5c3.loader;this.input=new h5c3.Input},boot:function(){_DBG_("boot initiated.",this.Class);this.page=new h5c3.Page(this,"H5C3 Unanamed App");this.game=this.page.game;
this.tick=1E3/this.fps;this.requestAnimFrame=h5c3.Device.requestAnimFrame;this.onReady();_DBG_("boot complete.",this.Class)},initLayout:function(){this.layout={cells:h5c3.SCREEN_CELLS.GRIDX1}},canPlay:function(b){return h5c3.Device.canPlay(b)},onReady:function(){_DBG_("Dispatching Ready",this.Class);this.started||(this.page.onReady(),this.input._onReady(),this.lastFrame=Date.now(),window.requestAnimationFrame(this.render.bind(this)),this.handleTimers(!0),this.started=!0)},onExit:function(){this.handleTimers(!1);
window.cancelAnimationFrame(!0);_DBG_("Animation frame binding canceled.",this.Class)},handleTimers:function(b){!0===b?(_DBG_("Loader timer started.",this.Class),this.inputTimer=new h5c3.AccuTimer(0,6,function(b,f,g){h5c3.device.input.process()},function(){_DBG_("Loader Timer terminated.",this.Class)}),this.processTimer=new h5c3.AccuTimer(0,30,function(b,f,g){h5c3.device.running=!h5c3.device.page.game.obj.process()},function(){_DBG_("Process Timer terminated.",this.Class)})):(_DBG_("Stop all timers.",
this.Class),this.processTimer=this.inputTimer=null)},render:function(b){if(!1!==this.running)try{this.now=this.startTime=Date.now(),this.elapsed=this.now-this.lastFrame,this.elementsDrawn=this.lastDrawMS=0,this.currentFPS=1E3/this.elapsed,this.totalFPS+=this.currentFPS,this.frameCount++,this.lastProcessMS=Date.now()-this.startTime-this.lastDrawMS,this.lastFrame=this.now,this.page.render(),window.requestAnimationFrame(this.render.bind(this))}catch(c){AST(null,printStackTrace(c))}},isOnScreen:function(b,
c,f,g){return h5c3.Math.isRectColliding(b,c,f,g,0,0,this.game.dim.w,this.game.dim.h)}});
h5c3.Input=h5c3.Base.extend("h5c3.Input",{_CLASSNAME:"Input",_CLASSVERSION:"0.1.0",_eventPos:null,getEventPosition:function(b,c){null===this._eventPos&&(this._eventPos=h5c3.Point.create(0,0));var f=c;VLD(c)||(f=this._eventPos);b.pageX||b.pageY?(f.x=b.pageX,f.y=b.pageY):(f.x=b.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,f.y=b.clientY+document.body.scrollTop+document.documentElement.scrollTop);return f}},{stateBindings:null,states:null,actionBindings:null,mousePos:null,mouseLeftButtonDown:!1,
mouseRightButtonDown:!1,mouseMiddleButtonDown:!1,init:function(){this._super();this.stateBindings=new h5c3.Hashtable;this.states=new h5c3.Hashtable;this.actionBindings=new h5c3.Hashtable;this.mousePos=h5c3.Point.create(0,0)},bindState:function(b,c,f,g){if(null===b.uniqueId)throw"Oops, you can't bind a state to an object if it doesn't have a uniqueId function";f=f.toUpperCase();g={stateName:c,object:b,input:f,state:{on:!1,event:null},uiTarget:g};var h=this.stateBindings.get(f);null===h?this.stateBindings.put(f,
[g]):h.push(g);this.states.put(b.uniqueId+"\\\\"+c,{on:!1,event:null});h5c3.InputType.isPositional(h5c3.InputType.getCode(f))&&this._positionals.push(g)},clearStates:function(b){var c,f,g,h,k,l=this.stateBindings.entries();for(c=0;c<l.length;c++)for(k=l[c],f=0;f<k.length;f++)g=k[f],g.object===b&&(h=this.states.get(next.object.uniqueId+"\\\\"+next.stateName),h.on=!1,h.event=null,h5c3.InputType.isPositional(g.input)&&h5c3.tools.arrayRemove(this._positionals,g))},isInputState:function(b,c){var f=this.states.get(b.uniqueId+
"\\\\"+c);if(null===f)throw"Ooops, unknown state "+c;return f.on},getInputState:function(b,c){return this.states.get(b.uniqueId+"\\\\"+c)},bindAction:function(b,c,f,g){f=f.toUpperCase();var h=this.actionBindings.get(f);null===h?this.actionBindings.put(f,[{actionName:c,object:b,input:f,uiTarget:g}]):h.push({actionName:c,input:f,object:b,uiTarget:g})},fireAction:function(b,c){var f,g,h,k,l,m=this.actionBindings.get(h5c3.InputType.getName(b));if(null===m)return!1;for(f=0;f<m.length;f++)if(g=m[f],h=m[f].object,
!h.isActive||h.isActive())if(h5c3.InputType.isPositional(b)){if(k=this.Class.getEventPosition(c),(l=VLD(g.uiTarget)?g.uiTarget.getScreenRect():h.getScreenRect?h.getScreenRect():null)&&l.containsPoint(k))h.onAction(g.actionName,c,k,g.uiTarget)}else h.onAction(g.actionName);return!0},_onReady:function(){_DBG_("onReady Event.",this.Class);h5c3.device.game.obj.attachTouchEvents(this);window.addEventListener("keydown",this._keyDown.bind(this),!0);window.addEventListener("keyup",this._keyUp.bind(this),
!0)},_positionals:[],_checkPositional:function(b){var c,f,g;for(c=0;c<this._positionals.length;c++)(f=this._positionals[c],"mousemove"===b.type&&h5c3.InputType.isTouch(h5c3.InputType.getCode(f.input))||("touchmove"===b.type&&!h5c3.InputType.isTouch(h5c3.InputType.getCode(f.input))||h5c3.InputType.getCode(f.input)===h5c3.InputType.MOUSE_BUTTON_LEFT_UP||h5c3.InputType.getCode(f.input)===h5c3.InputType.MOUSE_BUTTON_LEFT_DOWN||h5c3.InputType.getCode(f.input)===h5c3.InputType.MOUSE_BUTTON_RIGHT_UP||h5c3.InputType.getCode(f.input)===
h5c3.InputType.MOUSE_BUTTON_RIGHT_DOWN||h5c3.InputType.getCode(f.input)===h5c3.InputType.MOUSE_BUTTON_MIDDLE_UP||h5c3.InputType.getCode(f.input)===h5c3.InputType.MOUSE_BUTTON_MIDDLE_DOWN||h5c3.InputType.getCode(f.input)===h5c3.InputType.MOUSE_CLICK)||!(g=VLD(f.uiTarget)?f.uiTarget.getScreenRect():f.object.getScreenRect?f.object.getScreenRect():null))||(g.containsPoint(this.Class.getEventPosition(b))?(f=this.states.get(f.object.uniqueId+"\\\\"+f.stateName),f.on=!0):(f=this.states.get(f.object.uniqueId+
"\\\\"+f.stateName),f.on=!1),f.event=b)},_changeState:function(b,c,f){var g,h,k,l,m;g=h5c3.InputType.getName(b);if(null===g)return this.warn("Unknown keycode = "+b),!1;h=this.stateBindings.get(g);if(null===h)return!1;for(g=0;g<h.length;g++)if(k=h[g],!k.object.isActive||k.object.isActive())h5c3.InputType.isPositional(b)?(l=this.Class.getEventPosition(f),(m=VLD(k.uiTarget)?k.uiTarget.getScreenRect():k.object.getScreenRect?k.object.getScreenRect():null)?m.containsPoint(l)&&(k=this.states.get(k.object.uniqueId+
"\\\\"+k.stateName),k.on=c,k.event=f):(k=this.states.get(k.object.uniqueId+"\\\\"+k.stateName),k.on=c,k.event=f)):(k=this.states.get(k.object.uniqueId+"\\\\"+k.stateName),k.on=c,k.event=f);return!0},_lastMouseMove:null,process:function(){this._lastMouseMove&&(this._checkPositional(this._lastMouseMove),this.fireAction(h5c3.InputType.MOUSE_MOVE,this._lastMouseMove),this.Class.getEventPosition(this._lastMouseMove,this.mousePos),this._lastMouseMove=null)},_keyDown:function(b){this._changeState(b.keyCode,
!0,b)&&b.preventDefault();this.fireAction(b.keyCode,b)&&b.preventDefault()},_keyUp:function(b){this._changeState(b.keyCode,!1,b)&&b.preventDefault()},_touchStart:function(b){var c;c=0;for(len=b.touches.length;c<len;c++)this._changeState(h5c3.InputType.TOUCH,!0,b.touches[c]),this.fireAction(h5c3.InputType.TOUCH,b.touches[c]);b.preventDefault()},_touchEnd:function(b){var c;c=0;for(len=b.changedTouches.length;c<len;c++)this._changeState(h5c3.InputType.TOUCH,!1,b.changedTouches[c]);b.preventDefault()},
_touchMove:function(b){var c;c=0;for(len=b.touches.length;c<len;c++)this._checkPositional(b.touches[c]);b.preventDefault()},_mouseButton:function(b,c){switch(b.button){case 0:this._changeState(h5c3.InputType.MOUSE_BUTTON_LEFT_DOWN,c,b);this._changeState(h5c3.InputType.MOUSE_BUTTON_LEFT_UP,!c,b);this.fireAction(h5c3.InputType.MOUSE_BUTTON_LEFT_DOWN,b);this.mouseLeftButtonDown=!0;break;case 1:this._changeState(h5c3.InputType.MOUSE_BUTTON_MIDDLE_DOWN,c,b);this._changeState(h5c3.InputType.MOUSE_BUTTON_MIDDLE_UP,
!c,b);this.fireAction(h5c3.InputType.MOUSE_BUTTON_MIDDLE_DOWN,b);this.mouseMiddleButtonDown=!0;break;case 2:this._changeState(h5c3.InputType.MOUSE_BUTTON_RIGHT_DOWN,c,b),this._changeState(h5c3.InputType.MOUSE_BUTTON_RIGHT_UP,!c,b),this.fireAction(h5c3.InputType.MOUSE_BUTTON_RIGHT_DOWN,b),this.mouseRightButtonDown=!0}this.fireAction(h5c3.InputType.MOUSE_CLICK,b);b.preventDefault()},_mouseUp:function(b){this._mouseButton(b,!1)},_mouseDown:function(b){this._mouseButton(b,!0)},_mouseMove:function(b){this._lastMouseMove=
b;b.preventDefault()},_contextMenu:function(b){this._changeState(h5c3.InputType.MOUSE_BUTTON_RIGHT_UP,!0,b);this.fireAction(h5c3.InputType.MOUSE_BUTTON_RIGHT_DOWN,b)},_mouseWheel:function(b){0<b.wheelDelta?this.fireAction(h5c3.InputType.MOUSE_WHEEL_UP,b):this.fireAction(h5c3.InputType.MOUSE_WHEEL_DOWN,b);b.preventDefault()}});
h5c3.InputType=h5c3.Base.extend("h5c3.InputType",{nameToCode:null,codeToName:null,POSITIONAL_EVENT_START:1E3,MOUSE_MOVE:1100,MOUSE_CLICK:1110,MOUSE_BUTTON_LEFT_UP:1200,MOUSE_BUTTON_LEFT_DOWN:1201,MOUSE_BUTTON_RIGHT_UP:1220,MOUSE_BUTTON_RIGHT_DOWN:1221,MOUSE_BUTTON_MIDDLE_UP:1230,MOUSE_BUTTON_MIDDLE_DOWN:1231,MOUSE_WHEEL_UP:1300,MOUSE_WHEEL_DOWN:1301,TOUCH:1E3,TOUCH_MOVE:1001,TOUCH_START:1002,TOUCH_END:1003,TOUCH_CANCEL:1004,TOUCH_LEAVE:1005,init:function(){var b,c;this.nameToCode=new h5c3.Hashtable;
this.codeToName=new h5c3.Hashtable;this.addInput(8,"BACKSPACE");this.addInput(9,"TAB");this.addInput(13,"ENTER");this.addInput(16,"SHIFT");this.addInput(17,"CTRL");this.addInput(18,"ALT");this.addInput(19,"PAUSE");this.addInput(20,"CAPS");this.addInput(27,"ESC");this.addInput(32,"SPACE");this.addInput(33,"PAGE_UP");this.addInput(34,"PAGE_DOWN");this.addInput(35,"END");this.addInput(36,"HOME");this.addInput(37,"LEFT");this.addInput(38,"UP");this.addInput(39,"RIGHT");this.addInput(40,"DOWN");this.addInput(45,
"INSERT");this.addInput(46,"DELETE");for(b=48;91>b;b++)c=String.fromCharCode(b),this.addInput(b,c);this.addInput(91,"WINDOW_LEFT");this.addInput(92,"WINDOW_RIGHT");this.addInput(93,"SELECT");this.addInput(96,"NUM_0");this.addInput(97,"NUM_1");this.addInput(98,"NUM_2");this.addInput(99,"NUM_3");this.addInput(100,"NUM_4");this.addInput(101,"NUM_5");this.addInput(102,"NUM_6");this.addInput(103,"NUM_7");this.addInput(104,"NUM_8");this.addInput(105,"NUM_9");this.addInput(106,"*");this.addInput(107,"+");
this.addInput(109,"-");this.addInput(110,".");this.addInput(111,"/");this.addInput(112,"F1");this.addInput(113,"F2");this.addInput(114,"F3");this.addInput(115,"F4");this.addInput(116,"F5");this.addInput(117,"F6");this.addInput(118,"F7");this.addInput(119,"F8");this.addInput(120,"F9");this.addInput(121,"F10");this.addInput(122,"F11");this.addInput(123,"F12");this.addInput(144,"NUM_LOCK");this.addInput(145,"SCROLL_LOCK");this.addInput(186,";");this.addInput(187,"=");this.addInput(188,",");this.addInput(189,
"-");this.addInput(190,".");this.addInput(191,"/");this.addInput(192,"`");this.addInput(219,"[");this.addInput(220,"\\");this.addInput(221,"]");this.addInput(222,"'");this.addInput(this.TOUCH,"TOUCH");this.addInput(this.MOUSE_BUTTON_LEFT_DOWN,"MOUSE_BUTTON_LEFT_DOWN");this.addInput(this.MOUSE_BUTTON_LEFT_UP,"MOUSE_BUTTON_LEFT_UP");this.addInput(this.MOUSE_BUTTON_RIGHT_DOWN,"MOUSE_BUTTON_RIGHT_DOWN");this.addInput(this.MOUSE_BUTTON_RIGHT_UP,"MOUSE_BUTTON_RIGHT_UP");this.addInput(this.MOUSE_BUTTON_MIDDLE_DOWN,
"MOUSE_BUTTON_MIDDLE_DOWN");this.addInput(this.MOUSE_BUTTON_MIDDLE_UP,"MOUSE_BUTTON_MIDDLE_UP");this.addInput(this.MOUSE_WHEEL_UP,"MOUSE_WHEEL_UP");this.addInput(this.MOUSE_WHEEL_DOWN,"MOUSE_WHEEL_DOWN");this.addInput(this.MOUSE_MOVE,"MOUSE_MOVE");this.addInput(this.MOUSE_CLICK,"MOUSE_CLICK")},isTouch:function(b){return b===this.TOUCH},isPositional:function(b){return b>=this.POSITIONAL_EVENT_START},addInput:function(b,c){this.codeToName.put(b,c);this.nameToCode.put(c,b)},getName:function(b){return this.codeToName.get(b)},
getCode:function(b){return this.nameToCode.get(b)}},{});
h5c3.Page=h5c3.Base.extend("h5c3.Page",{_CLASSNAME:"Page",_CLASSVERSION:"0.1.0"},{device:null,wrapper:{div:null,dim:{w:0,h:0}},banner:{name:null,obj:null,id:null,div:null,dim:{w:0,h:0}},game:{name:null,obj:null,id:null,canvas:null,ctx:null,dim:{w:0,h:0}},touchpad:{name:null,obj:null,id:null,canvas:null,ctx:null,dim:{w:0,h:0}},options:{desktopsuspend:!0,suspend:!0,network:!0},orientation:{event:!1,state:null},devWindow:null,init:function(b,c){this._super();this.device=b;CHK(c,"Undefined Page");DOC().title=
c;this.wrapper.div=GEI("waDIV");this.debug("Initialization started.");this.debug("UA="+window.navigator.userAgent);this.debug("Detected Device Screen Dimensions are ["+window.screen.availWidth+"x"+window.screen.availHeight+"]");this.debug("Detected Device Usable Dimensions are ["+window.innerWidth+"x"+window.innerHeight+"]");this.device.useTouch?(this.debug("Mobile Media Detected "+this.device.media.browser.name+" v"+this.device.media.browser.version+" on "+this.device.media.OS.name),this.initBanner(),
this.initGame(),this.initTouchPad()):(this.debug("Static Media Detected "+this.device.media.browser.name+" v"+this.device.media.browser.version+" on "+this.device.media.OS.name),this.initGame());!0===this.options.suspend?(this.debug("OPTION: Suspened on focus enabled."),window.addEventListener("blur",this._onBlur.bind(this),!0),window.addEventListener("focus",this._onFocus.bind(this),!0)):this.debug("OPTION: Suspened on focus disabled.");!0===this.options.network?(this.debug("OPTION: Network monitoring enabled."),
window.document.addEventListener("offline",this._onOffline.bind(this),!0),window.document.addEventListener("online",this._onOnline.bind(this),!0)):this.debug("OPTION: Network monitoring disabled.");window.onresize=this._onResize.bind(this)},initBanner:function(){var b=GEI("waDIV");this.banner.div=document.createElement("div");this.banner.div.id=this.banner.id="waBannerDIV";this.banner.div.width=window.innerWidth;this.banner.div.height=32;b.appendChild(this.banner.div);this.banner.div||this.debug("Could not get a banner element using the id ["+
this.banner.id+"]. ");this.banner.obj=new h5c3.Banners(this.banner.div);this.banner.obj||this.debug("Invalid Banner class. Must be named [Banners]");this.banner.dim={w:this.banner.div.width,h:this.banner.div.height};this.debug("Created Banner panel ["+this.banner.dim.w+"x"+this.banner.dim.h+"]")},initGame:function(){this.setOrientation();VLD(this.game.canvas=GEI("waCANVAS"))?(this.game.ctx=this.game.canvas.getContext("2d"),this.game.dim={w:this.game.canvas.width,h:this.game.canvas.height},"function"===
typeof Game&&(this.game.obj=new Game(this.game),VLD(this.game.obj)?this.debug("Created Game panel ["+this.game.dim.w+"x"+this.game.dim.h+"]"):this.debug("ERROR: Invalid Game class, Must be named [Game]"))):this.debug("ERROR: Could not attach to a canvas element using the id ["+this.game.id+"]. ")},initTouchPad:function(){var b=GEI("waDIV");this.touchpad.canvas=document.createElement("canvas");this.touchpad.canvas.id=this.touchpad.id="pcTouchCanvas";this.touchpad.canvas.width=1080;this.touchpad.canvas.height=
540;b.appendChild(this.touchpad.canvas);if(!this.touchpad.canvas)throw"device.js::initTouchpad() - Abort! Could not attach to a canvas element using the id ["+this.touchpad.id+"]. ";this.touchpad.ctx=this.touchpad.canvas.getContext("2d");this.touchpad.dim={w:this.touchpad.canvas.width,h:this.touchpad.canvas.height};this.touchpad.obj=new h5c3.TouchPad(this.touchpad.ctx,this.touchpad.dim);if(!this.touchpad.obj)throw"device.js::initTouchpad() - Invalid touchpad class. Must be named [TouchPad]";this.debug("Created Touchpad panel ["+
this.touchpad.dim.w+"x"+this.touchpad.dim.h+"]")},setOrientation:function(){this.device.started&&(window.DeviceOrientationEvent?(this.orientation.event=!0,this.debug("Device Orientation is supported - Event Hooked Added."),window.addEventListener("deviceorientation",this.onDeviceMotion,!1)):(this.orientation.event=!1,this.debug("Device Orientation not supported")),this.orientation.state=h5c3.device.useTouch||window.innerHeight>window.innerWidth?H5c3.ORIENTATION.PORTRAIT:H5C3.ORIENTATION.LANDSCAPE)},
onDeviceMotion:function(b){null!==b.alpha&&null!==b.beta&&null!==b.gamma||!0!==h5c3.device.page.orientation.event||(window.removeEventListener("deviceorientation",this.onDeviceMotion,!1),h5c3.device.page.orientation.event=!1,h5c3.device.page.debug("This device does not REALLY have orientation capabilities - Event Hooked Removed."))},_calcScreenSize:function(){this.orientation.state===H5C3.ORIENTATION.LANDSCAPE?(this.debug("Orientation set to Landscape."),document.fullScreen||GEI("waCANVAS").webkitRequestFullScreen()):
this.debug("Orientation set to Portrait.");this.wrapper.dim.w=window.innerWidth;this.wrapper.div.width=this.wrapper.dim.w+"px";this.wrapper.div.style.width=this.wrapper.dim.w+"px";this.wrapper.dim.h=window.innerHeight;this.wrapper.div.height=this.wrapper.dim.h+"px";this.wrapper.div.style.height=this.wrapper.dim.h+"px";this.debug("Calculated screen space is ["+this.wrapper.dim.w+"x"+this.wrapper.dim.h+"]");var b=this.wrapper.dim.h;h5c3.device.useTouch?(this.game.dim.w=this.wrapper.dim.w,this.game.canvas.style.width=
this.game.dim.w+"px",this.game.dim.h=this.wrapper.dim.w,this.game.canvas.style.height=this.game.dim.h+"px",b-=this.game.dim.h,this.touchpad.dim.w=this.wrapper.dim.w,this.touchpad.canvas.style.width=this.touchpad.dim.w+"px",this.touchpad.dim.h=b,this.touchpad.canvas.style.height=this.touchpad.dim.h+"px",b-=this.touchpad.dim.h):(this.game.dim.w=this.wrapper.dim.w,this.game.canvas.style.width=this.game.dim.w+"px",this.game.dim.h=this.wrapper.dim.h,this.game.canvas.style.height=b+"px",b-=b);this.debug("Used ["+
this.game.dim.w+"x"+this.game.dim.h+"] for Game Panel.");this.debug("Used ["+this.touchpad.dim.w+"x"+this.touchpad.dim.h+"] for Touchpad Panel.");0!==b&&this.debug("Layout was not done correctly. "+b+"px difference.")},render:function(){},waDIV:function(b){CHK(b,!0);this.wrapper.div.display="none";!0===b?this.wrapper.div.innerHTML="":document.location.reload();this.wrapper.div.display="block"},_onBlur:function(b){this.game.obj.onBlur()},_onFocus:function(b){this.game.obj.onFocus()},_onOffline:function(b){this.debug("Lost network connection.")},
_onOnline:function(b){this.debug("Gained network connection.")},_onResize:function(b){this.debug("Dimension changed detected.");this._calcScreenSize();this.game.dim.w=this.game.canvas.width;this.game.dim.h=this.game.canvas.height;this.game.obj.onResize(this.game.dim.w,this.game.dim.h)},onReady:function(){this.debug("onReady Called.");this.game.obj.onReady();if(h5c3.device.useTouch)this.touchpad.obj.onReady()}});
h5c3.Main=h5c3.Base.extend("h5c3.Main",{_CLASSNAME:"Main",_CLASSVERSION:"0.1.0"},{scenes:null,activeScenes:null,paused:!1,ctx:null,dim:null,bQuit:!1,init:function(b){this._super();_DBG_("Initializing "+this.Class.shortName+" object.",this.Class);this.ctx=b.ctx;this.dim=b.dim;this.canvas=b.canvas;this.scenes=new h5c3.LinkedList;this.activeScenes=new h5c3.LinkedList;!0===h5c3.devMode&&(h5c3.device.input.bindAction(this,"developer window","F6"),h5c3.device.input.bindAction(this,"physics debug","F7"),
h5c3.device.input.bindAction(this,"pool dump","F8"),h5c3.device.input.bindAction(this,"toggle sound","F9"),h5c3.device.input.bindAction(this,"reset","F10"),h5c3.device.input.bindAction(this,"exit","F12"));_DBG_("Initialization completed.",this.Class)},process:function(){if(this.paused||this.bQuit)return this.bQuit;for(var b=this.getFirstActiveScene();b;)b.object().process(),b=b.next();return this.bQuit},stopAllSounds:function(){for(var b=h5c3.loader.getAllSounds(),c=0;c<b.length;c++)h5c3.device.soundEnabled&&
b[c].stop()},onAction:function(b){switch(b){case "reset":h5c3.device.boot();break;case "exit":this.quit();break;case "developer window":VLD(h5c3.device.page.devWindow)?(_DBG_("Developer Window activated.",this.Class),h5c3.device.page.devWindow.toggleShow()):_DBG_("Developer Window not available. Did you include the Plugin in your config? Are you running the debug.html version of your app?'",this.Class);break;case "toggle sound":this.stopAllSounds();h5c3.device.soundEnabled=!h5c3.device.soundEnabled;
h5c3.device.soundEnabled?h5c3.device.page.devWindow.send2Console("Sound Enabled."):h5c3.device.page.devWindow.send2Console("Sound Disabled.");break;case "pool dump":h5c3.device.page.devWindow.send2Console("Object Pool Dump:\n===================");h5c3.device.page.devWindow.send2Console(h5c3.Pool.getStats());break;case "physics debug":for(b=this.getFirstScene();b;){for(var c=b.object().getFirstActiveLayer();c;){var f=c.object();if(f.Class.isA("h5c3.EntityLayer"))for(f=f.systemManager.systems.first;f;){var g=
f.object();g.Class.isA("h5c3.systems.Physics")&&g.setDebug(!g.debug);f=f.next()}c=c.next()}b=b.next()}}},addScene:function(b){try{b.ctx=this.ctx,this.scenes.add(b),this.activeScenes.add(b),this.onSceneAdded(b)}catch(c){AST(null,"Error Adding scene ["+b+"]: "+c)}},onSceneAdded:function(b){},removeScene:function(b){this.scenes.remove(b);this.activeScenes.remove(b);this.onSceneRemoved(b)},onSceneRemoved:function(b){},activateScene:function(b){"undefined"===typeof b||b.active||(this.activeScenes.add(b),
b.active=!0,this.onSceneActivated(b),b.onActivated())},onSceneActivated:function(b){},deactivateScene:function(b){b.active&&(this.activeScenes.remove(b),b.active=!1,this.onSceneDeactivated(b),b.onDeactivated())},onSceneDeactivated:function(b){},getFirstActiveScene:function(){return this.activeScenes.first},getFirstScene:function(){return this.scenes.first},pause:function(){if(!this.paused){h5c3.device.handleTimers(!1);this.paused=!0;for(var b=this.getFirstScene();b;)b.object().pause(),b=b.next()}},
isActive:function(){return!this.paused},resume:function(){if(this.paused){h5c3.device.handleTimers(!0);this.paused=!1;for(var b=this.getFirstScene();b;)b.object().resume(),b=b.next()}},togglePauseResume:function(){this.paused?this.resume():this.pause()},quit:function(b){CHK(b,"Quit Signal Received.");_DBG_(b,this.Class);this.onExit();this.bQuit=!0},onExit:function(){_DBG_("CloudApp Exiting...",this.Class)},reset:function(){for(var b=this.getFirstScene();b;)b.obj.reset(),b=b.next();this.scenes.clear();
this.activeScenes.clear();this.onReady()},attachTouchEvents:function(b){h5c3.device.useTouch?(_DBG_("Attached Touch Events",this.Class),this.canvas.addEventListener("touchstart",b._touchStart.bind(b),!0),this.canvas.addEventListener("touchend",b._touchEnd.bind(b),!0),this.canvas.addEventListener("touchmove",b._touchMove.bind(b),!0),h5c3.device.touchpad.canvas.addEventListener("touchstart",b._touchStart.bind(b),!0),h5c3.device.touchpad.canvas.addEventListener("touchend",b._touchEnd.bind(b),!0),h5c3.device.touchpad.canvas.addEventListener("touchmove",
b._touchMove.bind(b),!0)):(_DBG_("Attached Mouse & Keyboard Events",this.Class),this.canvas.addEventListener("selectstart",function(b){b.preventDefault();return!1},!1),this.canvas.addEventListener("mouseup",b._mouseUp.bind(b),!0),this.canvas.addEventListener("mousedown",b._mouseDown.bind(b),!0),this.canvas.addEventListener("mousemove",b._mouseMove.bind(b),!0),this.canvas.addEventListener("mousewheel",b._mouseWheel.bind(b),!0),this.canvas.addEventListener("contextmenu",b._contextMenu.bind(b),!0))},
onReady:function(){_DBG_("onReady received.",this.Class);!0===h5c3.devMode&&h5c3.loader.setDisableCache();if(!1===h5c3.device.resourcesLoaded)try{h5c3.resources.loadResources(),h5c3.loader.start(this.onLoading.bind(this),this.onLoaded.bind(this)),h5c3.device.resourcesLoaded=!0}catch(b){console.log("ERROR: "+b)}},onResize:function(b,c){for(var f=this.getFirstActiveScene();f;)f.obj.onResize(b,c),f=f.next()},onBlur:function(b){this.paused||(this.pause(),_DBG_("Lost focus - Paused.",this.Class))},onFocus:function(b){this.paused&&
(this.resume(),_DBG_("Gained focus - Resuming.",this.Class))},onLoading:function(b){},onLoaded:function(b,c){},getScreenRect:function(){return h5c3.Rect.create(0,0,h5c3.device.dimGame.w,h5c3.device.dimGame.h)}});h5c3.systems={};
h5c3.systems.System=h5c3.Base.extend("h5c3.System",{_CLASSNAME:"Systems",_CLASSVERSION:"0.1.0"},{layer:null,componentTypes:null,systemManager:null,delay:0,_lastRun:0,init:function(b,c){this._super();this.delay=CHK(c,0);if(!b instanceof Array)throw"Invalid component types array. Use a blank array ([]) if there are no components handled by the system.";this.componentTypes=b},processAll:function(){},onResize:function(){},onOriginChange:function(b,c){},onAddedToLayer:function(b){},onRemovedFromLayer:function(b){}});
h5c3.systems.EntitySystem=h5c3.systems.System.extend("h5c3.systems.EntitySystem",{_CLASSNAME:"EntitySystem",_CLASSVERSION:"0.1.0"},{entities:null,suicides:null,init:function(b,c){this._super(b,c);this.entities=new h5c3.LinkedList;this.suicides=new h5c3.LinkedList},addIfMatched:function(b){for(var c=0;c<this.componentTypes.length;c++)if(b.hasComponentOfType(this.componentTypes[c])){this.entities.add(b);this.onEntityAdded(b);break}},add:function(b){this.entities.has(b)||(this.entities.add(b),this.onEntityAdded(b))},
remove:function(b){if(this.entities.remove(b))this.onEntityRemoved(b)},removeIfNotMatched:function(b){for(var c=0;c<this.componentTypes.length;c++)if(b.hasComponentOfType(this.componentTypes[c]))return;this.remove(b)},processAll:function(){for(var b=this.entities.first;b;)this.process(b.obj),b=b.next();for(b=this.suicides.first;b;)this.remove(b.obj),b=b.next();this.suicides.clear()},process:function(b){},suicide:function(b){this.suicides.add(b)},onEntityAdded:function(b){},onEntityRemoved:function(b){},
onComponentAdded:function(b,c){},onComponentRemoved:function(b,c){}});h5c3.components={};h5c3.components.Component=h5c3.Pooled.extend("h5c3.components.Component",{_CLASSNAME:"Component",_CLASSVERSION:"0.1.0",create:function(){var b=this._super();b.active=!0;return b}},{_entity:null,_type:null,init:function(b){this._super();this._type=b},getType:function(){return this._type.toLowerCase()},getEntity:function(){return this._entity},onBeforeRemoved:function(){}});
h5c3.SystemManager=h5c3.Base.extend("h5c3.SystemManager",{_CLASSNAME:"SystemManager",_CLASSVERSION:"0.1.0"},{systems:null,systemsByComponentType:null,layer:null,init:function(b){this.systems=new h5c3.LinkedList;this.systemsByComponentType=new h5c3.Hashtable;this.layer=b},add:function(b){b.layer=this.layer;b.systemManager=this;this.systems.add(b);if(!VLD(b.componentTypes))throw"systemmanager.js::add() - Invalid component types: it can be empty, but not undefined. Did you forget to add an init method to your system and/or not call this._super(componentTypes)";
for(var c=0;c<b.componentTypes.length;c++){var f=b.componentTypes[c].toLowerCase(),g=this.systemsByComponentType.get(f);null==g&&(g=new h5c3.LinkedList,this.systemsByComponentType.put(f,g));g.has(b)||g.add(b)}for(c=this.layer.entityManager.entities.first;c;)this._handleEntityAdded(c.object()),c=c.next();b.onAddedToLayer(this.layer)},remove:function(b){b.onRemovedFromLayer(b.layer);this.systems.remove(b);for(var c=0;c<b.componentTypes;c++){var f=this.systemsByComponentType.get(b.componentTypes[c].toLowerCase());
assert(null!=f,"Oops, trying to remove a system and it's not in the by type list");b.systemManager=null;f.remove(b)}},getByComponentType:function(b){return this.systemsByComponentType.get(b)},onOriginChange:function(b,c){for(var f=this.systems.first;f;)f.object().onOriginChange(b,c),f=f.next()},_handleEntityAdded:function(b){for(var c=b.getComponentTypes(),f=0;f<c.length;f++){var g=this.systemsByComponentType.get(c[f].toLowerCase());if(g)for(g=g.first;g;)g.obj.add(b),g=g.next()}},_handleEntityRemoved:function(b){var c=
b.getAllComponents();if(null!=c)for(var c=c.keys(),f=0;f<c.length;f++){var g=this.systemsByComponentType.get(c[f].toLowerCase());if(g)for(g=g.first;g;)g.obj.remove(b),g=g.next()}},_handleComponentAdded:function(b,c){var f=this.systemsByComponentType.get(c.getType());if(null!=f)for(f=f.first;f;)f.obj.add(b),f.obj.onComponentAdded(b,c),f=f.next()},_handleComponentRemoved:function(b,c){var f=this.systemsByComponentType.get(c.getType());if(null!=f)for(f=f.first;f;)f.obj.removeIfNotMatched(b),f.obj.onComponentRemoved(b,
c),f=f.next()},processAll:function(){for(var b=this.systems.first;b;){if(0==b.obj.delay||h5c3.device.now-b.obj._lastRun>b.obj.delay)b.obj.processAll(),0!=b.obj.delay&&(b.obj._lastRun=h5c3.device.now);b=b.next()}},onResize:function(b,c){for(var f=this.systems.first;f;)f.obj.onResize(b,c),f=f.next()}});
h5c3.EntityManager=h5c3.Base.extend("h5c3.EntityManager",{_CLASSNAME:"EntityManager",_CLASSVERSION:"0.1.0"},{entitiesByTag:null,componentsByEntity:null,componentsByEntityPlusType:null,entities:null,entitySuicides:null,layer:null,init:function(b){this.layer=b;this.entitiesByTag=new h5c3.HashList;this.entities=new h5c3.LinkedList;this.componentsByEntity=new h5c3.Hashmap;this.componentsByEntityPlusType=new h5c3.Hashmap;this.entitySuicides=new h5c3.LinkedList},cleanup:function(){for(var b=this.entitySuicides.first;b;)this._doRemoveEntity(b.object()),
b=b.next();this.entitySuicides.clear()},add:function(b,c){this.entities.add(b);void 0!=c&&this.entitiesByTag.add(c,b);var f=b.getAllComponents();if(null!=f)for(var f=f.values(),g=0;g<f.length;g++)this._addToComponentMap(b,f[g]);this.layer.systemManager._handleEntityAdded(b)},remove:function(b){this.entitySuicides.has(b)||(this.entitySuicides.add(b),b.active=!1)},removeComponent:function(b,c){this._removeFromComponentMap(b,c);this.layer.systemManager._handleComponentRemoved(b,c);b._handleComponentRemoved(c);
c._entity=null},addTag:function(b,c){-1==b.tags.indexOf(c.toLowerCase())&&(this.entitiesByTag.add(c.toLowerCase(),b),b.tags.push(c.toLowerCase()))},removeTag:function(b,c){this.entitiesByTag.remove(c.toLowerCase(),b);b.tags.remove(c.toLowerCase())},getTagged:function(b){return this.entitiesByTag.get(b.toLowerCase())},activate:function(b){b.active||(this.layer.systemManager._handleEntityAdded(b),b.active=!0)},deactivate:function(b){b.active&&(this.layer.systemManager._handleEntityRemoved(b),b.active=
!1)},_doRemoveEntity:function(b){this.entities.remove(b);var c=b.getAllComponents();if(null!=c)for(var c=c.values(),f=0;f<c.length;f++)this._removeFromComponentMap(b,c[f]);for(c=0;c<b.tags.length;c++)this.entitiesByTag.remove(b.tags[c],b);this.layer.systemManager._handleEntityRemoved(b);b.release()},addComponent:function(b,c){this._addToComponentMap(b,c);b._handleComponentAdded(c);this.layer.systemManager._handleComponentAdded(b,c);c._entity=b;return c},getComponent:function(b,c){return this.componentsByEntityPlusType.get(b.objectId+
":"+c)},getComponents:function(b){return this.componentsByEntity.get(b.objectId)},hasComponentOfType:function(b,c){return this.componentsByEntityPlusType.containsKey(b.objectId+":"+c)},_addToComponentMap:function(b,c){if(this.componentsByEntityPlusType.get(b.objectId+":"+c.getType()))throw"entitymanager.js::_addToComponentMap() - adding component "+c.getType()+" to entity "+b+" when it already has one of that type";this.componentsByEntityPlusType.put(b.objectId+":"+c.getType(),c);this.componentsByEntity.put(b.objectId,
c)},_removeFromComponentMap:function(b,c){c.onBeforeRemoved();this.componentsByEntityPlusType.remove(b.objectId+":"+c.getType());this.componentsByEntity.remove(b.objectId);c.release()}});h5c3.lang||(h5c3.lang={$developer:"Developer",$production:"Production"});h5c3.init()&&h5c3.run();
